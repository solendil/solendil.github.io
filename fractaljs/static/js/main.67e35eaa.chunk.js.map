{"version":3,"sources":["engine/scheduler/worker/interface.worker.js","engine/fractals sync //.([jt]s)$","engine/fractals/burningbird.ts","engine/fractals/burningship.ts","engine/fractals/example.ts","engine/fractals/julia.ts","engine/fractals/mandelbrot.ts","engine/fractals/mandelbrot3.ts","engine/fractals/mandelbrot4.ts","engine/fractals/phoenix.ts","engine/fractals/tippetts.ts","util/EventBus.ts","engine/scheduler/worker.ts","engine/scheduler/scheduler.ts","engine/redrawer.ts","engine/fractals.ts","params.ts","engine/tile.ts","engine/renderer.ts","util/palette.ts","engine/painter.ts","engine/math/vector.ts","engine/math/matrix.ts","engine/math/camera.ts","engine/engine.ts","redux/set.ts","util/keybinder.ts","redux/controller.ts","redux/improver.ts","redux/colors.ts","redux/url.ts","redux/ui.ts","redux/rdxengine.ts","ui/pages/Fractal.tsx","ui/pages/Palette.tsx","ui/pages/Settings.tsx","util/misc.ts","ui/pages/About.tsx","ui/pages/Debug.tsx","ui/Share.tsx","ui/Toolbar.tsx","ui/Navigation.tsx","ui/InfoBox.tsx","ui/Snackbar.tsx","ui/App.tsx","serviceWorker.ts","redux/reducer.ts","index.tsx"],"names":["module","exports","Worker","__webpack_public_path__","map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","iLog2","Math","log","fractalId","uiOrder","name","preset","x","y","w","iter","fn","normal","cx","cy","zny","zx","zy","sqx","sqy","i","abs","smooth","j","znx","hidden","iLog4","xp1","yp1","xm1","ym1","sx","sy","EventBus","constructor","listeners","this","on","evt","callback","push","notify","obj","setTimeout","callbacks","forEach","cb","available","tile","worker","createWebWorker","WorkerInterface","postMessage","action","onmessage","bind","cancel","terminate","buffer","Float32Array","width","height","draw","order","event","data","Scheduler","ctx","scheduleId","orders","workers","upperCallback","handlers","nbThreads","onWorkerResponse","throttledSchedule","_","throttle","shift","isWorking","accept","filter","length","busyWorkers","availableWorkers","schedule","reject","Promise","Redrawer","canvas","offCanvas","context","lastId","lastType","lastMatrix","document","createElement","redraw","newMatrix","type","tileSorter","m","inverse","multiply","imageData","getImageData","getContext","putImageData","clearRect","transform","a","b","c","d","f","drawImage","setTransform","reverse","require","byId","filename","default","getPreset","res","param","nbTiles","supersampling","Tile","x1","x2","y1","y2","ratio","nbY","round","sqrt","nbX","console","Renderer","painter","engine","scheduler","redrawer","imageBuffer","tiles","resize","createImageData","Uint32Array","getTiling","getIterationsAt","cpx","getFunction","func","getHistogram","histogram","Array","fill","val","drawColor","paint","params","tileSort","camera","matrix","workerModel","assign","model","t","dist","sort","standardGradients","0","1","2","3","4","5","10","11","12","13","14","15","16","17","18","19","createInterpolant","xs","ys","result","indexes","oldXs","oldYs","dys","dxs","ms","dx","dy","c1s","mNext","dxNext","common","cpx2scr","c3s","c1","invDx","mid","low","high","floor","xHere","max","diff","diffSq","getBufferFromId","resolution","gradient","indices","reds","greens","blues","Int32Array","split","stop","items","Number","parseInt","substring","interR","interG","interB","byteBuffer","Uint8Array","bufferIndex","floatIndex","buildBuffer","buildBufferFromStringGradient","Painter","p","offset","density","set","tx","ty","color","cbuffer","tileIndex","Vector","midPoint","v2","minus","v","plus","times","minVal","min","Matrix","isIdentity","isInvertible","deter","inverseGaussJordan","dt","gje","M","c1i","c2i","c2","gjet","toString","t1px","t1py","t1qx","t1qy","t1rx","t1ry","t2px","t2py","t2qx","t2qy","t2rx","t2ry","STD2T1","STD2T2","T12STD","angle","cos","sin","identity","Camera","screenSize","pos","affineMatrix","matrix_inv","screen","resolutionLimit","extent","reproject","S2Q","affineTransform","q","r","GetTriangleToTriangle","getScreenToSquareMatrix","Q2C","valuex","valuey","GetRotationMatrix","GetShearMatrix","GetScaleMatrix","affineReset","clone","scr2cpx","getPos","setPos","isZoomLimit","Engine","renderer","navigator","hardwareConcurrency","viewport","details","start","Date","getTime","end","time","ui","createSlice","initialState","reducers","setSet","state","payload","updateSet","reducer","actions","left","up","right","down","esc","A","B","C","D","E","F","G","H","I","J","K","L","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","keymap","bindings","addEventListener","keyCode","modifier","shiftKey","binding","combo","every","k","bindKeys","keysStr","keycodes","key","ANGLE","PI","Controller","dispatch","setupKeyboard","setupMouse","setupTouch","pan","scr_vector_delta","cam","scr_vector","cpx_point_0","cpx_point_dest","cpx_vector","cpx_new_point","changeXY","zoom","delta","scr_point_arg","scr_point","cpx_point","Î”","hammer","Hammer","dragStart","cameraStart","isDragging","get","direction","DIRECTION_ALL","threshold","enable","center","cpx_new","isPinching","pinchStart","ev","pc1","pc2","scale","pc0A","z","window","preventDefault","deltaY","point","offsetX","offsetY","Improver","engineArg","getState","frameId","lastState","sleep","duration","analysePicture2","histo","nbPixels","nb","perc","shouldIncrease","shouldDecrease","txt","toFixed","size","analysis","newIter","setColorId","setOffset","setDensity","setPaint","defaults","fs","ct","co","cd","cf","va","vb","vc","vd","update","args","String","str","entries","join","history","replaceState","error","read","url","location","hash","startsWith","rawArgs","substr","reduce","acc","tuple","parts","desc","parseFloat","readCurrentScheme","readInit","forceCold","urlData","omit","drawer","mouseOnCanvas","tab","infobox","mouse","narrowDevice","orientableDevice","setDrawer","setTab","setInfobox","setMouseOnCanvas","setMouseInfo","setNarrowDevice","setSnack","snack","initEngine","getWindowSize","innerWidth","innerHeight","onMediaChange","media","matches","matchMedia","addListener","debounce","init","urlUpdate","undefined","changeFractalType","setValues","colorActions","changeSmooth","pt","setColorOffset","setColorDensity","colors","useStyles","makeStyles","theme","swatches","display","flexWrap","marginLeft","spacing","textTransform","paddingLeft","paddingBottom","Fractal","classes","useDispatch","useSelector","buttons","values","Button","variant","onClick","List","component","subheader","ListSubheader","ListItem","className","DENSITY","gradients","colorBuffer","dataURL","toDataURL","marginRight","paddingRight","position","borderRadius","bottom","fontSize","padding","textShadow","Palette","alt","src","densitySlider","dense","Typography","Slider","step","value","onChange","Settings","ListItemText","primary","ListItemSecondaryAction","Switch","edge","target","checked","createStyles","avatar","backgroundColor","palette","main","inline","verticalAlign","border","background","margin","minWidth","textAlign","Keys","Speech","rel","href","SimpleCard","style","maxWidth","maxTouchPoints","msMaxTouchPoints","ListItemAvatar","Avatar","secondary","orientation","userAgent","indexOf","Divider","data-color-scheme","data-size","data-show-count","aria-label","Debug","Share","props","nav","share","IconButton","title","text","bar","fade","backdropFilter","breakpoints","only","flexDirection","icons","brand","lineHeight","writingMode","fontFamily","paddingTop","letterSpacing","fontWeight","flexGrow","textDecoration","ToolBar","navigation","def","tabId","icon","Boolean","splice","fractal","settings","about","debug","appBar","top","trans","borderTopLeftRadius","borderTopRightRadius","handle","Navigation","bigDevice","useMediaQuery","content","SwipeableDrawer","anchor","open","disableDiscovery","disableSwipeToOpen","PaperProps","BackdropProps","invisible","onClose","onOpen","box","InfoBox","Paper","elevation","gutterBottom","Box","toExponential","snackbar","MySnackbar","Snackbar","message","App","ref","useRef","React","useEffect","current","canvasClass","isLocalhost","hostname","match","registerValidSW","swUrl","config","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","catch","root","combineReducers","store","configureStore","createMuiTheme","sm","md","lg","xl","ReactDOM","render","ThemeProvider","getElementById","URL","process","origin","fetch","headers","response","contentType","status","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.67e35eaa.chunk.js","sourcesContent":["module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"520087e4063d59e7b0e5.worker.js\");\n};","var map = {\n\t\"./burningbird.ts\": 156,\n\t\"./burningship.ts\": 157,\n\t\"./example.ts\": 158,\n\t\"./julia.ts\": 159,\n\t\"./mandelbrot.ts\": 160,\n\t\"./mandelbrot3.ts\": 161,\n\t\"./mandelbrot4.ts\": 162,\n\t\"./phoenix.ts\": 163,\n\t\"./tippetts.ts\": 164\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 155;","import { FractalDef } from \"./example\";\n\nconst escape = 4;\nvar iLog2 = 1.0 / Math.log(2.0);\n\nexport default {\n  fractalId: \"burningbird\",\n  uiOrder: 2.5,\n  name: \"Burning Bird\",\n  preset: { x: -0.46, y: 0.07, w: 3.26, iter: 50 },\n  fn: {\n    normal: (cx, cy, iter) => {\n      var zx = 0,\n        zy = 0,\n        sqx = 0,\n        sqy = 0,\n        i = 0,\n        znx,\n        zny;\n      cy = -cy; // this fractal is usually represented upside down\n      while (true) {\n        zny = (zx + zx) * zy + cy;\n        znx = sqx - sqy + cx;\n        zx = znx;\n        zy = Math.abs(zny);\n        if (++i >= iter) break;\n        sqx = zx * zx;\n        sqy = zy * zy;\n        if (sqx + sqy > escape) break;\n      }\n      return i;\n    },\n    smooth: (cx, cy, iter) => {\n      var zx = 0,\n        zy = 0,\n        sqx = 0,\n        sqy = 0,\n        i = 0,\n        j,\n        znx,\n        zny;\n      cy = -cy; // this fractal is usually represented upside down\n      while (true) {\n        zny = (zx + zx) * zy + cy;\n        znx = sqx - sqy + cx;\n        zx = znx;\n        zy = Math.abs(zny);\n        if (++i >= iter) break;\n        sqx = zx * zx;\n        sqy = zy * zy;\n        if (sqx + sqy > escape) break;\n      }\n      if (i === iter) return i;\n      for (j = 0; j < 4; ++j) {\n        zny = (zx + zx) * zy + cy;\n        znx = sqx - sqy + cx;\n        zx = znx;\n        zy = Math.abs(zny);\n        sqx = zx * zx;\n        sqy = zy * zy;\n      }\n      return 5 + i - Math.log(Math.log(sqx + sqy)) * iLog2;\n    },\n  },\n} as FractalDef;\n","import { FractalDef } from \"./example\";\n\nconst escape = 4;\nvar iLog2 = 1.0 / Math.log(2.0);\n\nexport default {\n  fractalId: \"burningship\",\n  uiOrder: 2,\n  name: \"Burning Ship\",\n  preset: { x: -0.4, y: 0.55, w: 3, iter: 50 },\n  fn: {\n    normal: (cx, cy, iter) => {\n      var zx = 0,\n        zy = 0,\n        sqx = 0,\n        sqy = 0,\n        i = 0,\n        znx,\n        zny;\n      cy = -cy; // this fractal is usually represented upside down\n      while (true) {\n        zny = (zx + zx) * zy + cy;\n        znx = sqx - sqy + cx;\n        zx = Math.abs(znx);\n        zy = Math.abs(zny);\n        if (++i >= iter) break;\n        sqx = zx * zx;\n        sqy = zy * zy;\n        if (sqx + sqy > escape) break;\n      }\n      return i;\n    },\n    smooth: (cx, cy, iter) => {\n      var zx = 0,\n        zy = 0,\n        sqx = 0,\n        sqy = 0,\n        i = 0,\n        j,\n        znx,\n        zny;\n      cy = -cy; // this fractal is usually represented upside down\n      while (true) {\n        zny = (zx + zx) * zy + cy;\n        znx = sqx - sqy + cx;\n        zx = Math.abs(znx);\n        zy = Math.abs(zny);\n        if (++i >= iter) break;\n        sqx = zx * zx;\n        sqy = zy * zy;\n        if (sqx + sqy > escape) break;\n      }\n      if (i === iter) return i;\n      for (j = 0; j < 4; ++j) {\n        zny = (zx + zx) * zy + cy;\n        znx = sqx - sqy + cx;\n        zx = Math.abs(znx);\n        zy = Math.abs(zny);\n        sqx = zx * zx;\n        sqy = zy * zy;\n      }\n      return 5 + i - Math.log(Math.log(sqx + sqy)) * iLog2;\n    },\n  },\n} as FractalDef;\n","export type RenderFn = (cx: number, cy: number, iter: number) => number;\nexport interface FractalDef {\n  fractalId: string;\n  hidden?: boolean;\n  uiOrder?: number;\n  name: string;\n  preset: {\n    x: number;\n    y: number;\n    w: number;\n    iter: number;\n  };\n  fn: {\n    normal: RenderFn;\n    smooth?: RenderFn;\n  };\n}\n\nexport default {\n  fractalId: \"example\",\n  hidden: true,\n  uiOrder: -1,\n  name: \"example\",\n  preset: {\n    x: -0.7,\n    y: 0.0,\n    w: 2.5,\n    iter: 50,\n  },\n  fn: {\n    normal: (cx, cy, iter) => {\n      return 0;\n    },\n    smooth: (cx, cy, iter) => {\n      return 0;\n    },\n  },\n} as FractalDef;\n","import { FractalDef } from \"./example\";\n\nconst escape = 4;\nconst iLog2 = 1.0 / Math.log(2.0);\n\nconst refx = 0.285;\nconst refy = 0.01;\n\nexport default {\n  fractalId: \"juliaex1\",\n  uiOrder: 5,\n  name: \"Julia\",\n  preset: {\n    x: 0.0,\n    y: 0.0,\n    w: 2.2,\n    iter: 50,\n  },\n  fn: {\n    normal: function (cx, cy, iter) {\n      var znx = cx,\n        zny = cy,\n        sqx = cx * cx,\n        sqy = cy * cy,\n        i = 0;\n      for (; i < iter && sqx + sqy <= escape; ++i) {\n        zny = (znx + znx) * zny + refy;\n        znx = sqx - sqy + refx;\n        sqx = znx * znx;\n        sqy = zny * zny;\n      }\n      return i;\n    },\n    smooth: function (cx, cy, iter) {\n      var znx = cx,\n        zny = cy,\n        sqx = cx * cx,\n        sqy = cy * cy,\n        i = 0,\n        j = 0;\n      for (; i < iter && sqx + sqy <= escape; ++i) {\n        zny = (znx + znx) * zny + refy;\n        znx = sqx - sqy + refx;\n        sqx = znx * znx;\n        sqy = zny * zny;\n      }\n      if (i === iter) {\n        return i;\n      }\n      for (j = 0; j < 4; ++j) {\n        zny = (znx + znx) * zny + refy;\n        znx = sqx - sqy + refx;\n        sqx = znx * znx;\n        sqy = zny * zny;\n      }\n      var res = 5 + i - Math.log(Math.log(sqx + sqy)) * iLog2;\n      return res;\n    },\n  },\n} as FractalDef;\n","import { FractalDef } from \"./example\";\n\nconst escape = 4;\nvar iLog2 = 1.0 / Math.log(2.0);\n\nexport default {\n  fractalId: \"mandelbrot\",\n  uiOrder: 0,\n  name: \"Mandelbrot\",\n  preset: { x: -0.7, y: 0.0, w: 2.5, iter: 50 },\n  fn: {\n    normal: (cx, cy, iter) => {\n      var znx = 0,\n        zny = 0,\n        sqx = 0,\n        sqy = 0,\n        i = 0;\n      for (; i < iter && sqx + sqy <= escape; ++i) {\n        zny = (znx + znx) * zny + cy;\n        znx = sqx - sqy + cx;\n        sqx = znx * znx;\n        sqy = zny * zny;\n      }\n      return i;\n    },\n    smooth: (cx, cy, iter) => {\n      var znx = 0,\n        zny = 0,\n        sqx = 0,\n        sqy = 0,\n        i = 0,\n        j = 0;\n      for (; i < iter && sqx + sqy <= escape; ++i) {\n        zny = (znx + znx) * zny + cy;\n        znx = sqx - sqy + cx;\n        sqx = znx * znx;\n        sqy = zny * zny;\n      }\n      if (i === iter) return i;\n      for (j = 0; j < 4; ++j) {\n        zny = (znx + znx) * zny + cy;\n        znx = sqx - sqy + cx;\n        sqx = znx * znx;\n        sqy = zny * zny;\n      }\n      return 5 + i - Math.log(Math.log(sqx + sqy)) * iLog2;\n    },\n  },\n} as FractalDef;\n","import { FractalDef } from \"./example\";\n\nconst escape = 4;\nvar iLog4 = 1.0 / Math.log(4.0);\n\nexport default {\n  fractalId: \"mandelbrot3\",\n  uiOrder: 3,\n  name: \"Multibrot *3\",\n  preset: { x: 0.0, y: 0.0, w: 3.0, iter: 50 },\n  fn: {\n    normal: (cx, cy, iter) => {\n      var zx = 0,\n        zy = 0,\n        sqx = 0,\n        sqy = 0,\n        i = 0,\n        znx,\n        zny;\n      while (true) {\n        znx = sqx * zx - 3 * zx * sqy + cx;\n        zny = 3 * sqx * zy - sqy * zy + cy;\n        zx = znx;\n        zy = zny;\n        if (++i >= iter) break;\n        sqx = zx * zx;\n        sqy = zy * zy;\n        if (sqx + sqy > escape) break;\n      }\n      return i;\n    },\n    smooth: (cx, cy, iter) => {\n      var zx = 0,\n        zy = 0,\n        sqx = 0,\n        sqy = 0,\n        i = 0,\n        j,\n        znx,\n        zny;\n      while (true) {\n        znx = sqx * zx - 3 * zx * sqy + cx;\n        zny = 3 * sqx * zy - sqy * zy + cy;\n        zx = znx;\n        zy = zny;\n        if (++i >= iter) break;\n        sqx = zx * zx;\n        sqy = zy * zy;\n        if (sqx + sqy > escape) break;\n      }\n      if (i === iter) return i;\n      for (j = 0; j < 4; ++j) {\n        znx = sqx * zx - 3 * zx * sqy + cx;\n        zny = 3 * sqx * zy - sqy * zy + cy;\n        zx = znx;\n        zy = zny;\n        sqx = zx * zx;\n        sqy = zy * zy;\n      }\n      return 5 + i - Math.log(Math.log(sqx + sqy)) * iLog4;\n    },\n  },\n} as FractalDef;\n","import { FractalDef } from \"./example\";\n\nconst escape = 4;\nvar iLog4 = 1.0 / Math.log(4.0);\n\nexport default {\n  fractalId: \"mandelbrot4\",\n  uiOrder: 4,\n  name: \"Multibrot *4\",\n  preset: { x: 0.0, y: 0.0, w: 3.0, iter: 50 },\n  fn: {\n    normal: (cx, cy, iter) => {\n      var zx = 0,\n        zy = 0,\n        sqx = 0,\n        sqy = 0,\n        i = 0,\n        znx,\n        zny;\n      while (true) {\n        znx = sqx * sqx - 6 * sqx * sqy + sqy * sqy + cx;\n        zny = 4 * sqx * zx * zy - 4 * zx * sqy * zy + cy;\n        zx = znx;\n        zy = zny;\n        if (++i >= iter) break;\n        sqx = zx * zx;\n        sqy = zy * zy;\n        if (sqx + sqy > escape) break;\n      }\n      return i;\n    },\n    smooth: (cx, cy, iter) => {\n      var zx = 0,\n        zy = 0,\n        sqx = 0,\n        sqy = 0,\n        i = 0,\n        znx,\n        zny;\n      while (true) {\n        znx = sqx * sqx - 6 * sqx * sqy + sqy * sqy + cx;\n        zny = 4 * sqx * zx * zy - 4 * zx * sqy * zy + cy;\n        zx = znx;\n        zy = zny;\n        if (++i >= iter) break;\n        sqx = zx * zx;\n        sqy = zy * zy;\n        if (sqx + sqy > escape) break;\n      }\n      if (i === iter) return i;\n      return 5 + i - Math.log(Math.log(sqx + sqy)) * iLog4;\n    },\n  },\n} as FractalDef;\n","import { FractalDef } from \"./example\";\n\nconst escape = 4;\nvar iLog2 = 1.0 / Math.log(2.0);\n\nconst refx = 0.5667;\nconst refy = -0.5;\n\nexport default {\n  fractalId: \"phoenixex1\",\n  uiOrder: 6,\n  name: \"Phoenix\",\n  preset: { x: -0.7, y: -0.05, w: 1.6, iter: 250 },\n  fn: {\n    normal: function (cx, cy, iter) {\n      var x = -cy,\n        y = cx,\n        xm1 = 0,\n        ym1 = 0;\n      var sx = 0,\n        sy = 0,\n        i = 0;\n      var xp1;\n      var yp1;\n      for (; i < iter && sx + sy <= escape; ++i) {\n        xp1 = x * x - y * y + refx + refy * xm1;\n        yp1 = 2 * x * y + refy * ym1;\n        sx = xp1 * xp1;\n        sy = yp1 * yp1;\n        xm1 = x;\n        ym1 = y;\n        x = xp1;\n        y = yp1;\n      }\n      return i;\n    },\n\n    smooth: function (cx, cy, iter) {\n      var x = -cy,\n        y = cx,\n        xm1 = 0,\n        ym1 = 0;\n      var sx = 0,\n        sy = 0,\n        i = 0;\n      var xp1;\n      var yp1;\n      for (; i < iter && sx + sy <= escape; ++i) {\n        xp1 = x * x - y * y + refx + refy * xm1;\n        yp1 = 2 * x * y + refy * ym1;\n        sx = xp1 * xp1;\n        sy = yp1 * yp1;\n        xm1 = x;\n        ym1 = y;\n        x = xp1;\n        y = yp1;\n      }\n      if (i === iter) {\n        return i;\n      }\n      for (var j = 0; j < 4; ++j) {\n        xp1 = x * x - y * y + refx + refy * xm1;\n        yp1 = 2 * x * y + refy * ym1;\n        sx = xp1 * xp1;\n        sy = yp1 * yp1;\n        xm1 = x;\n        ym1 = y;\n        x = xp1;\n        y = yp1;\n      }\n      var res = 5 + i - Math.log(Math.log(x * x + y * y)) * iLog2;\n      return res;\n    },\n  },\n} as FractalDef;\n","import { FractalDef } from \"./example\";\n\nconst escape = 4;\n\nexport default {\n  fractalId: \"tippetts\",\n  uiOrder: 1,\n  name: \"Tippetts\",\n  preset: { x: -0.5, y: 0.0, w: 4, iter: 50 },\n  fn: {\n    normal: (cx, cy, iter) => {\n      var zx = 0,\n        zy = 0,\n        sqx = 0,\n        sqy = 0,\n        i = 0;\n      for (; i < iter && sqx + sqy <= escape; ++i) {\n        zx = sqx - sqy + cx;\n        zy = (zx + zx) * zy + cy;\n        sqx = zx * zx;\n        sqy = zy * zy;\n      }\n      return i;\n    },\n  },\n} as FractalDef;\n","export type Callback = (x: any) => void;\n\ntype Events = \"draw.redraw\" | \"draw.start\" | \"zoom.limit\";\n\nexport default class EventBus {\n  private listeners: {\n    [key: string]: Callback[];\n  };\n\n  constructor() {\n    this.listeners = {};\n  }\n\n  on(evt: Events, callback: Callback) {\n    if (!(evt in this.listeners)) this.listeners[evt] = [];\n    this.listeners[evt].push(callback);\n  }\n\n  notify(evt: Events, obj?: any) {\n    // force the notification to occur from the event loop (always async callback)\n    setTimeout(() => {\n      const callbacks = this.listeners[evt] || [];\n      if (obj) obj.evt = evt;\n      callbacks.forEach(cb => {\n        cb(obj);\n      });\n    }, 0);\n  }\n}\n","// @ts-ignore\nimport WorkerInterface from \"./worker/interface.worker.js\";\nimport { DrawOrder, Order, WorkerResponse } from \"./types\";\nimport { Tile } from \"../tile.js\";\n\ninterface TWorker {\n  postMessage: (x: Order, y?: any[]) => void;\n  onmessage: (x: any) => void;\n  terminate: () => void;\n}\ntype LocalCallback = (worker: Worker, data: WorkerResponse) => void;\n\n/*\n  This is a webworker proxy. It handles:\n  - passing of tile buffer by reference to and from the webworker\n  - canceling webworkers, and recreating their tile buffer\n  - handling \"available\" status as a safeguard\n*/\nexport default class Worker {\n  public id: number;\n  public available: boolean = true;\n\n  private tile!: Tile;\n  private worker!: TWorker;\n  private callback: LocalCallback;\n\n  constructor(id: number, callback: LocalCallback) {\n    this.id = id;\n    this.createWebWorker();\n    this.callback = callback;\n  }\n\n  private createWebWorker() {\n    this.worker = (new WorkerInterface() as unknown) as TWorker;\n    this.worker.postMessage({ action: \"init\", id: this.id });\n    this.worker.onmessage = this.onmessage.bind(this);\n  }\n\n  cancel() {\n    if (this.available) throw new Error(\"Canceling an available worker\");\n    // hard stuff: force terminate and recreate of a worker\n    this.worker.terminate();\n    this.createWebWorker();\n    this.tile.buffer = new Float32Array(this.tile.width * this.tile.height);\n    this.available = true;\n  }\n\n  draw(order: DrawOrder) {\n    if (!this.available) throw new Error(\"Worker already busy\");\n    this.tile = order.tile;\n    this.available = false;\n    this.worker.postMessage(order, [order.tile.buffer.buffer]);\n  }\n\n  onmessage(event: any) {\n    const data: WorkerResponse = event.data;\n    this.tile.buffer = data.tile.buffer; // reassign the buffer to the original tile\n    this.available = true;\n    this.callback(this, data);\n  }\n}\n","import Worker from \"./worker\";\nimport { DrawOrder, WorkerResponse } from \"./types\";\nimport { Context } from \"../engine\";\nimport _ from \"lodash\";\n\n/*\nMaintains the list of webworkers.\nReceive list of orders from the renderer and dispatches them to the workers.\nCan be interrupted in the middle of a rendering.\nDeal with neutered arrays (arrays passed by reference between main thread and workers).\n*/\nexport default class Scheduler {\n  private scheduleId: number = 0;\n  private orders: DrawOrder[] = [];\n  private workers: Worker[] = [];\n  private upperCallback: (data: WorkerResponse) => void;\n  public handlers!: {\n    accept: () => any;\n    reject: (x: any) => any;\n  };\n\n  constructor(ctx: Context, callback: (data: WorkerResponse) => void) {\n    this.upperCallback = callback;\n    for (let i = 0; i < ctx.nbThreads; i += 1) {\n      const callback = this.onWorkerResponse.bind(this);\n      this.workers.push(new Worker(i, callback));\n    }\n    this.throttledSchedule = _.throttle(this.throttledSchedule.bind(this), 200);\n  }\n\n  private onWorkerResponse(worker: Worker, data: WorkerResponse) {\n    if (data.scheduleId === this.scheduleId) this.upperCallback(data);\n    const order = this.orders.shift();\n    if (order) worker.draw(order);\n    if (!this.isWorking) this.handlers.accept();\n  }\n\n  get availableWorkers() {\n    return this.workers.filter(w => w.available);\n  }\n\n  get busyWorkers() {\n    return this.workers.filter(w => !w.available);\n  }\n\n  get isWorking() {\n    return this.orders.length || this.busyWorkers.length;\n  }\n\n  private throttledSchedule(orders: DrawOrder[]) {\n    // store current draw orders, and assign one to each worker\n    this.orders = orders.map(o => ({ ...o, scheduleId: this.scheduleId }));\n    this.busyWorkers.forEach(w => w.cancel());\n    this.availableWorkers.forEach(w => {\n      const order = this.orders.shift();\n      if (order) w.draw(order);\n    });\n  }\n\n  // returns a pending promise that will be resolved by either\n  // - rejection if schedule is called before all orders have been handled\n  // - acception when everything has been settled\n  async schedule(orders: DrawOrder[]) {\n    // increase scheduleId to be able to reject outdated workers answering\n    this.scheduleId++;\n\n    // if we had previous orders, or busy workers, clear orders, reject\n    // previous promise\n    if (this.isWorking) {\n      this.orders = [];\n      if (this.handlers) this.handlers.reject(\"Scheduler interrupted\");\n    }\n\n    // throttle real work to avoid building/destroying webworkers too often\n    this.throttledSchedule(orders);\n\n    return new Promise((accept, reject) => {\n      this.handlers = { accept, reject };\n    });\n  }\n}\n","import Matrix from \"./math/matrix\";\nimport { Context } from \"./engine\";\n\nexport default class Redrawer {\n  private canvas: HTMLCanvasElement;\n  private offCanvas: HTMLCanvasElement;\n  private context: CanvasRenderingContext2D;\n  private lastId: number | null = null;\n  private lastType: string | null = null;\n  private lastMatrix: Matrix | null = null;\n\n  constructor(ctx: Context) {\n    this.canvas = ctx.canvas;\n    this.context = ctx.context;\n    this.offCanvas = document.createElement(\"canvas\");\n    this.offCanvas.width = this.canvas.width;\n    this.offCanvas.height = this.canvas.height;\n  }\n\n  redraw(newMatrix: Matrix, type: string, id: number) {\n    // if type has changed, don't redraw\n    if (this.lastType !== type) this.lastMatrix = null;\n    if (this.lastId === id) return;\n    let tileSorter;\n\n    if (this.lastMatrix) {\n      // compute movement matrix\n      const m = this.lastMatrix\n        .inverse()\n        .multiply(newMatrix)\n        .inverse();\n\n      // use movement to quickly redraw last picture at new position\n      const imageData = this.context.getImageData(\n        0,\n        0,\n        this.canvas.width,\n        this.canvas.height,\n      );\n      this.offCanvas.getContext(\"2d\")!.putImageData(imageData, 0, 0);\n      this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n      this.context.transform(m.a, m.b, m.c, m.d, m.e, m.f);\n      this.context.drawImage(this.offCanvas, 0, 0);\n      this.context.setTransform(1, 0, 0, 1, 0, 0);\n\n      // use movement to infer an optimal redrawing order of tiles\n      // tiles are sorted according to their distance to the tileSorter x, y point\n      // compute invariant point\n      /* eslint-disable no-mixed-operators */\n      const x =\n        (m.c * m.f - m.d * m.e + m.e) / (m.a * m.d - m.a - m.b * m.c - m.d + 1);\n      const y =\n        (m.a * m.f - m.b * m.e - m.f) /\n        (m.a * -m.d + m.a + m.b * m.c + m.d - 1);\n      /* eslint-enable no-mixed-operators */\n\n      if (m.a > 1.001 && m.d > 1.001) {\n        tileSorter = { x, y, reverse: false };\n      } else if (m.a < 0.99 && m.d < 0.99) {\n        tileSorter = { x, y, reverse: true };\n      } else if (Math.abs(m.e) > 0.01 || Math.abs(m.f) > 0.01) {\n        tileSorter = {\n          x: this.canvas.width / 2,\n          y: this.canvas.height / 2,\n          reverse: true,\n        };\n        if (m.e < -0.01) tileSorter.x = 0;\n        if (m.e > 0.01) tileSorter.x = this.canvas.width;\n        if (m.f < -0.01) tileSorter.y = 0;\n        if (m.f > 0.01) tileSorter.y = this.canvas.height;\n      }\n    } else {\n      this.lastType = type;\n    }\n\n    this.lastId = id;\n    this.lastMatrix = newMatrix;\n    return tileSorter;\n  }\n}\n","import { FractalDef } from \"./fractals/example\";\n\n// @ts-ignore\nconst context = require.context(\"./fractals/\", true, /\\.([jt]s)$/);\n\nconst byId: { [key: string]: FractalDef } = {};\ncontext.keys().forEach((filename: string) => {\n  const obj = context(filename).default;\n  byId[obj.fractalId] = obj;\n});\n\nexport const getFunction = (id: string, smooth: boolean) => {\n  const res = byId[id];\n  if (smooth) return res.fn.smooth || res.fn.normal;\n  return res.fn.normal;\n};\n\nexport const getPreset = (fractalId: string) => {\n  const res = byId[fractalId];\n  return { fractalId, ...res.preset };\n};\n\nexport const listForUi = () =>\n  Object.values(byId)\n    .filter(f => !f.hidden)\n    .sort((a, b) => (a.uiOrder || 0) - (b.uiOrder || 0));\n","const defaults = {\n  nbTiles: 100,\n  supersampling: true,\n};\n\nconst debug = {\n  // nbTiles: 100,\n  // supersampling: false,\n};\n\nexport const param = { ...defaults, ...debug };\n","import { param } from \"../params\";\n\nlet id = 0;\n\nexport class Tile {\n  public readonly id: number;\n  public readonly x1: number;\n  public readonly x2: number;\n  public readonly y1: number;\n  public readonly y2: number;\n  public readonly x: number;\n  public readonly y: number;\n  public readonly width: number;\n  public readonly height: number;\n  public buffer: Float32Array;\n\n  constructor(x1: number, x2: number, y1: number, y2: number) {\n    this.id = id++;\n    this.x1 = x1;\n    this.x2 = x2;\n    this.y1 = y1;\n    this.y2 = y2;\n    this.x = (x1 + x2) / 2;\n    this.y = (y1 + y2) / 2;\n    this.width = x2 - x1 + 1;\n    this.height = y2 - y1 + 1;\n    this.buffer = new Float32Array(this.width * this.height);\n  }\n\n  static getTiling(width: number, height: number) {\n    // compute tiling\n    const nbTiles = param.nbTiles;\n    const ratio = width / height;\n    const nbY = Math.round(Math.sqrt(nbTiles / ratio));\n    const nbX = Math.round(Math.sqrt(nbTiles / ratio) * ratio);\n    console.log(\n      `Tiling [${width} x ${height}] with ${nbTiles} tiles --> `,\n      `[${nbX} * ${nbY}] = ${nbY * nbX} tiles of `,\n      `~ [${Math.round(width / nbX)} x ${Math.round(height / nbY)}]`,\n    );\n    // instanciate tiles\n    const res = [];\n    for (let j = 0; j < nbY; j += 1) {\n      for (let i = 0; i < nbX; i += 1) {\n        const x1 = Math.round((i * width) / nbX);\n        const x2 = Math.round(((i + 1) * width) / nbX) - 1;\n        const y1 = Math.round((j * height) / nbY);\n        const y2 = Math.round(((j + 1) * height) / nbY) - 1;\n        res.push(new Tile(x1, x2, y1, y2));\n      }\n    }\n    return res;\n  }\n}\n","import Scheduler from \"./scheduler/scheduler\";\nimport Redrawer from \"./redrawer\";\nimport { getFunction } from \"./fractals\";\nimport Painter from \"./painter\";\nimport Main, { Context } from \"./engine\";\nimport { WorkerResponse, Params, Model, DrawOrder } from \"./scheduler/types\";\nimport Vector from \"./math/vector\";\nimport { Tile } from \"./tile\";\n\nexport default class Renderer {\n  private readonly ctx: Context;\n\n  private painter: Painter;\n  private scheduler: Scheduler;\n  private redrawer: Redrawer;\n\n  private width!: number;\n  private height!: number;\n  private imageData!: ImageData;\n  private imageBuffer!: Uint32Array;\n\n  private tiles!: Tile[];\n\n  constructor(ctx: Context, painter: Painter, engine: Main) {\n    this.ctx = ctx;\n    this.resize();\n    this.callback = this.callback.bind(this);\n    this.scheduler = new Scheduler(ctx, this.callback);\n    this.painter = painter;\n    this.redrawer = new Redrawer(ctx);\n  }\n\n  resize() {\n    const canvas = this.ctx.canvas;\n    this.imageData = this.ctx.context.createImageData(\n      canvas.width,\n      canvas.height,\n    );\n    this.imageBuffer = new Uint32Array(this.imageData.data.buffer);\n    this.width = canvas.width;\n    this.height = canvas.height;\n    this.tiles = Tile.getTiling(this.width, this.height);\n  }\n\n  getIterationsAt(cpx: Vector) {\n    const func = getFunction(this.ctx.fractalId, this.ctx.smooth);\n    return func(cpx.x, cpx.y, this.ctx.iter);\n  }\n\n  getHistogram(): number[] {\n    const histogram = new Array(this.ctx.iter + 1).fill(0);\n    for (const tile of this.tiles) {\n      for (let i in tile.buffer) {\n        const val = Math.round(tile.buffer[i]);\n        if (val >= 0 && val <= this.ctx.iter) histogram[val] += 1;\n      }\n    }\n    return histogram;\n  }\n\n  // redraws the current float buffer\n  drawColor() {\n    this.ctx.event.notify(\"draw.redraw\", {});\n    this.tiles.forEach(tile => {\n      this.painter.paint(tile, this.imageBuffer, this.width);\n    });\n    this.ctx.context.putImageData(\n      this.imageData,\n      0,\n      0,\n      0,\n      0,\n      this.width,\n      this.height,\n    );\n  }\n\n  // performs a full draw: floatbuffer + colors\n  draw(params: Params) {\n    this.ctx.event.notify(\"draw.start\", {});\n    const redraw = this.redrawer.redraw;\n    let tileSort: ReturnType<typeof redraw>;\n    if (this.redrawer)\n      tileSort = this.redrawer.redraw(\n        this.ctx.camera.matrix,\n        this.ctx.fractalId,\n        params.id || -1,\n      );\n    const workerModel: Model = Object.assign({}, this.ctx.camera.matrix, {\n      type: this.ctx.fractalId,\n      smooth: this.ctx.smooth,\n      iter: this.ctx.iter,\n    });\n    const orders: DrawOrder[] = this.tiles.map(tile => ({\n      action: \"draw\",\n      tile,\n      params,\n      model: workerModel,\n    }));\n    // if redrawer was able to find a tile sorting, sort them\n    if (tileSort) {\n      orders.forEach(t => {\n        t.dist = Math.sqrt(\n          (t.tile.x - tileSort!.x) ** 2 + (t.tile.y - tileSort!.y) ** 2,\n        );\n      });\n      orders.sort((a, b) =>\n        // @ts-ignore\n        tileSort!.reverse ? b.dist - a.dist : a.dist - b.dist,\n      );\n    }\n    const schedulerPromise = this.scheduler.schedule(orders); // .catch(() => {});\n    return schedulerPromise;\n  }\n\n  callback(data: WorkerResponse) {\n    if (data.action !== \"end-draw\") throw new Error();\n    const tile = data.tile;\n    this.painter.paint(tile, this.imageBuffer, this.width);\n    this.ctx.context.putImageData(\n      this.imageData,\n      0,\n      0,\n      tile.x1,\n      tile.y1,\n      tile.width,\n      tile.height,\n    );\n  }\n}\n","const standardGradients: { [key: number]: string } = {\n  0: \"0#080560;0.2#2969CB;0.40#F1FEFE;0.60#FCA425;0.85#000000\",\n  1: \"0.0775#78591e;0.55#d6e341\", // gold\n  2: \"0#0000FF;0.33#FFFFFF;0.66#FF0000\", // bleublancrouge\n  3: \"0.08#09353e;0.44#1fc3e6;0.77#08173e\", // night\n  4: \"0#000085;0.25#fffff5;0.5#ffb500;0.75#9c0000\", // defaultProps\n  5: \"0#000000;0.25#000000;0.5#7f7f7f;0.75#ffffff;0.975#ffffff\", // emboss\n  // flatUI palettes (http://designmodo.github.io/Flat-UI/)\n  10: \"0#000000;0.25#16A085;0.5#FFFFFF;0.75#16A085\", // green sea\n  11: \"0#000000;0.25#27AE60;0.5#FFFFFF;0.75#27AE60\", // nephritis\n  12: \"0#000000;0.25#2980B9;0.5#FFFFFF;0.75#2980B9\", // nephritis\n  13: \"0#000000;0.25#8E44AD;0.5#FFFFFF;0.75#8E44AD\", // wisteria\n  14: \"0#000000;0.25#2C3E50;0.5#FFFFFF;0.75#2C3E50\", // midnight blue\n  15: \"0#000000;0.25#F39C12;0.5#FFFFFF;0.75#F39C12\", // orange\n  16: \"0#000000;0.25#D35400;0.5#FFFFFF;0.75#D35400\", // pumpkin\n  17: \"0#000000;0.25#C0392B;0.5#FFFFFF;0.75#C0392B\", // pmoegranate\n  18: \"0#000000;0.25#BDC3C7;0.5#FFFFFF;0.75#BDC3C7\", // silver\n  19: \"0#000000;0.25#7F8C8D;0.5#FFFFFF;0.75#7F8C8D\", // asbestos\n};\n\n/*\n * Monotone cubic spline interpolation\n *     let f = createInterpolant([0, 1, 2, 3, 4], [0, 1, 4, 9, 16]);\n *     for (let x = 0; x <= 4; x += 0.1)\n *        let xSquared = f(x);\n * https://en.wikipedia.org/wiki/Monotone_cubic_interpolation\n */\nfunction createInterpolant(xs: number[], ys: number[]) {\n  let i,\n    length = xs.length;\n\n  // Deal with length issues\n  if (length !== ys.length) {\n    throw new Error(\"Need an equal count of xs and ys.\");\n  }\n  if (length === 0) {\n    return function(x: any) {\n      return 0;\n    };\n  }\n  if (length === 1) {\n    // Impl: Precomputing the result prevents problems if ys is mutated later and allows garbage collection of ys\n    // Impl: Unary plus properly converts values to numbers\n    const result = +ys[0];\n    return function(x: any) {\n      return result;\n    };\n  }\n\n  // Rearrange xs and ys so that xs is sorted\n  const indexes = [];\n  for (i = 0; i < length; i++) {\n    indexes.push(i);\n  }\n  indexes.sort((a, b) => (xs[a] < xs[b] ? -1 : 1));\n  let oldXs = xs,\n    oldYs = ys;\n  // Impl: Creating new arrays also prevents problems if the input arrays are mutated later\n  xs = [];\n  ys = [];\n  // Impl: Unary plus properly converts values to numbers\n  for (i = 0; i < length; i++) {\n    xs.push(+oldXs[indexes[i]]);\n    ys.push(+oldYs[indexes[i]]);\n  }\n\n  // Get consecutive differences and slopes\n  let dys = [],\n    dxs = [],\n    ms = [];\n  for (i = 0; i < length - 1; i++) {\n    let dx = xs[i + 1] - xs[i],\n      dy = ys[i + 1] - ys[i];\n    dxs.push(dx);\n    dys.push(dy);\n    ms.push(dy / dx);\n  }\n\n  // Get degree-1 coefficients\n  const c1s = [ms[0]];\n  for (i = 0; i < dxs.length - 1; i++) {\n    let m = ms[i],\n      mNext = ms[i + 1];\n    if (m * mNext <= 0) {\n      c1s.push(0);\n    } else {\n      let dx = dxs[i],\n        dxNext = dxs[i + 1],\n        common = dx + dxNext;\n      c1s.push((3 * common) / ((common + dxNext) / m + (common + dx) / mNext));\n    }\n  }\n  c1s.push(ms[ms.length - 1]);\n\n  // Get degree-2 and degree-3 coefficients\n  let cpx2scr: number[] = [],\n    c3s: number[] = [];\n  for (i = 0; i < c1s.length - 1; i++) {\n    let c1 = c1s[i],\n      m = ms[i],\n      invDx = 1 / dxs[i],\n      common = c1 + c1s[i + 1] - m - m;\n    cpx2scr.push((m - c1 - common) * invDx);\n    c3s.push(common * invDx * invDx);\n  }\n\n  // Return interpolant function\n  return function(x: number) {\n    // The rightmost point in the dataset should give an exact result\n    let i = xs.length - 1;\n    if (x === xs[i]) {\n      return ys[i];\n    }\n\n    // Search for the interval x is in, returning the corresponding y if x is one of the original xs\n    let low = 0,\n      mid,\n      high = c3s.length - 1;\n    while (low <= high) {\n      mid = Math.floor(0.5 * (low + high));\n      const xHere = xs[mid];\n      if (xHere < x) {\n        low = mid + 1;\n      } else if (xHere > x) {\n        high = mid - 1;\n      } else {\n        return ys[mid];\n      }\n    }\n    i = Math.max(0, high);\n\n    // Interpolate\n    let diff = x - xs[i],\n      diffSq = diff * diff;\n    return ys[i] + c1s[i] * diff + cpx2scr[i] * diffSq + c3s[i] * diff * diffSq;\n  };\n}\n\nconst buildBufferFromStringGradient = (\n  resolution: number,\n  gradient: string,\n) => {\n  const indices: number[] = [];\n  const reds: number[] = [];\n  const greens: number[] = [];\n  const blues: number[] = [];\n\n  const buildStops = (str: string) => {\n    str.split(\";\").forEach(stop => {\n      const items = stop.split(\"#\");\n      indices.push(Number(items[0]));\n      reds.push(parseInt(items[1].substring(0, 2), 16));\n      greens.push(parseInt(items[1].substring(2, 4), 16));\n      blues.push(parseInt(items[1].substring(4, 6), 16));\n    });\n  };\n\n  const buffer = new Int32Array(resolution);\n  const buildBuffer = () => {\n    // loop first stop to end\n    indices.push(indices[0] + 1);\n    reds.push(reds[0]);\n    greens.push(greens[0]);\n    blues.push(blues[0]);\n\n    const interR = createInterpolant(indices, reds);\n    const interG = createInterpolant(indices, greens);\n    const interB = createInterpolant(indices, blues);\n\n    const byteBuffer = new Uint8Array(buffer.buffer); // create an 8-bit view on the buffer\n    let bufferIndex = 0;\n    for (let i = 0; i < resolution; i += 1) {\n      let floatIndex = i / resolution;\n      if (floatIndex < indices[0]) floatIndex += 1;\n      byteBuffer[bufferIndex + 0] = interR(floatIndex);\n      byteBuffer[bufferIndex + 1] = interG(floatIndex);\n      byteBuffer[bufferIndex + 2] = interB(floatIndex);\n      byteBuffer[bufferIndex + 3] = 255;\n      bufferIndex += 4;\n    }\n  };\n\n  buildStops(gradient);\n  buildBuffer();\n  return buffer;\n};\n\nexport const getBufferFromId = (id: number, res = 400) => {\n  return buildBufferFromStringGradient(res, standardGradients[id]);\n};\n","import { getBufferFromId } from \"../util/palette\";\nimport { Tile } from \"./tile\";\n\nexport interface PainterArgs {\n  offset: number;\n  density: number;\n  id: number;\n  fn: \"s\" | \"n\";\n}\n\nexport default class Painter {\n  public id: number = 0;\n  public offset: number = 0;\n  public fn: string = \"s\";\n  public density: number = 0;\n  private resolution: number = 0;\n  private buffer: Int32Array = new Int32Array();\n\n  constructor(p: PainterArgs) {\n    this.set(p);\n  }\n\n  set(p: any) {\n    if (\"fn\" in p) this.fn = p.fn;\n    if (\"offset\" in p) this.offset = p.offset;\n    if (\"density\" in p) this.density = p.density;\n    if (\"id\" in p) {\n      this.id = p.id;\n      this.buffer = getBufferFromId(p.id, 1000);\n      this.resolution = this.buffer.length;\n    }\n  }\n\n  // this function is not pure : it modifies buffer\n  // this function need maximum speed : it uses only vars\n  paint(tile: Tile, buffer: Uint32Array, width: number) {\n    var offset = this.offset * this.resolution;\n    var density = this.density,\n      resolution = this.resolution;\n    var cbuffer = this.buffer;\n    var tileIndex = 0;\n    var bufferIndex = 0;\n    var tx, ty, iter, color;\n\n    if (this.fn === \"s\") {\n      density = density * 7;\n      offset = ((this.offset + 0.85) % 1) * this.resolution;\n    }\n\n    for (ty = 0; ty < tile.height; ty += 1) {\n      bufferIndex = (ty + tile.y1) * width + tile.x1;\n      for (tx = 0; tx < tile.width; tx += 1) {\n        iter = tile.buffer[tileIndex];\n        if (iter === 0) {\n          color = 0xff000000;\n        } else {\n          if (this.fn === \"s\") {\n            iter = Math.sqrt(iter);\n          }\n          color = cbuffer[~~((iter * density + offset) % resolution)];\n        }\n        buffer[bufferIndex] = color;\n        tileIndex += 1;\n        bufferIndex += 1;\n      }\n    }\n  }\n}\n","export default class Vector {\n  public readonly x: number;\n  public readonly y: number;\n\n  constructor(x: Vector | number, y?: number) {\n    if (x instanceof Vector) {\n      this.x = x.x;\n      this.y = x.y;\n    } else {\n      this.x = x;\n      this.y = y as number;\n    }\n  }\n\n  midPoint(v2: Vector) {\n    return new Vector((v2.x + this.x) / 2, (v2.y + this.y) / 2);\n  }\n\n  minus(v: Vector) {\n    return new Vector(this.x - v.x, this.y - v.y);\n  }\n\n  plus(v: Vector) {\n    return new Vector(this.x + v.x, this.y + v.y);\n  }\n\n  times(v: Vector | number) {\n    return v instanceof Vector\n      ? new Vector(this.x * v.x, this.y * v.y)\n      : new Vector(this.x * v, this.y * v);\n  }\n\n  minVal() {\n    return Math.min(this.x, this.y);\n  }\n}\n","import Vector from \"./vector\";\n\nexport default class Matrix {\n  public static readonly identity = new Matrix(1, 0, 0, 1, 0, 0);\n\n  constructor(\n    public readonly a: number,\n    public readonly b: number,\n    public readonly c: number,\n    public readonly d: number,\n    public readonly e: number,\n    public readonly f: number,\n  ) {}\n\n  transform(v: Vector) {\n    return new Vector(\n      v.x * this.a + v.y * this.c + this.e,\n      v.x * this.b + v.y * this.d + this.f,\n    );\n  }\n\n  isIdentity() {\n    return (\n      this.a === 1 &&\n      this.b === 0 &&\n      this.c === 0 &&\n      this.d === 1 &&\n      this.e === 0 &&\n      this.f === 0\n    );\n  }\n\n  private isInvertible() {\n    const deter = this.a * this.d - this.b * this.c;\n    return Math.abs(deter) > 1e-15;\n  }\n\n  inverse() {\n    if (!this.isInvertible()) {\n      return this.inverseGaussJordan();\n    }\n    const dt = this.a * this.d - this.b * this.c;\n    return new Matrix(\n      this.d / dt,\n      -this.b / dt,\n      -this.c / dt,\n      this.a / dt,\n      (this.c * this.f - this.d * this.e) / dt,\n      -(this.a * this.f - this.b * this.e) / dt,\n    );\n  }\n\n  multiply(o: Matrix) {\n    return new Matrix(\n      this.a * o.a + this.c * o.b,\n      this.b * o.a + this.d * o.b,\n      this.a * o.c + this.c * o.d,\n      this.b * o.c + this.d * o.d,\n      this.a * o.e + this.c * o.f + this.e,\n      this.b * o.e + this.d * o.f + this.f,\n    );\n  }\n\n  private inverseGaussJordan() {\n    function gje(M: any, c1i: any, c2i: any, f: any) {\n      const c1 = M[c1i];\n      const c2 = M[c2i];\n      for (let i = 0; i < 6; i++) {\n        c1[i] += c2[i] * f;\n      }\n    }\n\n    function gjet(M: any, c1i: any, f: any) {\n      const c1 = M[c1i];\n      for (let i = 0; i < 6; i++) {\n        c1[i] *= f;\n      }\n    }\n    const M = [\n      [this.a, this.c, this.e, 1, 0, 0],\n      [this.b, this.d, this.f, 0, 1, 0],\n      [0, 0, 1, 0, 0, 1],\n    ];\n    gje(M, 1, 2, -M[1][2]); // c2 = c2 + c3 * -f\n    gje(M, 0, 2, -M[0][2]); // c1 = c1 + c3 * -e\n    gje(M, 1, 0, -M[1][0] / M[0][0]);\n    gje(M, 0, 1, -M[0][1] / M[1][1]);\n    gjet(M, 0, 1 / M[0][0]);\n    gjet(M, 1, 1 / M[1][1]);\n    return new Matrix(M[0][3], M[1][3], M[0][4], M[1][4], M[0][5], M[1][5]);\n  }\n\n  toString() {\n    return `${this.a} ${this.c} ${this.e}\\n${this.b} ${this.d} ${this.f}\\n0 0 1`;\n  }\n\n  // prettier-ignore\n  static GetTriangleToTriangle(\n    t1px: number, t1py: number, t1qx: number, t1qy: number, t1rx: number, t1ry: number,\n    t2px: number, t2py: number, t2qx: number, t2qy: number, t2rx: number, t2ry: number\n  ) {\n    const STD2T1 = new Matrix(t1px - t1rx, t1py - t1ry, t1qx - t1rx, t1qy - t1ry, t1rx, t1ry);\n    const STD2T2 = new Matrix(t2px - t2rx, t2py - t2ry, t2qx - t2rx, t2qy - t2ry, t2rx, t2ry);\n    const T12STD = STD2T1.inverse();\n    return STD2T2.multiply(T12STD);\n  }\n\n  static GetRotationMatrix(angle: number) {\n    const cos = Math.cos(angle);\n    const sin = Math.sin(angle);\n    return new Matrix(cos, sin, -sin, cos, 0, 0);\n  }\n\n  static GetScaleMatrix(x: number, y: number) {\n    return new Matrix(x, 0, 0, y, 0, 0);\n  }\n\n  static GetShearMatrix(x: number, y: number) {\n    return new Matrix(1, y, x, 1, 0, 0);\n  }\n}\n","import Matrix from \"./matrix\";\nimport Vector from \"./vector\";\n\n// prettier-ignore\nconst getSquareToComplexMatrix = (x: number, y: number, w: number) =>\n  Matrix.GetTriangleToTriangle(\n    1, 0, 0, 1, 0, 0,\n    x + w / 2, y, x, y + w / 2, x, y);\n\nexport type Affine = \"rotation\" | \"scale\" | \"shear\";\n\nconst getScreenToSquareMatrix = (\n  affineTransform: Matrix,\n  width: number,\n  height: number,\n) => {\n  const p = affineTransform.transform(new Vector(1, -1));\n  const q = affineTransform.transform(new Vector(-1, 1));\n  const r = affineTransform.transform(new Vector(-1, -1));\n  if (width >= height) {\n    const x1 = (width - height) / 2;\n    const x2 = x1 + height;\n    // prettier-ignore\n    return Matrix.GetTriangleToTriangle(\n      x2, height, x1, 0, x1, height,\n      p.x, p.y, q.x, q.y, r.x, r.y);\n  } else {\n    const y1 = (height - width) / 2;\n    const y2 = y1 + width;\n    // prettier-ignore\n    return Matrix.GetTriangleToTriangle(\n      width, y2, 0, y1, 0, y2,\n      p.x, p.y, q.x, q.y, r.x, r.y);\n  }\n};\n\n// The camera projects view space on complex space and vice-verse.\n// The \"square\" or Q is the maximum centered square that can be inscribed in the view.\n// X and Y are the complex coordinates @ the center of the view\n// W is the complex size of the square\n// A viewport affine transformation can be applied on the square to rotate/scale/shear the view\nexport default class Camera {\n  private matrix_inv: Matrix;\n  public matrix: Matrix;\n  public affineMatrix: Matrix;\n  public screen: Vector;\n  public resolutionLimit: number;\n  public pos: Vector;\n  public w: number;\n\n  constructor(\n    screenSize: Vector,\n    pos: Vector,\n    w: number,\n    affineMatrix = Matrix.identity,\n  ) {\n    this.affineMatrix = affineMatrix;\n    this.screen = screenSize;\n    const extent = screenSize.minVal();\n    this.resolutionLimit = extent * 1.11e-15;\n    this.pos = pos;\n    this.w = w;\n    this.matrix = Matrix.identity;\n    this.matrix_inv = Matrix.identity;\n    this.reproject();\n  }\n\n  reproject() {\n    this.w = Math.max(this.w, this.resolutionLimit);\n    const S2Q = getScreenToSquareMatrix(\n      this.affineMatrix,\n      this.screen.x,\n      this.screen.y,\n    );\n    const Q2C = getSquareToComplexMatrix(this.pos.x, this.pos.y, this.w);\n    this.matrix = Q2C.multiply(S2Q);\n    this.matrix_inv = this.matrix.inverse();\n  }\n\n  affineTransform(type: Affine, valuex: number, valuey?: number) {\n    let transform = Matrix.identity;\n    switch (type) {\n      case \"rotation\":\n        transform = Matrix.GetRotationMatrix(valuex);\n        break;\n      case \"shear\":\n        transform = Matrix.GetShearMatrix(valuex, valuey!);\n        break;\n      case \"scale\":\n        transform = Matrix.GetScaleMatrix(valuex, valuey!);\n        break;\n    }\n    this.affineMatrix = this.affineMatrix.multiply(transform);\n    this.reproject();\n  }\n\n  affineReset() {\n    this.affineMatrix = Matrix.identity;\n    this.reproject();\n  }\n\n  clone() {\n    return new Camera(this.screen, this.pos, this.w, this.affineMatrix);\n  }\n\n  scr2cpx(v: Vector) {\n    return this.matrix.transform(v);\n  }\n\n  cpx2scr(v: Vector) {\n    return this.matrix_inv.transform(v);\n  }\n\n  getPos() {\n    return this.pos;\n  }\n\n  setPos(pos: Vector, w?: number) {\n    this.pos = pos;\n    if (w) this.w = w;\n    this.reproject();\n  }\n\n  resize(width: number, height: number) {\n    this.screen = new Vector(width, height);\n    const extent = Math.min(width, height); // extent of the min square\n    this.resolutionLimit = extent * 1.11e-15;\n    this.reproject();\n  }\n\n  isZoomLimit() {\n    return this.w <= this.resolutionLimit;\n  }\n}\n","/* global navigator */\nimport EventBus from \"../util/EventBus\";\nimport Renderer from \"./renderer\";\nimport Painter, { PainterArgs } from \"./painter\";\nimport Camera from \"./math/camera\";\nimport Vector from \"./math/vector\";\nimport { Params } from \"./scheduler/types\";\nimport Matrix from \"./math/matrix\";\n\nexport interface Context {\n  readonly canvas: HTMLCanvasElement;\n  readonly context: CanvasRenderingContext2D;\n  readonly event: EventBus;\n  readonly nbThreads: number;\n  readonly camera: Camera;\n  smooth: boolean;\n  iter: number;\n  fractalId: string;\n}\n\ninterface EngineInit {\n  canvas: HTMLCanvasElement;\n  x: number;\n  y: number;\n  w: number;\n  viewport?: Matrix;\n  painter: PainterArgs;\n  fractalId: string;\n  smooth: boolean;\n  iter: number;\n}\n\nexport default class Engine {\n  public readonly ctx: Context;\n  public readonly painter: Painter;\n\n  private renderer: Renderer;\n\n  constructor(p: EngineInit) {\n    let nbThreads = navigator.hardwareConcurrency || 4;\n    if (nbThreads >= 6) nbThreads--; // sacrifice a thread for responsiveness if we have enough\n    this.ctx = {\n      // readonly\n      canvas: p.canvas,\n      context: p.canvas.getContext(\"2d\") as CanvasRenderingContext2D,\n      nbThreads,\n      event: new EventBus(),\n      camera: new Camera(\n        new Vector(p.canvas.width, p.canvas.height),\n        new Vector(p.x, p.y),\n        p.w,\n        p.viewport,\n      ),\n      // changeable\n      smooth: p.smooth,\n      iter: p.iter,\n      fractalId: p.fractalId,\n    };\n    this.painter = new Painter(p.painter);\n    this.renderer = new Renderer(this.ctx, this.painter, this);\n  }\n\n  get canvas() {\n    return this.ctx.canvas;\n  }\n\n  // realtime modification of engine parameters\n  set(p: any) {\n    if (\"fractalId\" in p) this.ctx.fractalId = p.fractalId;\n    if (\"smooth\" in p) this.ctx.smooth = p.smooth;\n    if (\"iter\" in p) this.ctx.iter = p.iter;\n    if (\"x\" in p) this.ctx.camera.setPos(new Vector(p.x, p.y), p.w);\n    if (\"painter\" in p) {\n      this.painter.set(p.painter);\n    }\n  }\n\n  async draw(params?: Params) {\n    if (!params) params = { details: \"normal\" };\n    const start = new Date().getTime();\n    const res = await this.renderer.draw(params);\n    const end = new Date().getTime();\n    const time = end - start;\n    console.log(`Frame '${params.details}' drawn in ${time}ms`);\n    return res;\n  }\n\n  drawColor() {\n    this.renderer.drawColor();\n  }\n\n  resize(width: number, height: number) {\n    this.ctx.camera.resize(width, height);\n    this.renderer.resize();\n  }\n\n  getHistogram() {\n    return this.renderer.getHistogram();\n  }\n\n  getIterationsAt(cpx: Vector) {\n    return this.renderer.getIterationsAt(cpx);\n  }\n}\n","import { createSlice } from \"@reduxjs/toolkit\";\n\nconst ui = createSlice({\n  name: \"set\",\n  initialState: {\n    fractalId: \"mandelbrot\",\n    smooth: true,\n    x: 0,\n    y: 0,\n    w: 0,\n    iter: 0,\n  },\n  reducers: {\n    setSet: (state, action) => action.payload,\n    updateSet: (state, action) => ({ ...state, ...action.payload }),\n  },\n});\n\nexport const { reducer, actions } = ui;\nexport const { setSet, updateSet } = actions;\n","const map: { [key: string]: number } = {\n  left: 37,\n  up: 38,\n  right: 39,\n  down: 40,\n  \"+\": 107,\n  \"-\": 109,\n  esc: 27,\n  A: 65,\n  B: 66,\n  C: 67,\n  D: 68,\n  E: 69,\n  F: 70,\n  G: 71,\n  H: 72,\n  I: 73,\n  J: 74,\n  K: 75,\n  L: 76,\n  M: 77,\n  N: 78,\n  O: 79,\n  P: 80,\n  Q: 81,\n  R: 82,\n  S: 83,\n  T: 84,\n  U: 85,\n  V: 86,\n  W: 87,\n  X: 88,\n  Y: 89,\n  Z: 90,\n};\n\ntype Callback = (mod: number) => void;\ninterface Binding {\n  combo: number[];\n  func: Callback;\n}\n\nconst keymap: boolean[] = [];\nconst bindings: Binding[] = [];\n\ndocument.addEventListener(\"keyup\", evt => {\n  keymap[evt.keyCode] = false;\n});\n\ndocument.addEventListener(\"keydown\", evt => {\n  keymap[evt.keyCode] = true;\n  const modifier = evt.shiftKey ? 1 / 10 : 1;\n  for (const binding of bindings) {\n    const match = binding.combo.every(k => keymap[k]);\n    if (match) {\n      binding.func(modifier);\n      return;\n    }\n  }\n});\n\nexport const bindKeys = (keysStr: string, func: Callback) => {\n  const keys = keysStr.split(\" \");\n  const keycodes: number[] = [];\n  for (const key of keys) {\n    if (!(key in map)) throw new Error(`Unknown key${key}`);\n    keycodes.push(map[key]);\n  }\n  bindings.push({ combo: keycodes, func });\n  bindings.sort((a, b) => b.combo.length - a.combo.length);\n};\n","import Vector from \"../engine/math/vector\";\nimport Camera, { Affine } from \"../engine/math/camera\";\nimport { Dispatch } from \"@reduxjs/toolkit\";\nimport { changeXY } from \"./rdxengine\";\nimport Hammer from \"hammerjs\";\nimport Matrix from \"../engine/math/matrix\";\nimport { bindKeys } from \"../util/keybinder\";\nimport Engine from \"../engine/engine\";\n\nconst ZOOM = 1.3;\nconst ZOOM_TAP = 2.5;\nconst PAN = 0.1;\nconst SCALE = 0.1; // 1+\nconst SHEAR = 0.1;\nconst ANGLE = Math.PI / 18;\n\nexport default class Controller {\n  private engine: Engine;\n  private camera: Camera;\n\n  constructor(engine: Engine, private dispatch: Dispatch<any>) {\n    this.engine = engine;\n    this.camera = engine.ctx.camera;\n    this.setupKeyboard();\n    this.setupMouse();\n    this.setupTouch();\n  }\n\n  // pan the screen by the given vector (as a ratio of its size)\n  pan(scr_vector_delta: Vector) {\n    const cam = this.camera;\n    const scr_vector = cam.screen.times(scr_vector_delta);\n    const cpx_point_0 = cam.scr2cpx(new Vector(0, 0));\n    const cpx_point_dest = cam.scr2cpx(scr_vector);\n    const cpx_vector = cpx_point_0.minus(cpx_point_dest);\n    const cpx_new_point = cam.getPos().plus(cpx_vector);\n    this.dispatch(changeXY(cpx_new_point));\n  }\n\n  // transforms the current viewport\n  affineTransform(type: Affine, valuex: number, valuey?: number) {\n    this.camera.affineTransform(type, valuex, valuey);\n    this.engine.draw();\n  }\n\n  affineReset() {\n    this.camera.affineReset();\n    this.engine.draw();\n  }\n\n  // zoom the screen at the given screen point, using the given delta ratio\n  zoom(delta: number, scr_point_arg?: Vector) {\n    const cam = this.camera;\n    if (delta < 1 && cam.isZoomLimit()) {\n      this.engine.ctx.event.notify(\"zoom.limit\");\n      return;\n    }\n    // zoom @ center of screen by default\n    const scr_point = scr_point_arg || cam.screen.times(0.5);\n    const cpx_point = cam.scr2cpx(scr_point);\n    const cpx_center = cam.getPos();\n    // complex vector from point to view center\n    const cpx_vector = cpx_center.minus(cpx_point);\n    // scale vector and compute new center\n    const cpx_new_point = cpx_point.plus(cpx_vector.times(delta));\n    this.dispatch(changeXY(cpx_new_point, cam.w * delta));\n  }\n\n  setupKeyboard() {\n    bindKeys(\"up\", (Î”: number) => this.pan(new Vector(0, PAN * Î”)));\n    bindKeys(\"down\", (Î”: number) => this.pan(new Vector(0, -PAN * Î”)));\n    bindKeys(\"right\", (Î”: number) => this.pan(new Vector(-PAN * Î”, 0)));\n    bindKeys(\"left\", (Î”: number) => this.pan(new Vector(PAN * Î”, 0)));\n    bindKeys(\"+\", (Î”: number) => this.zoom(1 / (ZOOM * Î”)));\n    bindKeys(\"-\", (Î”: number) => this.zoom(ZOOM * Î”));\n    bindKeys(\"V\", () => this.affineReset());\n    bindKeys(\"R left\", (Î”: number) =>\n      this.affineTransform(\"rotation\", -ANGLE * Î”),\n    );\n    bindKeys(\"R right\", (Î”: number) =>\n      this.affineTransform(\"rotation\", +ANGLE * Î”),\n    );\n    bindKeys(\"S right\", (Î”: number) =>\n      this.affineTransform(\"scale\", 1 / (1 + SCALE * Î”), 1),\n    );\n    bindKeys(\"S left\", (Î”: number) =>\n      this.affineTransform(\"scale\", 1 + SCALE * Î”, 1),\n    );\n    bindKeys(\"S up\", (Î”: number) =>\n      this.affineTransform(\"scale\", 1, 1 / (1 + SCALE * Î”)),\n    );\n    bindKeys(\"S down\", (Î”: number) =>\n      this.affineTransform(\"scale\", 1, 1 + SCALE * Î”),\n    );\n    bindKeys(\"H right\", (Î”: number) =>\n      this.affineTransform(\"shear\", -SHEAR * Î”, 0),\n    );\n    bindKeys(\"H left\", (Î”: number) =>\n      this.affineTransform(\"shear\", SHEAR * Î”, 0),\n    );\n    bindKeys(\"H up\", (Î”: number) =>\n      this.affineTransform(\"shear\", 0, -SHEAR * Î”),\n    );\n    bindKeys(\"H down\", (Î”: number) =>\n      this.affineTransform(\"shear\", 0, SHEAR * Î”),\n    );\n  }\n\n  setupTouch() {\n    var hammer = new Hammer(this.engine.canvas, {});\n    let isDragging = false;\n    let dragStart: Vector;\n    let cameraStart: Camera;\n\n    hammer.get(\"pan\").set({\n      direction: Hammer.DIRECTION_ALL,\n      threshold: 1,\n    });\n    hammer.get(\"pinch\").set({\n      enable: true,\n    });\n\n    hammer.on(\"doubletap\", (evt) => {\n      // console.log(\"double\", evt);\n      const pos = new Vector(evt.center.x, evt.center.y);\n      this.zoom(1 / ZOOM_TAP, new Vector(pos));\n    });\n\n    hammer.on(\"panstart\", (evt) => {\n      isDragging = true;\n      dragStart = new Vector(evt.center.x, evt.center.y);\n      cameraStart = this.camera.clone();\n    });\n\n    hammer.on(\"panend\", (evt) => {\n      isDragging = false;\n    });\n\n    hammer.on(\"panmove\", (evt) => {\n      if (isDragging) {\n        const pos = new Vector(evt.center.x, evt.center.y);\n        const scr_vector = pos.minus(dragStart);\n        const cpx_point_0 = cameraStart.scr2cpx(new Vector(0, 0));\n        const cpx_point_dest = cameraStart.scr2cpx(scr_vector);\n        const cpx_vector = cpx_point_dest.minus(cpx_point_0);\n        const cpx_new = cameraStart.getPos().minus(cpx_vector);\n        this.dispatch(changeXY(cpx_new));\n      }\n    });\n\n    var isPinching = false;\n    let pinchStart: Vector;\n\n    hammer.on(\"pinchstart\", (ev) => {\n      console.log(\"pinchstart\");\n      isPinching = true;\n      pinchStart = new Vector(ev.center.x, ev.center.y);\n      cameraStart = this.camera.clone();\n    });\n\n    hammer.on(\"pinchend\", function (ev) {\n      console.log(\"pinchend\");\n      isPinching = false;\n    });\n\n    hammer.on(\"pinch\", (ev) => {\n      if (isPinching) {\n        // compute matrix that transforms an original triangle to the transformed triangle\n        var pc1 = cameraStart.scr2cpx(pinchStart);\n        var pc2 = cameraStart.scr2cpx(new Vector(ev.center.x, ev.center.y));\n        var m = Matrix.GetTriangleToTriangle(\n          pc1.x,\n          pc1.y,\n          pc1.x + 1,\n          pc1.y,\n          pc1.x,\n          pc1.y + 1,\n          pc2.x,\n          pc2.y,\n          pc2.x + ev.scale,\n          pc2.y,\n          pc2.x,\n          pc2.y + ev.scale,\n        );\n\n        // apply inverse of this matrix to starting point\n        var pc0A = m.inverse().transform(cameraStart.pos);\n\n        let z = cameraStart.w / m.a;\n        if (z < this.camera.resolutionLimit) {\n          this.engine.ctx.event.notify(\"zoom.limit\");\n          z = this.camera.resolutionLimit;\n        }\n        this.dispatch(changeXY(pc0A, z));\n      }\n    });\n  }\n\n  setupMouse() {\n    const canvas = this.engine.canvas;\n\n    // disable mouse pan because it is handled by hammer\n    // let isDragging = false;\n    // let dragStart: Vector;\n    // let cameraStart: Camera;\n\n    // canvas.addEventListener(\"mousedown\", (e: MouseEvent) => {\n    //   const evt = e || window.event;\n    //   if (evt.button !== 0) return;\n    //   isDragging = true;\n    //   dragStart = new Vector(evt.screenX, evt.screenY);\n    //   cameraStart = this.camera.clone();\n    // });\n\n    // window.addEventListener(\"mouseup\", () => {\n    //   isDragging = false;\n    // });\n\n    // window.addEventListener(\"mousemove\", e => {\n    //   const evt = e || window.event;\n    //   if (isDragging) {\n    //     console.log(\"mousemove\", e);\n    //     const pos = new Vector(evt.screenX, evt.screenY);\n    //     const scr_vector = pos.minus(dragStart);\n    //     const cpx_point_0 = cameraStart.scr2cpx(new Vector(0, 0));\n    //     const cpx_point_dest = cameraStart.scr2cpx(scr_vector);\n    //     const cpx_vector = cpx_point_dest.minus(cpx_point_0);\n    //     const cpx_new = cameraStart.getPos().minus(cpx_vector);\n    //     this.dispatch(changeXY(cpx_new));\n    //   }\n    // });\n\n    const wheelFunction = (e: WheelEvent) => {\n      const evt = e || window.event;\n      evt.preventDefault();\n      const modifier = evt.shiftKey ? 1 / 10 : 1;\n      let delta = evt.deltaY;\n      delta = delta > 0 ? ZOOM * modifier : 1 / (ZOOM * modifier);\n      const point = new Vector(evt.offsetX, evt.offsetY);\n      this.zoom(delta, point);\n    };\n\n    canvas.addEventListener(\"wheel\", wheelFunction);\n  }\n}\n","import { updateSet } from \"./set\";\nimport { Dispatch } from \"@reduxjs/toolkit\";\nimport Engine from \"../engine/engine\";\nimport { Root } from \"./reducer\";\nimport { param } from \"../params\";\n\n/*\nThe improver hijacks engine to use a more complex rendering; so it's\nimplemented as a function and a closure instead of a class (whose 'this'\nwould have been messy)\n*/\nexport default function Improver(\n  engineArg: Engine,\n  dispatch: Dispatch<any>,\n  getState: () => Root,\n) {\n  const engine = engineArg;\n  const draw = engine.draw.bind(engine);\n  let frameId = 0;\n  let lastState = \"\";\n\n  const sleep = (duration: number) =>\n    new Promise(resolve => setTimeout(() => resolve(), duration));\n\n  // compute number of pixels in 10% fringe and trigger a redrawing if this\n  // number is above a threshold\n  const analysePicture2 = () => {\n    const histo = engine.getHistogram();\n    const nbPixels = engine.ctx.camera.screen.x * engine.ctx.camera.screen.y;\n    const iter = engine.ctx.iter;\n    let nb = 0;\n    for (let i = Math.round(iter * 0.9); i <= iter; i += 1) {\n      nb += histo[i];\n    }\n    const perc = (100 * nb) / nbPixels;\n    const shouldIncrease = perc > 0.2;\n    const shouldDecrease = perc < 0.05;\n    const txt = `10% fringe is ${nb}px or ${perc.toFixed(2)}%`;\n    return { shouldIncrease, shouldDecrease, txt };\n  };\n\n  // @ts-ignore\n  engine.draw = async () => {\n    try {\n      // ID detects when a rendering is interrupted\n      frameId += 1;\n      const id = frameId;\n\n      // state detects when the fractal is drew afresh, needing a coarse rendering first\n      const state = engine.ctx.fractalId + engine.ctx.smooth;\n      if (state !== lastState) {\n        await draw({ details: \"subsampling\", size: 4 });\n        if (frameId !== id) return;\n      }\n      lastState = state;\n\n      // perform a normal drawing\n      await draw({ details: \"normal\", id });\n      if (frameId !== id) return;\n\n      // analyze, then increase iterations if needed\n      let analysis: any = analysePicture2();\n      while (analysis.shouldIncrease) {\n        const newIter = Math.round(engine.ctx.iter * 1.5);\n        // console.log(`+ iter ${engine.ctx.iter} -> ${newIter}: ${analysis.txt}`);\n        dispatch(updateSet({ iter: newIter }));\n        engine.ctx.iter = newIter;\n        await draw({ details: \"normal\", id });\n        if (frameId !== id) return;\n        analysis = analysePicture2();\n      }\n      if (analysis.shouldDecrease) {\n        const newIter = Math.round(Math.max(50, engine.ctx.iter / 1.5));\n        // console.log(`- iter ${engine.ctx.iter} -> ${newIter}: ${analysis.txt}`);\n        dispatch(updateSet({ iter: newIter }));\n        engine.ctx.iter = newIter;\n      }\n\n      // wait one sec, then supersample\n      if (param.supersampling) {\n        await sleep(1000);\n        if (frameId !== id) return;\n        await draw({ details: \"supersampling\", size: 4, id });\n      }\n    } catch (err) {\n      // ignore interrupted frames\n    }\n  };\n}\n","import { createSlice } from \"@reduxjs/toolkit\";\n\nconst ui = createSlice({\n  name: \"colors\",\n  initialState: {\n    offset: 0,\n    id: 0,\n    density: 20, // 0.05 - 20\n    fn: \"s\",\n  },\n  reducers: {\n    setColorId: (state, action) => ({ ...state, id: action.payload }),\n    setOffset: (state, action) => ({ ...state, offset: action.payload }),\n    setDensity: (state, action) => ({ ...state, density: action.payload }),\n    setPaint: (state, action) => ({ ...state, ...action.payload }),\n  },\n});\n\nexport const { reducer, actions } = ui;\nexport const { setOffset, setColorId, setDensity, setPaint } = actions;\n","import Matrix from \"../engine/math/matrix\";\nimport { Dispatch } from \"@reduxjs/toolkit\";\nimport { setOffset, setDensity, setColorId } from \"./colors\";\nimport { setSet } from \"./set\";\nimport omit from \"lodash/omit\";\nimport { getPreset } from \"../engine/fractals\";\nimport Engine from \"../engine/engine\";\nimport { PainterArgs } from \"../engine/painter\";\n\ninterface UrlOutputObject {\n  painter: PainterArgs;\n  desc: {\n    x: number;\n    y: number;\n    w: number;\n    iter: number;\n    fractalId: string;\n    smooth: boolean;\n    viewport: Matrix;\n  };\n}\n\nconst defaults: any = {\n  t: \"mandelbrot\",\n  i: \"50\",\n  fs: \"1\",\n  ct: \"0\",\n  co: \"0\",\n  cd: \"20\",\n  cf: \"n\",\n  va: \"1.0000\",\n  vb: \"0.0000\",\n  vc: \"0.0000\",\n  vd: \"1.0000\",\n};\n\nexport const update = (engine: Engine) => {\n  const camera = engine.ctx.camera;\n  const painter = engine.painter;\n  try {\n    const args: any = {};\n    // engine\n    args.t = engine.ctx.fractalId;\n    args.x = camera.pos.x;\n    args.y = camera.pos.y;\n    args.w = camera.w;\n    args.i = String(engine.ctx.iter);\n    args.fs = engine.ctx.smooth ? \"1\" : \"0\";\n    // painter\n    args.ct = String(painter.id);\n    args.co = String(Math.round(painter.offset * 100));\n    args.cd = String(+painter.density.toFixed(2));\n    args.cf = painter.fn;\n    // affine matrix\n    args.va = camera.affineMatrix.a.toFixed(4);\n    args.vb = camera.affineMatrix.b.toFixed(4);\n    args.vc = camera.affineMatrix.c.toFixed(4);\n    args.vd = camera.affineMatrix.d.toFixed(4);\n    // remove args with default values\n    for (let key in args) if (args[key] === defaults[key]) delete args[key];\n    // build url\n    const str = Object.entries(args)\n      .map(([k, v]) => `${k}_${v}`)\n      .join(\"&\");\n    window.history.replaceState(\"\", \"\", `#B${str}`);\n  } catch (e) {\n    console.error(\"Could not set URL\", e);\n  }\n};\n\nfunction readCurrentScheme(url: string): UrlOutputObject {\n  // parse url\n  const str = url.substr(2);\n  const rawArgs: any = str.split(\"&\").reduce((acc, tuple) => {\n    const parts = tuple.split(\"_\");\n    return Object.assign(acc, { [parts[0]]: parts[1] });\n  }, {});\n  // add default arguments\n  const args = { ...defaults, ...rawArgs };\n  // build objet\n  const desc = {\n    x: parseFloat(args.x),\n    y: parseFloat(args.y),\n    w: parseFloat(args.w),\n    iter: parseInt(args.i),\n    fractalId: args.t,\n    smooth: parseInt(args.fs) === 1,\n    viewport: Matrix.identity,\n  };\n  desc.viewport = new Matrix(\n    parseFloat(args.va),\n    parseFloat(args.vb),\n    parseFloat(args.vc),\n    parseFloat(args.vd),\n    0,\n    0,\n  );\n  const painter = {\n    offset: parseInt(args.co) / 100.0,\n    density: parseFloat(args.cd),\n    id: parseInt(args.ct, 10),\n    fn: args.cf,\n  };\n  return { desc, painter };\n}\n\nexport const read = (): UrlOutputObject | null => {\n  try {\n    const url = document.location.hash;\n    if (url.startsWith(\"#B\")) {\n      return readCurrentScheme(url);\n    }\n  } catch (e) {\n    console.error(\"Could not read URL\", e);\n  }\n  return null;\n};\n\nexport const readInit = (\n  dispatch: Dispatch<any>,\n  forceCold = false,\n): UrlOutputObject => {\n  const urlData = read();\n  if (!urlData || forceCold) {\n    // coldstart\n    let desc = {\n      ...getPreset(\"mandelbrot\"),\n      smooth: true,\n      viewport: Matrix.identity,\n    };\n    let painter: PainterArgs = {\n      offset: 0,\n      density: 20,\n      id: 0,\n      fn: \"s\",\n    };\n    dispatch(setSet(omit(desc, \"viewport\")));\n    dispatch(setColorId(painter.id));\n    dispatch(setOffset(0));\n    dispatch(setDensity(20));\n    return { desc, painter };\n  } else {\n    const { desc, painter } = urlData;\n    dispatch(setSet(omit(urlData.desc, \"viewport\")));\n    dispatch(setColorId(painter.id));\n    dispatch(setOffset(painter.offset));\n    dispatch(setDensity(painter.density));\n    return {\n      desc,\n      painter,\n    };\n  }\n};\n","import { createSlice } from \"@reduxjs/toolkit\";\n\ntype Tab = \"settings\" | \"fractal\" | \"palette\" | \"about\" | \"social\" | \"debug\";\ninterface Int {\n  drawer: boolean;\n  infobox: boolean;\n  mouseOnCanvas: boolean;\n  narrowDevice: boolean; // less than 450 px\n  tab: Tab;\n  snack?: string;\n  mouse: {\n    x: number;\n    y: number;\n    iter: number;\n  };\n}\n\nconst ui = createSlice({\n  name: \"ui\",\n  initialState: {\n    drawer: false,\n    mouseOnCanvas: false,\n    tab: \"fractal\",\n    infobox: false,\n    mouse: { x: 0, y: 0, iter: 0 },\n    narrowDevice: false,\n    orientableDevice: false,\n  } as Int,\n  reducers: {\n    setDrawer: (state, action) => ({ ...state, drawer: action.payload }),\n    setTab: (state, action) => ({ ...state, tab: action.payload }),\n    setInfobox: (state, action) => ({ ...state, infobox: action.payload }),\n    setMouseOnCanvas: (state, action) => ({\n      ...state,\n      mouseOnCanvas: action.payload,\n    }),\n    setMouseInfo: (state, action) => ({ ...state, mouse: action.payload }),\n    setNarrowDevice: (state, action) => ({\n      ...state,\n      narrowDevice: action.payload,\n    }),\n    setSnack: (state, action) => ({ ...state, snack: action.payload }),\n  },\n});\n\nexport const { reducer, actions } = ui;\nexport const {\n  setDrawer,\n  setTab,\n  setInfobox,\n  setMouseOnCanvas,\n  setMouseInfo,\n  setSnack,\n  setNarrowDevice,\n} = actions;\n","import { Dispatch } from \"@reduxjs/toolkit\";\nimport { Root } from \"./reducer\";\nimport Engine from \"../engine/engine\";\nimport { updateSet } from \"./set\";\nimport Controller from \"./controller\";\nimport Improver from \"./improver\";\nimport * as url from \"./url\";\nimport throttle from \"lodash/throttle\";\nimport debounce from \"lodash/debounce\";\nimport Vector from \"../engine/math/vector\";\nimport {\n  setMouseOnCanvas,\n  setMouseInfo,\n  setInfobox,\n  setDrawer,\n  setSnack,\n  setNarrowDevice,\n  setTab,\n} from \"./ui\";\nimport * as colorActions from \"./colors\";\nimport { getPreset } from \"../engine/fractals\";\nimport { bindKeys } from \"../util/keybinder\";\n\nlet engine: Engine;\n\nexport const getEngine = () => engine;\n\nexport const initEngine = (canvas: HTMLCanvasElement): any => async (\n  dispatch: Dispatch<any>,\n  getState: () => Root,\n) => {\n  // ---- init global keyboard shortcuts\n  bindKeys(\"I\", () => dispatch(setInfobox(!getState().ui.infobox)));\n  bindKeys(\"esc\", () => dispatch(setDrawer(!getState().ui.drawer)));\n  bindKeys(\"D\", () => {\n    dispatch(setDrawer(true));\n    dispatch(setTab(\"debug\"));\n  });\n\n  // ---- init window size & capture resize events\n  const getWindowSize = () => [window.innerWidth, window.innerHeight];\n  [canvas.width, canvas.height] = getWindowSize();\n  window.addEventListener(\"resize\", () => {\n    [canvas.width, canvas.height] = getWindowSize();\n    engine.resize(canvas.width, canvas.height);\n    engine.draw();\n  });\n\n  // ---- update ui.smallDevice boolean when device (or orientation) changes\n  const onMediaChange = (media: any) =>\n    dispatch(setNarrowDevice(media.matches));\n  const matchMedia = window.matchMedia(\"(max-width: 450px)\");\n  onMediaChange(matchMedia);\n  matchMedia.addListener(onMediaChange);\n\n  window.addEventListener(\n    \"error\",\n    debounce(() => {\n      console.error(\"error caught, resetting engine\");\n      const init = url.readInit(dispatch, true);\n      engine.set({ ...init });\n      engine.draw();\n    }, 200),\n  );\n\n  // ---- capture canvas enter & leave events for infobox\n  canvas.addEventListener(\"mouseenter\", () => {\n    dispatch(setMouseOnCanvas(true));\n  });\n  canvas.addEventListener(\"mouseleave\", () => {\n    dispatch(setMouseOnCanvas(false));\n  });\n  canvas.addEventListener(\n    \"mousemove\",\n    throttle(evt => {\n      const cpx = engine.ctx.camera.scr2cpx(\n        new Vector(evt.offsetX, evt.offsetY),\n      );\n      const iter = engine.getIterationsAt(cpx);\n      dispatch(setMouseInfo({ x: cpx.x, y: cpx.y, iter }));\n    }, 50), // 20 fps max\n  );\n\n  // ---- read URL and infer start params\n  const { desc, painter } = url.readInit(dispatch);\n  engine = new Engine({ ...desc, painter, canvas });\n  // @ts-ignore\n  window.engine = engine;\n\n  const urlUpdate = debounce(() => {\n    url.update(engine);\n  }, 250);\n  engine.ctx.event.on(\"draw.start\", urlUpdate);\n  engine.ctx.event.on(\"draw.redraw\", urlUpdate);\n  engine.ctx.event.on(\"zoom.limit\", () => {\n    dispatch(setSnack(\"Sorry, FractalJS cannot zoom further...\"));\n  });\n  engine.ctx.event.on(\n    \"zoom.limit\",\n    debounce(() => {\n      dispatch(setSnack(undefined));\n    }, 5000),\n  );\n\n  new Controller(engine, dispatch);\n  Improver(engine, dispatch, getState); // add improvement capabilities\n  engine.draw();\n};\n\nexport const changeFractalType = (type: string): any => async (\n  dispatch: Dispatch<any>,\n  getState: () => Root,\n) => {\n  const setValues = getPreset(type);\n  dispatch(updateSet(setValues));\n  engine.ctx.camera.affineReset();\n  dispatch(colorActions.setPaint({ density: 20 }));\n  engine.painter.set({ density: 20 });\n  engine.set(setValues);\n  engine.draw();\n};\n\nexport const changeSmooth = (smooth: boolean): any => async (\n  dispatch: Dispatch<any>,\n  getState: () => Root,\n) => {\n  dispatch(updateSet({ smooth }));\n  engine.set({ smooth });\n  engine.draw();\n};\n\nexport const changeXY = (pt: Vector, w?: number): any => async (\n  dispatch: Dispatch<any>,\n) => {\n  if (w === undefined) {\n    dispatch(updateSet({ x: pt.x, y: pt.y }));\n    engine.ctx.camera.setPos(pt);\n  } else {\n    dispatch(updateSet({ x: pt.x, y: pt.y, w }));\n    engine.ctx.camera.setPos(pt, w);\n  }\n  engine.draw();\n};\n\nexport const setColorOffset = (val: number): any => async (\n  dispatch: Dispatch<any>,\n) => {\n  dispatch(colorActions.setOffset(val));\n  engine.painter.set({ offset: val });\n  engine.drawColor();\n};\n\nexport const setColorDensity = (val: number): any => async (\n  dispatch: Dispatch<any>,\n  getState: () => Root,\n) => {\n  dispatch(colorActions.setDensity(val));\n  engine.painter.set({ density: getState().colors.density });\n  engine.drawColor();\n};\n\nexport const setColorId = (id: number): any => async (\n  dispatch: Dispatch<any>,\n  getState: () => Root,\n) => {\n  dispatch(colorActions.setPaint({ id, fn: \"s\" }));\n  engine.painter.set({ id, fn: \"s\" });\n  engine.drawColor();\n};\n","import React from \"react\";\nimport List from \"@material-ui/core/List\";\nimport ListItem from \"@material-ui/core/ListItem\";\nimport ListItemText from \"@material-ui/core/ListItemText\";\nimport ListSubheader from \"@material-ui/core/ListSubheader\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { changeFractalType } from \"../../redux/rdxengine\";\nimport { Root } from \"../../redux/reducer\";\nimport { listForUi } from \"../../engine/fractals\";\nimport Button from \"@material-ui/core/Button\";\nimport { makeStyles } from \"@material-ui/core/styles\";\n\nconst useStyles = makeStyles(theme => ({\n  swatches: {\n    display: \"flex\",\n    flexWrap: \"wrap\",\n    marginLeft: -theme.spacing(1),\n    \"& > *\": {\n      \"& > *\": {\n        textTransform: \"none\",\n        width: \"100%\",\n      },\n      width: \"50%\",\n      paddingLeft: theme.spacing(1),\n      paddingBottom: theme.spacing(1),\n    },\n  },\n}));\n\nfunction Fractal() {\n  const classes = useStyles();\n  const dispatch = useDispatch();\n  const type = useSelector((state: Root) => state.set.fractalId);\n\n  const buttons = listForUi().map(o => {\n    return (\n      <div key={o.fractalId}>\n        <Button\n          variant={type === o.fractalId ? \"contained\" : \"outlined\"}\n          color={type === o.fractalId ? \"primary\" : \"default\"}\n          onClick={() => dispatch(changeFractalType(o.fractalId))}\n        >\n          {o.name}\n        </Button>\n      </div>\n    );\n  });\n  return (\n    <div>\n      <List\n        component=\"nav\"\n        subheader={\n          <ListSubheader component=\"div\">Pick a fractal set</ListSubheader>\n        }\n      >\n        <ListItem>\n          <div className={classes.swatches}>{buttons}</div>\n        </ListItem>\n      </List>\n    </div>\n  );\n}\n\nexport default Fractal;\n","import React from \"react\";\nimport throttle from \"lodash/throttle\";\nimport Slider from \"@material-ui/core/Slider\";\nimport List from \"@material-ui/core/List\";\nimport ListItem from \"@material-ui/core/ListItem\";\nimport ListSubheader from \"@material-ui/core/ListSubheader\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { Root } from \"../../redux/reducer\";\nimport {\n  setColorOffset,\n  setColorDensity,\n  setColorId,\n} from \"../../redux/rdxengine\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { getBufferFromId } from \"../../util/palette\";\nimport { Typography } from \"@material-ui/core\";\n\nconst DENSITY = (20 * 20) ** (1 / 100);\n\nconst gradients = (() => {\n  const res: { id: number; dataURL: string }[] = [];\n  const WIDTH = 100;\n  const HEIGHT = 50;\n  const RES = WIDTH;\n  const canvas = document.createElement(\"canvas\") as HTMLCanvasElement;\n  const context = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\n  canvas.width = WIDTH;\n  canvas.height = HEIGHT;\n  const imageData = context.createImageData(canvas.width, canvas.height);\n  const imageBuffer = new Uint32Array(imageData.data.buffer);\n  [0, 2, 3, 4, 5, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19].forEach((id) => {\n    const colorBuffer = getBufferFromId(id, RES);\n    for (let i = 0; i < WIDTH; i += 1) {\n      for (let j = 0; j < HEIGHT; j += 1) {\n        imageBuffer[j * WIDTH + i] =\n          colorBuffer[Math.round(i * 0.6 + j * 0.6) % RES];\n      }\n    }\n    context.putImageData(imageData, 0, 0, 0, 0, canvas.width, canvas.height);\n    const dataURL = canvas.toDataURL(\"image/png\");\n    res.push({ id, dataURL });\n  });\n  return res;\n})();\n\nconst useStyles = makeStyles((theme) => ({\n  swatches: {\n    display: \"flex\",\n    flexWrap: \"wrap\",\n    marginRight: -theme.spacing(1),\n    \"& > *\": {\n      paddingBottom: theme.spacing(1),\n      paddingRight: theme.spacing(1),\n      width: \"20%\",\n      height: \"56px\",\n      position: \"relative\",\n      \"& > img\": {\n        width: \"100%\",\n        height: \"100%\",\n        borderRadius: \"4px\",\n      },\n      \"& > i\": {\n        position: \"absolute\",\n        bottom: 0,\n        right: 0,\n        color: \"white\",\n        fontSize: \"36px\",\n        padding: \"0px\",\n        textShadow: \"2px 2px 2px #888\",\n      },\n    },\n  },\n  txt: {\n    width: \"100px\",\n  },\n}));\n\nfunction Palette() {\n  const classes = useStyles();\n  const dispatch = useDispatch();\n  const colors = useSelector((state: Root) => state.colors);\n  const swatches = gradients.map((gradient) => (\n    <div key={gradient.id} onClick={() => dispatch(setColorId(gradient.id))}>\n      <img alt=\"\" src={gradient.dataURL} />\n      {colors.id === gradient.id ? (\n        <i className=\"material-icons\">check_circle</i>\n      ) : null}\n    </div>\n  ));\n\n  const densitySlider = Math.log(20 * colors.density) / Math.log(DENSITY);\n  const getDensity = (val: number) => (1 / 20) * DENSITY ** val;\n\n  return (\n    <div>\n      <List component=\"nav\" dense>\n        <ListSubheader component=\"div\">\n          Pick & adjust a color palette\n        </ListSubheader>\n        <ListItem>\n          <div className={classes.swatches}>{swatches}</div>\n        </ListItem>\n        <ListItem>\n          <Typography className={classes.txt}>Move</Typography>\n          <Slider\n            min={0}\n            max={1}\n            step={0.001}\n            value={colors.offset}\n            onChange={throttle((_, v) => dispatch(setColorOffset(v)), 100)}\n          />\n        </ListItem>\n        <ListItem>\n          <Typography className={classes.txt}>Stretch</Typography>\n          <Slider\n            min={0}\n            max={100}\n            step={1}\n            value={densitySlider}\n            onChange={throttle(\n              (_, v) => dispatch(setColorDensity(getDensity(v))),\n              100,\n            )}\n          />\n        </ListItem>\n      </List>\n    </div>\n  );\n}\n\nexport default Palette;\n","import React from \"react\";\nimport List from \"@material-ui/core/List\";\nimport ListItem from \"@material-ui/core/ListItem\";\nimport ListItemText from \"@material-ui/core/ListItemText\";\nimport ListSubheader from \"@material-ui/core/ListSubheader\";\nimport ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\nimport Switch from \"@material-ui/core/Switch\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { changeSmooth } from \"../../redux/rdxengine\";\nimport { Root } from \"../../redux/reducer\";\nimport { setInfobox } from \"../../redux/ui\";\n\nfunction Settings() {\n  const dispatch = useDispatch();\n  const smooth = useSelector((state: Root) => state.set.smooth);\n  const ui = useSelector((state: Root) => state.ui);\n\n  return (\n    <div>\n      <List\n        component=\"nav\"\n        subheader={\n          <ListSubheader component=\"div\">Advanced settings</ListSubheader>\n        }\n      >\n        <ListItem>\n          <ListItemText primary=\"Smooth rendering\" />\n          <ListItemSecondaryAction>\n            <Switch\n              edge=\"end\"\n              onChange={(event) => {\n                dispatch(changeSmooth(event.target.checked));\n              }}\n              checked={smooth}\n              color=\"primary\"\n            />\n          </ListItemSecondaryAction>\n        </ListItem>\n        {ui.narrowDevice ? null : (\n          <ListItem>\n            <ListItemText primary=\"Information box\" />\n            <ListItemSecondaryAction>\n              <Switch\n                edge=\"end\"\n                onChange={(event) => {\n                  dispatch(setInfobox(event.target.checked));\n                }}\n                checked={ui.infobox}\n                color=\"primary\"\n              />\n            </ListItemSecondaryAction>\n          </ListItem>\n        )}\n      </List>\n    </div>\n  );\n}\n\nexport default Settings;\n","export const isMobileDevice = () =>\n  typeof window.orientation !== \"undefined\" ||\n  navigator.userAgent.indexOf(\"IEMobile\") !== -1;\n\nexport const isTouchDevice = () =>\n  \"ontouchstart\" in window ||\n  navigator.maxTouchPoints > 0 ||\n  navigator.msMaxTouchPoints > 0;\n\nexport const isMouseDevice = () =>\n  matchMedia(\"(pointer:fine)\").matches || matchMedia(\"(hover:hover)\").matches;\n","import React from \"react\";\nimport { Typography } from \"@material-ui/core\";\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\";\nimport List from \"@material-ui/core/List\";\nimport ListItem from \"@material-ui/core/ListItem\";\nimport ListItemText from \"@material-ui/core/ListItemText\";\nimport ListSubheader from \"@material-ui/core/ListSubheader\";\nimport ListItemAvatar from \"@material-ui/core/ListItemAvatar\";\nimport Avatar from \"@material-ui/core/Avatar\";\nimport { Divider } from \"@material-ui/core\";\nimport GitHubButton from \"react-github-btn\";\nimport { isMobileDevice, isTouchDevice, isMouseDevice } from \"../../util/misc\";\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    avatar: {\n      backgroundColor: theme.palette.primary.main,\n    },\n    inline: {\n      display: \"inline\",\n    },\n    key: {\n      display: \"inline-block\",\n      verticalAlign: \"middle\",\n      border: \"1px solid #888\",\n      background: \"#EEE\",\n      borderRadius: \"4px\",\n      padding: \"1px 4px\",\n      margin: \"2px 0px\",\n      fontSize: \"13px\",\n      minWidth: \"1.8em\",\n      textAlign: \"center\",\n      color: \"black\",\n    },\n  }),\n);\n\nconst Keys = () => {\n  const classes = useStyles();\n  return (\n    <small>\n      <span className={classes.key}>&#x2190;</span>{\" \"}\n      <span className={classes.key}>&#x2191;</span>{\" \"}\n      <span className={classes.key}>&#x2192;</span>{\" \"}\n      <span className={classes.key}>&#x2193;</span> ,{\" \"}\n      <span className={classes.key}>+</span>{\" \"}\n      <span className={classes.key}>-</span>\n      <br />\n      (+ <span className={classes.key}>S</span>{\" \"}\n      <span className={classes.key}>H</span>{\" \"}\n      <span className={classes.key}>R</span>,{\" \"}\n      <span className={classes.key}>V</span> )\n      <br />\n      (+ <span className={classes.key}>shift</span> )\n    </small>\n  );\n};\n\nconst Speech = () => {\n  const classes = useStyles();\n  return (\n    <Typography\n      component=\"span\"\n      variant=\"body1\"\n      className={classes.inline}\n      color=\"textPrimary\"\n    >\n      FractalJS is open-source. You can report bugs, or add you favorite fractal\n      set by heading to{\" \"}\n      <a\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        href=\"https://github.com/solendil/fractaljs/\"\n      >\n        GitHub\n      </a>\n      .\n    </Typography>\n  );\n};\n\nexport default function SimpleCard() {\n  const classes = useStyles();\n\n  return (\n    <>\n      <List component=\"nav\" style={{ maxWidth: `360px` }}>\n        <ListSubheader component=\"div\">Controls</ListSubheader>\n        {isTouchDevice() ? (\n          <ListItem>\n            <ListItemAvatar>\n              <Avatar className={classes.avatar}>\n                <i className=\"material-icons\">touch_app</i>\n              </Avatar>\n            </ListItemAvatar>\n            <ListItemText primary=\"Touch\" secondary=\"Swipe & Pinch to zoom\" />\n          </ListItem>\n        ) : null}\n        {isMouseDevice() ? (\n          <ListItem>\n            <ListItemAvatar>\n              <Avatar className={classes.avatar}>\n                <i className=\"material-icons\">mouse</i>\n              </Avatar>\n            </ListItemAvatar>\n            <ListItemText primary=\"Mouse\" secondary=\"Drag & wheel zoom\" />\n          </ListItem>\n        ) : null}\n        {!isMobileDevice() ? (\n          <ListItem>\n            <ListItemAvatar>\n              <Avatar className={classes.avatar}>\n                <i className=\"material-icons\">keyboard</i>\n              </Avatar>\n            </ListItemAvatar>\n            <ListItemText primary=\"Keyboard\" secondary={<Keys />} />\n          </ListItem>\n        ) : null}\n        <Divider />\n        <ListSubheader component=\"div\">About</ListSubheader>\n        <ListItem>\n          <Speech />\n        </ListItem>\n        <ListItem>\n          <GitHubButton\n            href=\"https://github.com/solendil/fractaljs\"\n            data-color-scheme=\"no-preference: light; light: light; dark: light;\"\n            data-size=\"large\"\n            data-show-count={true}\n            aria-label=\"Star solendil/fractaljs on GitHub\"\n          >\n            Star\n          </GitHubButton>{\" \"}\n        </ListItem>\n      </List>\n    </>\n  );\n}\n\n// const useStyles = makeStyles({\n//   bullet: {\n//     display: \"inline-block\",\n//     margin: \"0 2px\",\n//     transform: \"scale(0.8)\",\n//   },\n//   pos: {\n//     marginBottom: 12,\n//   },\n// });\n\n// export default function SimpleCard() {\n//   const classes = useStyles();\n//   const bull = <span className={classes.bullet}>â€¢</span>;\n\n//   return (\n//     // <Card>\n//     <CardContent>\n//       <Typography color=\"textSecondary\" gutterBottom>\n//         Word of the Day\n//       </Typography>\n//     </CardContent>\n//     // {/* </Card> */}\n//   );\n// }\n\n// function About() {\n//   return (\n//     <div style={{}}>\n//       <Typography component=\"div\">\n//         FractalJS is open-source. You can report bugs, or add you favorite\n//         fractal set by heading to{\" \"}\n//         <a target=\"_blank\" href=\"https://github.com/solendil/fractaljs/\">\n//           GitHub\n//         </a>\n//       </Typography>\n//     </div>\n//   );\n// }\n\n// export default About;\n","import React from \"react\";\nimport List from \"@material-ui/core/List\";\nimport ListItem from \"@material-ui/core/ListItem\";\nimport ListSubheader from \"@material-ui/core/ListSubheader\";\nimport { getEngine } from \"../../redux/rdxengine\";\n\nexport default function Debug() {\n  const engine = getEngine();\n  const camera = engine.ctx.camera;\n  return (\n    <div>\n      <List component=\"nav\">\n        <ListSubheader component=\"div\">Debug</ListSubheader>\n        <ListItem>Threads: {engine.ctx.nbThreads}</ListItem>\n        <ListItem>\n          Screen: {camera.screen.x} * {camera.screen.y}\n        </ListItem>\n      </List>\n    </div>\n  );\n}\n","import React from \"react\";\nimport { IconButton } from \"@material-ui/core\";\n\ninterface Props {\n  className: string;\n}\n\n// hack typescript which does not know this property\ninterface ShareNavigator {\n  share: (props: any) => Promise<any>;\n}\n\nconst Share = (props: Props) => {\n  const nav = (navigator as unknown) as ShareNavigator;\n  if (!nav.share) return null;\n  return (\n    <IconButton\n      className={props.className}\n      onClick={() => {\n        nav.share({\n          title: \"FractalJS\",\n          text: \"Check out this fractal picture !\",\n          url: window.location.href,\n        });\n      }}\n    >\n      <i className=\"material-icons\">share</i>\n    </IconButton>\n  );\n};\n\nexport default Share;\n","import React from \"react\";\nimport map from \"lodash/map\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { navigation } from \"./Navigation\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport { useDispatch } from \"react-redux\";\nimport { setTab, setDrawer } from \"../redux/ui\";\nimport { fade } from \"@material-ui/core/styles/colorManipulator\";\nimport Share from \"./Share\";\n\nconst useStyles = makeStyles((theme) => ({\n  bar: {\n    backgroundColor: fade(theme.palette.primary.main, 0.8),\n    backdropFilter: \"blur(8px)\",\n    position: \"fixed\",\n    display: \"flex\",\n    [theme.breakpoints.only(\"xs\")]: {\n      width: \"100%\",\n      height: \"56px\",\n      bottom: 0,\n    },\n    [theme.breakpoints.up(\"sm\")]: {\n      height: \"100%\",\n      flexDirection: \"column\",\n      left: 0,\n      flexWrap: \"wrap-reverse\",\n    },\n  },\n  icons: {\n    color: \"white\",\n    [theme.breakpoints.only(\"xs\")]: {\n      width: \"64px\",\n    },\n    [theme.breakpoints.up(\"sm\")]: {\n      width: \"56px\",\n    },\n  },\n  brand: {\n    [theme.breakpoints.only(\"xs\")]: {\n      display: \"none\",\n    },\n    color: \"white\",\n    fontSize: \"20px\",\n    lineHeight: \"56px\",\n    writingMode: \"vertical-rl\",\n    transform: \"rotate(180deg)\",\n    fontFamily: \"roboto\",\n    paddingBottom: \"56px\",\n    paddingTop: \"0.5em\",\n    letterSpacing: \"3px\",\n    fontWeight: 500,\n    flexGrow: 1,\n    textDecoration: \"none\",\n  },\n}));\n\nconst ToolBar = () => {\n  const classes = useStyles();\n  const dispatch = useDispatch();\n  const buttons = map(navigation, (def, tabId) =>\n    !def.hidden ? (\n      <IconButton\n        key={tabId}\n        className={classes.icons}\n        onClick={() => {\n          dispatch(setTab(tabId));\n          dispatch(setDrawer(true));\n        }}\n      >\n        <i className=\"material-icons\">{def.icon}</i>\n      </IconButton>\n    ) : null,\n  ).filter(Boolean);\n  buttons.push(\n    <a\n      href=\"https://github.com/solendil/FractalJS\"\n      target=\"_\"\n      className={classes.brand}\n      key=\"brand\"\n    >\n      FractalJS\n    </a>,\n  );\n  buttons.splice(2, 0, <Share key=\"share\" className={classes.icons} />);\n\n  return <div className={classes.bar}>{buttons}</div>;\n};\n\nexport default ToolBar;\n","import React from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport SwipeableDrawer from \"@material-ui/core/SwipeableDrawer\";\nimport useMediaQuery from \"@material-ui/core/useMediaQuery\";\nimport Fractal from \"./pages/Fractal\";\nimport Palette from \"./pages/Palette\";\nimport Settings from \"./pages/Settings\";\nimport About from \"./pages/About\";\nimport Debug from \"./pages/Debug\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Root } from \"../redux/reducer\";\nimport { setDrawer } from \"../redux/ui\";\nimport Divider from \"@material-ui/core/Divider\";\nimport MyToolbar from \"./Toolbar\";\n\nexport const navigation: { [key: string]: any } = {\n  fractal: { icon: \"home\", component: <Fractal /> },\n  palette: { icon: \"invert_colors\", component: <Palette /> },\n  // social: { icon: \"share\", component: <Social /> },\n  settings: { icon: \"settings\", component: <Settings /> },\n  about: { icon: \"info_outline\", component: <About /> },\n  debug: { hidden: true, component: <Debug /> },\n};\n\nconst useStyles = makeStyles((theme) => ({\n  appBar: {\n    top: \"auto\",\n    bottom: 0,\n  },\n  drawer: {\n    minWidth: \"360px\",\n    [theme.breakpoints.up(\"sm\")]: {\n      width: \"360px\",\n    },\n  },\n  trans: {\n    // if we wanna make a transparent background\n    // backgroundColor: \"rgb(255, 255, 255, 0.85)\",\n    // backdropFilter: \"blur(5px)\",\n    [theme.breakpoints.only(\"xs\")]: {\n      borderTopLeftRadius: \"10px\",\n      borderTopRightRadius: \"10px\",\n    },\n  },\n  handle: {\n    width: \"33%\",\n    margin: \"4px auto -2px auto\",\n    height: \"4px\",\n  },\n}));\n\nconst Navigation = () => {\n  const classes = useStyles();\n  const dispatch = useDispatch();\n  const { drawer, tab } = useSelector((state: Root) => ({\n    drawer: state.ui.drawer,\n    tab: state.ui.tab,\n  }));\n  const bigDevice = useMediaQuery(\"(min-width:450px)\");\n  const content = navigation[tab || \"fractal\"].component;\n\n  return (\n    <>\n      <MyToolbar />\n      <SwipeableDrawer\n        anchor={bigDevice ? \"left\" : \"bottom\"}\n        open={drawer}\n        disableDiscovery\n        disableSwipeToOpen\n        PaperProps={{ className: classes.trans }}\n        BackdropProps={{ invisible: true }}\n        onClose={() => dispatch(setDrawer(false))}\n        onOpen={() => dispatch(setDrawer(true))}\n      >\n        <div className={classes.drawer}>\n          {!bigDevice ? <Divider className={classes.handle} /> : null}\n          {content}\n        </div>\n      </SwipeableDrawer>\n    </>\n  );\n};\n\nexport default Navigation;\n","import React from \"react\";\nimport Paper from \"@material-ui/core/Paper\";\nimport Box from \"@material-ui/core/Box\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Typography } from \"@material-ui/core\";\nimport { useSelector } from \"react-redux\";\nimport { Root } from \"../redux/reducer\";\n\nconst useStyles = makeStyles((theme) => ({\n  box: {\n    position: \"fixed\",\n    bottom: 0,\n    right: 0,\n    margin: \"16px\",\n    background: \"white\",\n    padding: \"16px\",\n  },\n}));\n\nfunction InfoBox() {\n  const classes = useStyles();\n  const set = useSelector((state: Root) => state.set);\n  const ui = useSelector((state: Root) => state.ui);\n  if (ui.narrowDevice) return null;\n  if (!ui.infobox) return null;\n  const d: any = {};\n  if (ui.mouseOnCanvas) {\n    d.x = ui.mouse.x;\n    d.y = ui.mouse.y;\n    d.iter = ui.mouse.iter;\n    d.w = set.w;\n  } else {\n    d.x = set.x;\n    d.y = set.y;\n    d.iter = set.iter;\n    d.w = set.w;\n  }\n  return (\n    <Paper elevation={3} className={classes.box}>\n      <Typography color=\"primary\" gutterBottom variant=\"h6\">\n        {ui.mouseOnCanvas ? \"Mouse\" : \"Screen\"}\n      </Typography>\n      <Typography component=\"div\">\n        <Box fontFamily=\"Monospace\">X: {d.x.toFixed(16)}</Box>\n        <Box fontFamily=\"Monospace\">Y: {d.y.toFixed(16)}</Box>\n        <Box fontFamily=\"Monospace\">iterations: {d.iter.toFixed(2)}</Box>\n        <Box fontFamily=\"Monospace\">extent: {d.w.toExponential(2)}</Box>\n      </Typography>\n    </Paper>\n  );\n}\n\nexport default InfoBox;\n","import React from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { Root } from \"../redux/reducer\";\nimport { makeStyles } from \"@material-ui/core\";\nimport Snackbar from \"@material-ui/core/Snackbar\";\n\nconst useStyles = makeStyles((theme) => ({\n  snackbar: {\n    [theme.breakpoints.only(\"xs\")]: {\n      bottom: 64,\n    },\n  },\n}));\n\nconst MySnackbar = () => {\n  const ui = useSelector((state: Root) => state.ui);\n  const classes = useStyles();\n  if (!ui.snack) return null;\n\n  return (\n    <Snackbar\n      open={true}\n      className={classes.snackbar}\n      message=\"Sorry, FractalJS cannot zoom further...\"\n    ></Snackbar>\n  );\n};\n\nexport default MySnackbar;\n","import React, { useRef } from \"react\";\nimport \"./App.scss\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { Root } from \"../redux/reducer\";\nimport Navigation from \"./Navigation\";\nimport useMediaQuery from \"@material-ui/core/useMediaQuery\";\nimport { initEngine } from \"../redux/rdxengine\";\nimport InfoBox from \"./InfoBox\";\nimport Snackbar from \"./Snackbar\";\n\nconst App = () => {\n  const dispatch = useDispatch();\n  const ref = useRef(null);\n  const ui = useSelector((state: Root) => state.ui);\n  const bigDevice = useMediaQuery(\"(min-width:450px)\");\n\n  React.useEffect(() => {\n    const canvas = (ref.current as unknown) as HTMLCanvasElement;\n    dispatch(initEngine(canvas));\n  }, [dispatch]);\n\n  let canvasClass = \"\";\n  if (ui.drawer)\n    canvasClass = bigDevice ? \"offset-left\" : `offset-top-${ui.tab}`;\n\n  return (\n    <div>\n      <canvas ref={ref} className={canvasClass}></canvas>\n      <Navigation />\n      <InfoBox />\n      <Snackbar />\n    </div>\n  );\n};\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import { combineReducers } from \"@reduxjs/toolkit\";\nimport { reducer as ui } from \"./ui\";\nimport { reducer as set } from \"./set\";\nimport { reducer as colors } from \"./colors\";\n\nconst root = combineReducers({\n  ui,\n  set,\n  colors,\n});\n\nexport default root;\nexport type Root = ReturnType<typeof root>;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./ui/App\";\nimport { ThemeProvider } from \"@material-ui/styles\";\nimport * as serviceWorker from \"./serviceWorker\";\nimport { configureStore } from \"@reduxjs/toolkit\";\nimport reducer from \"./redux/reducer\";\nimport { Provider } from \"react-redux\";\nimport { createMuiTheme } from \"@material-ui/core/styles\";\n\nconst store = configureStore({ reducer });\n\nconst theme = createMuiTheme({\n  palette: {\n    // type: \"dark\",\n  },\n  breakpoints: {\n    values: {\n      xs: 0,\n      sm: 450, // 'sm' value at 450 (ie mobile portrait width) is our only real point\n      md: 960,\n      lg: 1280,\n      xl: 1920,\n    },\n  },\n});\n\nReactDOM.render(\n  <Provider store={store}>\n    <ThemeProvider theme={theme}>\n      <App />\n    </ThemeProvider>\n  </Provider>,\n  document.getElementById(\"root\"),\n);\n\nserviceWorker.register();\n"],"sourceRoot":""}