define("engine",[],function(){"use strict";return function(e){var t,n,r,i,s=4,o,u,a,f,l,c,h,p,d=function(){var e=Math.min(u,a),i=e*1.11e-15;r<i&&(r=i),f=r/e,l=t-u/2*f,c=n-a/2*f},v=1/Math.log(2),m=Math.log(.5)*v,g={mandelsmooth:function(e,t){var n=0,r=0,o=0,u=0,a=0,f=0;for(;a<i&&o+u<=s;++a)r=(n+n)*r+t,n=o-u+e,o=n*n,u=r*r;for(f=0;f<4;++f)r=(n+n)*r+t,n=o-u+e,o=n*n,u=r*r;var l=5+a-m-Math.log(Math.log(o+u))*v;return l},mandel:function(e,t){var n=0,r=0,o=0,u=0,a=0,f=0;for(;a<i&&o+u<=s;++a)r=(n+n)*r+t,n=o-u+e,o=n*n,u=r*r;return a},mandel3:function(e,t){var n=0,r=0,o=0,u,a;for(;;){u=n*n*n-3*n*r*r+e,a=3*n*n*r-r*r*r+t,n=u,r=a;if(++o>=i)break;if(n*n+r*r>s)break}return o},burningship:function(e,t){var n=0,r=0,o=0,u,a;for(;;){u=n*n-r*r+e,a=2*n*r+t,n=Math.abs(u),r=Math.abs(a);if(++o>=i)break;if(n*n+r*r>s)break}return o}};p=g.mandel;var y={setFractalDesc:function(e){"x"in e&&(t=e.x),"y"in e&&(n=e.y),e.w&&(r=e.w),e.i&&(i=Math.round(e.i)),e.iter&&(i=Math.round(e.iter));if(e.type){if(!(e.type in g))throw"Invalid fractal function "+e.type;o=e.type,p=g[o]}e.swidth&&(u=e.swidth,a=e.sheight,h=new Float32Array(u*a)),d();var s=this.getFractalDesc();return s},getFractalDesc:function(){var e={x:t,y:n,w:r,iter:i,testx:t,testy:n,pixelOnP:f,swidth:u,sheight:a,pxmin:l,pymin:c,type:o};return e},drawTile:function(e){var t=c+e.y1*f;for(var n=e.y1;n<e.y2;n++){var r=l+e.x1*f,s=n*u+e.x1;for(var o=e.x1;o<e.x2;o++){var a=p(r,t);a==i?h[s++]=0:h[s++]=a,r+=f}t+=f}return h},getBuffer:function(){return h}};return y.setFractalDesc(e),y}}),define("util",[],function(){"use strict";Math.trunc=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)},typeof String.prototype.startsWith!="function"&&(String.prototype.startsWith=function(e){return this.indexOf(e)===0}),"performance"in window==0&&(window.performance={});if("now"in window.performance==0){var e=Date.now();performance.timing&&performance.timing.navigationStart&&(e=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-e}}var t=function(e){if(e<0||e>255)throw"Number is out of range";return e<16?"0"+e.toString(16):e.toString(16)};return{hsv_to_rgb:function(e,t,n){e==360&&(e=0),n>1&&(n=1);var r=e/60,i=n*t,s=i*(1-Math.abs(r%2-1)),o=[0,0,0];0<=r&&r<1&&(o=[i,s,0]),1<=r&&r<2&&(o=[s,i,0]),2<=r&&r<3&&(o=[0,i,s]),3<=r&&r<4&&(o=[0,s,i]),4<=r&&r<5&&(o=[s,0,i]),5<=r&&r<6&&(o=[i,0,s]);var u=n-i;return o[0]+=u,o[1]+=u,o[2]+=u,o[0]*=255,o[1]*=255,o[2]*=255,o},defaultProps:function(e,t){var n;e||(e={});for(n in t)n in e||(e[n]=t[n]);for(n in e)n in t||console.log("WARN : unknown property ",n);return e},callbackHelp:function(e,t){if(e.length>0){var n=t;typeof t=="function"&&(n=t());for(var r in e)e[r](n)}},getHashColor:function(e,n,r){return"#"+t(e)+t(n)+t(r)}}}),define("palette",["util"],function(e){"use strict";return function(t){var n,r=t.resolution,i=new Int32Array(r),s=t.offset,o=t.modulo,u,a={"palette.change":[]},f=function(e){if(e.constructor===Array){n=e;return}n=[];var t=e.split(";");for(var r in t){var i=t[r],s=i.split("#"),o=Number(s[0]),u=parseInt(s[1].substring(0,2),16),a=parseInt(s[1].substring(2,4),16),f=parseInt(s[1].substring(4,6),16);n.push({index:o,r:u,g:a,b:f})}},l=function(e,t){return{index:e.index+(t?t:0),r:e.r,g:e.g,b:e.b}},c=function(){var e,t=new Uint8Array(i.buffer),o=[];for(e in n){var u=l(n[e],s);u.index=u.index%1,o.push(u)}o.sort(function(e,t){return e.index-t.index}),o.push(l(o[0],1)),o.splice(0,0,l(o[o.length-2],-1));var a=o,f=0,c=1,h=a[f],p=a[c],d=p.index-h.index,v=0;for(e=0;e<r;e++){var m=e/r;m>=p.index&&(f++,c++,h=a[f],p=a[c],d=p.index-h.index);var g=(m-h.index)/d,y=h.r+(p.r-h.r)*g,b=h.g+(p.g-h.g)*g,w=h.b+(p.b-h.b)*g;t[v++]=y,t[v++]=b,t[v++]=w,t[v++]=255}},h=function(){u=r/o};return f(t.stops),c(),h(),{getColorForIter:function(e){if(e===0)return 4278190080;var t=i[Math.trunc(e*u%r)];return t},getState:function(){return{buffer:i,stops:n,offset:s,modulo:o}},setShortDesc:function(e){e.offset&&(s=e.offset),e.modulo&&(o=e.modulo),f(e.stops),c(),h()},getShortDesc:function(){var t="";for(var r in n){var i=n[r];t+=i.index,t+=e.getHashColor(i.r,i.g,i.b),t+=";"}return{modulo:o,offset:s,stops:t.slice(0,-1)}},setState:function(t){t.offset&&(s=t.offset),t.modulo&&(o=t.modulo),e.callbackHelp(a["palette.change"]),h()},build:function(e){c()},on:function(e,t){a[e].push(t)}}}}),define("renderer",["engine","palette","util"],function(e,t,n){"use strict";return function(r){var i,s,o,u,a,f,l=[],c,h={"frame.end":[],"frame.start":[],"iter.change":[]},p,d;i=r.canvas,s=i.getContext("2d"),o=s.createImageData(i.width,i.height),u=new Uint32Array(o.data.buffer),r.fractalDesc.swidth=i.width,r.fractalDesc.sheight=i.height,a=new e(r.fractalDesc),f=new t(r.palette);var v=function(){d=performance.now(),n.callbackHelp(h["frame.start"],function(){return{fractalDesc:a.getFractalDesc()}})},m=function(){var e=performance.now();n.callbackHelp(h["frame.end"],function(){return{fractalDesc:a.getFractalDesc(),buffer:a.getBuffer(),time:e-d}});var t,r,i=a.getBuffer(),s=a.getFractalDesc(),o=1e12,u=-1,f=0,l=0;for(t=0;t<i.length;t++){f++,r=i[t];if(r===0){l++;continue}r>u&&(u=r),r<o&&(o=r)}var c=u-o,v=s.iter-Math.ceil(c/10),m=0;for(t=0;t<i.length;t++){r=i[t];if(r===0)continue;r>=v&&m++}var g=100*l/f,y=100*m/l;g>1&&y>1&&(a.setFractalDesc({iter:s.iter*1.5}),p.draw(),n.callbackHelp(h["iter.change"])),g>1&&y<.2&&(a.setFractalDesc({iter:s.iter/1.5}),n.callbackHelp(h["iter.change"]))},g=function(){},y=function(){var e=a.getBuffer(),t=i.height*i.width;for(var n=0;n<t;n++)u[n]=f.getColorForIter(e[n]);s.putImageData(o,0,0,0,0,i.width,i.height)},b=function(){var e=l.shift(),t=a.drawTile(e);for(var n=e.y1;n<e.y2;n++){var r=n*i.width+e.x1;for(var h=e.x1;h<e.x2;h++){var p=t[r],d=f.getColorForIter(p);u[r++]=d}}s.putImageData(o,0,0,e.x1,e.y1,e.x2-e.x1,e.y2-e.y1),l.length>0?c=setTimeout(b,0):m()};return p={drawPalette:function(){y()},draw:function(e){l.length!==0&&(clearTimeout(c),l.length=0,g()),v();if(e){var t=s.getImageData(0,0,i.width,i.height),n=$("<canvas>").attr("width",t.width).attr("height",t.height)[0];n.getContext("2d").putImageData(t,0,0),s.scale(e.z,e.z),s.translate(e.x,e.y),s.drawImage(n,0,0),s.setTransform(1,0,0,1,0,0)}var o=Math.sqrt(r.renderer.numberOfTiles),u=i.width/o,a=i.height/o,f=0;for(var h=0;h<o;h++)for(var p=0;p<o;p++){var d={i:h,j:p,id:f++,x1:Math.round(p*i.width/o),x2:Math.round((p+1)*i.width/o),y1:Math.round(h*i.height/o),y2:Math.round((h+1)*i.height/o)};e&&(e.mvt=="zoomin"||e.mvt=="zoomout")&&(d.x=(d.x1+d.x2)/2,d.y=(d.y1+d.y2)/2,d.dx=e.sx-d.x,d.dy=e.sy-d.y,d.dist=d.dx*d.dx+d.dy*d.dy),e&&e.mvt=="pan"&&(d.prio=0,e.x>0&&d.x1<e.x&&(d.prio=1),e.x<0&&d.x2>i.width+e.x&&(d.prio=1),e.y>0&&d.y1<e.y&&(d.prio=1),e.y<0&&d.y2>i.height+e.y&&(d.prio=1)),l.push(d)}e&&e.mvt=="pan"&&l.sort(function(e,t){return t.prio-e.prio}),e&&e.mvt=="zoomin"&&l.sort(function(e,t){return e.dist-t.dist}),e&&e.mvt=="zoomout"&&l.sort(function(e,t){return t.dist-e.dist}),c=setTimeout(b,0)},resize:function(){a.setFractalDesc({swidth:i.width,sheight:i.height}),o=s.createImageData(i.width,i.height),u=new Uint32Array(o.data.buffer)},setFractalDesc:function(e){var t=a.setFractalDesc(e);return t},getFractalDesc:function(){return a.getFractalDesc()},getPalette:function(){return f},on:function(e,t){h[e].push(t)}},p}}),define("controller",["util"],function(e){"use strict";return function(t,n,r){var i=1.3,s,o,u,a,f,l,c={"mouse.control":[]};return r.mouseControl&&($(n).mousedown(function(e){s=!0,o=f=e.screenX,u=l=e.screenY,a=t.getFractalDesc()}),$(window).mouseup(function(e){s=!1}),$(window).mousemove(function(n){if(s){var r=n.screenX-o,i=n.screenY-u,h=r*a.pixelOnP,p=i*a.pixelOnP,d={x:a.x-h,y:a.y-p};t.setFractalDesc(d);var v=n.screenX-f,m=n.screenY-l,g={x:v,y:m,mvt:"pan"};t.draw(g),e.callbackHelp(c["mouse.control"],g),f=n.screenX,l=n.screenY}}),$(n).bind("wheel",function(n){var r=n.originalEvent.clientX,s=n.originalEvent.clientY,o=t.getFractalDesc(),u=t.getFractalDesc(),a=(r-u.swidth/2)*u.pixelOnP,f=(s-u.sheight/2)*u.pixelOnP;u.x+=a,u.y+=f,u=t.setFractalDesc(u);var l={sx:r,sy:s};n.originalEvent.deltaY>0?(u.w/=i,u.x-=a/i,u.y-=f/i,l.z=1*i,l.mvt="zoomin"):(u.w*=i,u.x-=a*i,u.y-=f*i,l.z=1/i,l.mvt="zoomout");var h=t.setFractalDesc(u);l.x=(o.pxmin-h.pxmin)/o.pixelOnP,l.y=(o.pymin-h.pymin)/o.pixelOnP,t.draw(l),e.callbackHelp(c["mouse.control"],l)})),r.fitToWindow&&(n.width=window.innerWidth,n.height=window.innerHeight,t.resize(),$(window).resize(function(){n.width=window.innerWidth,n.height=window.innerHeight,t.resize(),t.draw()})),{on:function(e,t){c[e].push(t)}}}}),define("fractal",["renderer","controller","util"],function(e,t,n){"use strict";return function(r){document.addEventListener||console.error("This browser cannot run FractalJS");var i,s;if(!r.canvas||!r.canvas.width)throw"Canvas is not set";if(!r.fractalDesc)throw"Fractal Description is not set";return r.palette||(r.palette={stops:[{index:0,r:0,g:0,b:0},{index:.5,r:255,g:255,b:255}]}),r.palette=n.defaultProps(r.palette,{stops:[],resolution:1e3,offset:0,modulo:50}),r.renderer=n.defaultProps(r.renderer,{numberOfTiles:1,drawAfterInit:!0}),r.controller=n.defaultProps(r.controller,{mouseControl:!0,fitToWindow:!1}),i=new e(r),s=new t(i,r.canvas,r.controller),r.renderer.drawAfterInit&&i.draw(),{setFractalDesc:function(e){var t=i.setFractalDesc(e);return t},getFractalDesc:function(){return i.getFractalDesc()},getPalette:function(){return i.getPalette()},draw:function(){i.draw()},drawPalette:function(){i.drawPalette()},on:function(e,t){if(e=="frame.end"||e=="frame.start"||e=="iter.change")i.on(e,t);else if(e=="mouse.control")s.on(e,t);else{if(e!="palette.change")throw"Unknown event "+e;i.getPalette().on(e,t)}}}}}),define("fractal-ui",[],function(){"use strict";return function(e){var t=function(){var t=e.getFractalDesc(),n=new ArrayBuffer(32),r=new Uint16Array(n),i=new Float64Array(n);r[0]=1,r[1]=t.iter,i[1]=t.x,i[2]=t.y,i[3]=t.w;var s=btoa(String.fromCharCode.apply(null,new Uint8Array(n)));s=s.split("/").join("*"),s=s.split("=").join("_"),document.location.hash="A"+s},n=function(){function t(e){var t=window.atob(e),n=t.length,r=new Uint8Array(n);for(var i=0;i<n;i++)r[i]=t.charCodeAt(i);return r.buffer}try{var n=document.location.hash;if(n.startsWith("#A")){var r=n.substr(2);r=r.split("*").join("/"),r=r.split("_").join("=");var i=t(r),s=new Uint16Array(i),o=new Float64Array(i),u={x:o[1],y:o[2],w:o[3],iter:s[1]};console.log("Initialization",u),e.setFractalDesc(u)}}catch(a){console.error("Could not initialize view")}};return n(),e.on("mouse.control",t),e.on("iter.change",t),{}}}),require(["fractal","fractal-ui"],function(e,t){"use strict";var n=new e({canvas:document.getElementById("maincanvas"),fractalDesc:{type:"mandel",x:-0.7,y:0,w:2.5,i:50},palette:{resolution:500,stops:"0#080560;0.2#2969CB;0.40#F1FEFE;0.60#FCA425;0.85#000000"},renderer:{numberOfTiles:100,drawAfterInit:!1},controller:{fitToWindow:!0}}),r=new t(n);n.draw()}),define("main",function(){});