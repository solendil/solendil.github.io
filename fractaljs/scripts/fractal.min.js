window.FractalJS=window.FractalJS||{},FractalJS.util=function(){"use strict";if(Math.trunc=Math.trunc||function(a){return 0>a?Math.ceil(a):Math.floor(a)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return 0===this.indexOf(a)}),"performance"in window==!1&&(window.performance={}),"now"in window.performance==!1){var a=Date.now();performance.timing&&performance.timing.navigationStart&&(a=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-a}}var b=function(a){if(0>a||a>255)throw"Number is out of range";return 16>a?"0"+a.toString(16):a.toString(16)};return{createInterpolant:function(a,b){var c,d=a.length;if(d!=b.length)throw"Need an equal count of xs and ys.";if(0===d)return function(a){return 0};if(1===d){var e=+b[0];return function(a){return e}}var f=[];for(c=0;d>c;c++)f.push(c);f.sort(function(b,c){return a[b]<a[c]?-1:1});var g=a,h=b;for(a=[],b=[],c=0;d>c;c++)a.push(+g[f[c]]),b.push(+h[f[c]]);var i=[],j=[],k=[];for(c=0;d-1>c;c++){var l=a[c+1]-a[c],m=b[c+1]-b[c];j.push(l),i.push(m),k.push(m/l)}var n=[k[0]];for(c=0;c<j.length-1;c++){var o=k[c],p=k[c+1];if(0>=o*p)n.push(0);else{var l=j[c],q=j[c+1],r=l+q;n.push(3*r/((r+q)/o+(r+l)/p))}}n.push(k[k.length-1]);var s=[],t=[];for(c=0;c<n.length-1;c++){var u=n[c],o=k[c],v=1/j[c],r=u+n[c+1]-o-o;s.push((o-u-r)*v),t.push(r*v*v)}return function(c){var d=a.length-1;if(c==a[d])return b[d];for(var e,f=0,g=t.length-1;g>=f;){e=Math.floor(.5*(f+g));var h=a[e];if(c>h)f=e+1;else{if(!(h>c))return b[e];g=e-1}}d=Math.max(0,g);var i=c-a[d],j=i*i;return b[d]+n[d]*i+s[d]*j+t[d]*i*j}},hsv_to_rgb:function(a,b,c){360==a&&(a=0),c>1&&(c=1);var d=a/60,e=c*b,f=e*(1-Math.abs(d%2-1)),g=[0,0,0];d>=0&&1>d&&(g=[e,f,0]),d>=1&&2>d&&(g=[f,e,0]),d>=2&&3>d&&(g=[0,e,f]),d>=3&&4>d&&(g=[0,f,e]),d>=4&&5>d&&(g=[f,0,e]),d>=5&&6>d&&(g=[e,0,f]);var h=c-e;return g[0]+=h,g[1]+=h,g[2]+=h,g[0]*=255,g[1]*=255,g[2]*=255,g},defaultProps:function(a,b){var c;a||(a={});for(c in b)c in a||(a[c]=b[c]);for(c in a)c in b||console.log("WARN : unknown property ",c);return a},getHashColor:function(a,c,d){return"#"+b(a)+b(c)+b(d)},base64ToArrayBuffer:function(a){for(var b=window.atob(a),c=b.length,d=new Uint8Array(c),e=0;c>e;e++)d[e]=b.charCodeAt(e);return d.buffer}}}(),FractalJS.Events=function(){"use strict";var a={};return{on:function(b,c){var d=b;b.constructor!==Array&&(d=[b]);for(var e in d){var f=d[e];f in a||(a[f]=[]),a[f].push(c)}},send:function(b,c){var d=b;b.constructor!==Array&&(d=[b]);var e=c;"function"==typeof c&&(e=c());var f=[];for(var g in d){var h=d[g];for(var i in a[h])f.push(a[h][i])}for(var j in f)f[j](e)}}},FractalJS.Engine=function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n=4,o=function(){var a=Math.min(g,h),e=1.11e-15*a;e>d&&(d=e),i=d/a,j=b-g/2*i,k=c-h/2*i},p=1/Math.log(2),q=Math.log(.5)*p,r={0:"mandel",1:"mandel3",2:"burningship",3:"tippetts"},s={mandel:0,mandel3:1,burningship:2,tippetts:3},t={mandelsmooth:function(a,b){for(var c=0,d=0,f=0,g=0,h=0,i=0;e>h&&n>=f+g;++h)d=(c+c)*d+b,c=f-g+a,f=c*c,g=d*d;for(i=0;4>i;++i)d=(c+c)*d+b,c=f-g+a,f=c*c,g=d*d;var j=5+h-q-Math.log(Math.log(f+g))*p;return j},mandel:function(a,b){for(var c=0,d=0,f=0,g=0,h=0;e>h&&n>=f+g;++h)d=(c+c)*d+b,c=f-g+a,f=c*c,g=d*d;return h},tippetts:function(a,b){for(var c=0,d=0,f=0,g=0,h=0;e>h&&n>=f+g;++h)c=f-g+a,d=(c+c)*d+b,f=c*c,g=d*d;return h},mandel3:function(a,b){for(var c,d,f=0,g=0,h=0,i=0,j=0;;){if(c=h*f-3*f*i+a,d=3*h*g-i*g+b,f=c,g=d,++j>=e)break;if(h=f*f,i=g*g,h+i>n)break}return j},burningship:function(a,b){for(var c,d,f=0,g=0,h=0,i=0,j=0;;){if(d=(f+f)*g+b,c=h-i+a,f=Math.abs(c),g=Math.abs(d),++j>=e)break;if(h=f*f,i=g*g,h+i>n)break}return j}};m=t.mandel;var u={setFractalDesc:function(a){if("x"in a&&(b=a.x),"y"in a&&(c=a.y),a.w&&(d=a.w),a.i&&(e=Math.round(a.i)),a.iter&&(e=Math.round(a.iter)),a.typeid){if(!(a.typeid in r))throw"Invalid fractal type "+a.typeid;a.type=r[a.typeid]}if(a.type){if(!(a.type in t))throw"Invalid fractal function "+a.type;f=a.type,m=t[f]}a.swidth&&(g=a.swidth,h=a.sheight,l=new Float32Array(g*h)),o();var i=this.getFractalDesc();return i},getFractalDesc:function(){var a={x:b,y:c,w:d,iter:e,testx:b,testy:c,pixelOnP:i,swidth:g,sheight:h,pxmin:j,pymin:k,type:f,typeid:s[f]};return a},drawTile:function(a){for(var b=k+a.y1*i,c=a.y1;c<a.y2;c++){for(var d=j+a.x1*i,f=c*g+a.x1,h=a.x1;h<a.x2;h++){var n=m(d,b);n==e?l[f++]=0:l[f++]=n,d+=i}b+=i}return l},getBuffer:function(){return l}};return u.setFractalDesc(a),u},FractalJS.Colormap=function(a){"use strict";var b=new Int32Array(a.buffer),c=a.offset||0,d=a.density||20,e=b.length,f=a.typeid;return{getColorForIter:function(a){if(0===a)return 4278190080;var f=b[Math.floor((a*d+c*e)%e)];return f},buffer:function(){return b},getDesc:function(){return{offset:c,density:d,buffer:b,typeid:f}},setDesc:function(a){a.offset&&(c=a.offset),a.density&&(d=a.density),a.typeid&&(f=a.typeid),a.buffer&&(b=a.buffer,e=a.buffer.length)}}},FractalJS.Renderer=function(a,b){"use strict";var c,d,e,f,g,h,i,j,k,l=(FractalJS.util,[]);c=a.canvas,d=c.getContext("2d"),e=d.createImageData(c.width,c.height),f=new Uint32Array(e.data.buffer),a.fractalDesc.swidth=c.width,a.fractalDesc.sheight=c.height,g=new FractalJS.Engine(a.fractalDesc),h=a.colormap;var m=function(){k=performance.now(),b.send("frame.start",function(){return{fractalDesc:g.getFractalDesc()}})},n=function(){var a=performance.now();b.send("frame.end",function(){return{fractalDesc:g.getFractalDesc(),buffer:g.getBuffer(),time:a-k}});var c,d,e=g.getBuffer(),f=g.getFractalDesc(),h=1e12,i=-1,l=0,m=0;for(c=0;c<e.length;c++)l++,d=e[c],0!==d?(d>i&&(i=d),h>d&&(h=d)):m++;var n=i-h,o=f.iter-Math.ceil(n/10),p=0;for(c=0;c<e.length;c++)d=e[c],0!==d&&d>=o&&p++;var q=100*m/l,r=100*p/m;q>1&&r>1&&(g.setFractalDesc({iter:1.5*f.iter}),j.draw(),b.send("iter.change")),q>1&&.2>r&&(g.setFractalDesc({iter:f.iter/1.5}),b.send("iter.change"))},o=function(){},p=function(){for(var a=g.getBuffer(),b=c.height*c.width,i=h.getDesc(),j=i.buffer,k=i.offset*j.length,l=i.density,m=j.length,n=0;b>n;n++){var o=a[n];0===o?f[n]=4278190080:f[n]=j[~~((o*l+k)%m)]}d.putImageData(e,0,0,0,0,c.width,c.height)},q=function(){for(var a=l.shift(),b=g.drawTile(a),j=a.y1;j<a.y2;j++)for(var k=j*c.width+a.x1,m=a.x1;m<a.x2;m++){var o=b[k],p=h.getColorForIter(o);f[k++]=p}d.putImageData(e,0,0,a.x1,a.y1,a.x2-a.x1,a.y2-a.y1),l.length>0?i=setTimeout(q,0):n()};return j={refreshColormap:function(){p()},draw:function(b){if(0!==l.length&&(clearTimeout(i),l.length=0,o()),m(),b){var e=d.getImageData(0,0,c.width,c.height),f=document.createElement("div");f.innerHTML="<canvas width='"+e.width+"' height='"+e.height+"'> </canvas>";var g=f.firstChild;g.getContext("2d").putImageData(e,0,0),d.scale(b.z,b.z),d.translate(b.x,b.y),d.drawImage(g,0,0),d.setTransform(1,0,0,1,0,0)}for(var h=Math.sqrt(a.renderer.numberOfTiles),j=(c.width/h,c.height/h,0),k=0;h>k;k++)for(var n=0;h>n;n++){var p={i:k,j:n,id:j++,x1:Math.round(n*c.width/h),x2:Math.round((n+1)*c.width/h),y1:Math.round(k*c.height/h),y2:Math.round((k+1)*c.height/h)};!b||"zoomin"!=b.mvt&&"zoomout"!=b.mvt||(p.x=(p.x1+p.x2)/2,p.y=(p.y1+p.y2)/2,p.dx=b.sx-p.x,p.dy=b.sy-p.y,p.dist=p.dx*p.dx+p.dy*p.dy),b&&"pan"==b.mvt&&(p.prio=0,b.x>0&&p.x1<b.x&&(p.prio=1),b.x<0&&p.x2>c.width+b.x&&(p.prio=1),b.y>0&&p.y1<b.y&&(p.prio=1),b.y<0&&p.y2>c.height+b.y&&(p.prio=1)),l.push(p)}b&&"pan"==b.mvt&&l.sort(function(a,b){return b.prio-a.prio}),b&&"zoomin"==b.mvt&&l.sort(function(a,b){return a.dist-b.dist}),b&&"zoomout"==b.mvt&&l.sort(function(a,b){return b.dist-a.dist}),i=setTimeout(q,0)},resize:function(){g.setFractalDesc({swidth:c.width,sheight:c.height}),e=d.createImageData(c.width,c.height),f=new Uint32Array(e.data.buffer)},setFractalDesc:function(a){var b=g.setFractalDesc(a);return b},getFractalDesc:function(){return g.getFractalDesc()},getColormap:function(){return h},getColorDesc:function(){return h.getDesc()},setColorDesc:function(a){return h.setDesc(a)}}},FractalJS.Controller=function(a,b,c,d){"use strict";var e,f,g,h,i,j,k=1.3,l=function(){var b=a.getFractalDesc(),c=a.getColorDesc(),d=new ArrayBuffer(40),e=new Uint8Array(d),f=new Uint16Array(d),g=new Float64Array(d),h=new Float32Array(d);f[0]=1,f[1]=b.iter,e[4]=b.typeid,e[5]=c.typeid,f[3]=1e4*c.offset,g[1]=b.x,g[2]=b.y,g[3]=b.w,h[8]=c.density;var i=btoa(String.fromCharCode.apply(null,new Uint8Array(d)));i=i.split("/").join("*"),i=i.split("=").join("_"),history.replaceState("","","#A"+i)},m=function(){try{var b=document.location.hash;if(b.startsWith("#A")){var c=b.substr(2);c=c.split("*").join("/"),c=c.split("_").join("=");var d=FractalJS.util.base64ToArrayBuffer(c),e=new Uint8Array(d),f=new Uint16Array(d),g=new Float64Array(d),h=new Float32Array(d),i={x:g[1],y:g[2],w:g[3],iter:f[1],typeid:e[4]},j={offset:f[3]/1e4,density:e.length>32?h[8]:20,typeid:e[5],resolution:1e3,buffer:FractalJS.Colormapbuilder().fromId(1e3,e[5])};a.setFractalDesc(i),a.setColorDesc(j)}}catch(k){console.error("Could not read URL"),console.error(k)}};if(c.mouseControl){b.onmousedown=function(b){b||(b=window.event),e=!0,f=i=b.screenX,g=j=b.screenY,h=a.getFractalDesc()},window.addEventListener("mouseup",function(a){a||(a=window.event),e=!1}),window.addEventListener("mousemove",function(b){if(b||(b=window.event),e){var c=b.screenX-f,k=b.screenY-g,l=c*h.pixelOnP,m=k*h.pixelOnP,n={x:h.x-l,y:h.y-m};a.setFractalDesc(n);var o=b.screenX-i,p=b.screenY-j,q={x:o,y:p,mvt:"pan"};a.draw(q),d.send("mouse.control"),i=b.screenX,j=b.screenY}});var n=function(b){b||(b=window.event);var c=b.clientX,e=b.clientY,f=a.getFractalDesc(),g=a.getFractalDesc(),h=(c-g.swidth/2)*g.pixelOnP,i=(e-g.sheight/2)*g.pixelOnP;g.x+=h,g.y+=i,g=a.setFractalDesc(g);var j={sx:c,sy:e},l=b.deltaY||b.wheelDelta;l>0?(g.w/=k,g.x-=h/k,g.y-=i/k,j.z=1*k,j.mvt="zoomin"):(g.w*=k,g.x-=h*k,g.y-=i*k,j.z=1/k,j.mvt="zoomout");var m=a.setFractalDesc(g);j.x=(f.pxmin-m.pxmin)/f.pixelOnP,j.y=(f.pymin-m.pymin)/f.pixelOnP,a.draw(j),d.send("mouse.control"),b.preventDefault()};"onwheel"in b?b.onwheel=n:b.onmousewheel=n}c.fitToWindow&&(b.width=window.innerWidth,b.height=window.innerHeight,a.resize(),window.onresize=function(){b.width=window.innerWidth,b.height=window.innerHeight,a.resize(),a.draw()}),m(),d.on("iter.change",l),d.on("mouse.control",l),d.on("api.change",l)},FractalJS.Colormapbuilder=function(a){"use strict";var b={0:"0#080560;0.2#2969CB;0.40#F1FEFE;0.60#FCA425;0.85#000000",1:"0.0775#78591e;0.55#d6e341",2:"0#0000FF;0.33#FFFFFF;0.66#FF0000",3:"0.08#09353e;0.44#1fc3e6;0.77#08173e",4:"0#000085;0.25#fffff5;0.5#ffb500;0.75#9c0000",5:"0#000000;0.25#000000;0.5#7f7f7f;0.75#ffffff;0.975#ffffff",10:"0#000000;0.25#16A085;0.5#FFFFFF;0.75#16A085",11:"0#000000;0.25#27AE60;0.5#FFFFFF;0.75#27AE60",12:"0#000000;0.25#2980B9;0.5#FFFFFF;0.75#2980B9",13:"0#000000;0.25#8E44AD;0.5#FFFFFF;0.75#8E44AD",14:"0#000000;0.25#2C3E50;0.5#FFFFFF;0.75#2C3E50",15:"0#000000;0.25#F39C12;0.5#FFFFFF;0.75#F39C12",16:"0#000000;0.25#D35400;0.5#FFFFFF;0.75#D35400",17:"0#000000;0.25#C0392B;0.5#FFFFFF;0.75#C0392B",18:"0#000000;0.25#BDC3C7;0.5#FFFFFF;0.75#BDC3C7",19:"0#000000;0.25#7F8C8D;0.5#FFFFFF;0.75#7F8C8D"},c=function(a,b){var c=new Int32Array(a),d=[],e=[],f=[],g=[],h=function(a){var b=a.split(";");for(var c in b){var h=b[c],i=h.split("#");d.push(Number(i[0])),e.push(parseInt(i[1].substring(0,2),16)),f.push(parseInt(i[1].substring(2,4),16)),g.push(parseInt(i[1].substring(4,6),16))}},i=function(){d.push(d[0]+1),e.push(e[0]),f.push(f[0]),g.push(g[0]);for(var b=FractalJS.util.createInterpolant(d,e),h=FractalJS.util.createInterpolant(d,f),i=FractalJS.util.createInterpolant(d,g),j=new Uint8Array(c.buffer),k=0,l=0;a>l;l++){var m=l/a;m<d[0]&&(m+=1),j[k++]=b(m),j[k++]=h(m),j[k++]=i(m),j[k++]=255}};return h(b),i(),c};return{getStandardGradients:function(){return b},fromId:function(a,d){return c(a,b[d])},fromstops:function(a,b){return c(a,b)}}},FractalJS.create=function(a){"use strict";var b,c,d=FractalJS.util,e=FractalJS.Events();if(!a.canvas||!a.canvas.width)throw"Canvas is not set";if(!a.fractalDesc)throw"Fractal Description is not set";return a.colormap||(a.colormap=FractalJS.Colormap({typeid:0,resolution:1e3,buffer:FractalJS.Colormapbuilder().fromId(1e3,0)})),a.renderer=d.defaultProps(a.renderer,{numberOfTiles:1,drawAfterInit:!0}),a.controller=d.defaultProps(a.controller,{mouseControl:!0,fitToWindow:!1}),b=new FractalJS.Renderer(a,e),c=new FractalJS.Controller(b,a.canvas,a.controller,e),a.renderer.drawAfterInit&&b.draw(),{setFractalDesc:function(a){var c=b.setFractalDesc(a);return e.send("api.change"),c},getFractalDesc:function(){return b.getFractalDesc()},draw:function(){b.draw()},refreshColormap:function(){b.refreshColormap()},setColorDesc:function(a){var c=b.setColorDesc(a);return e.send("api.change"),c},getColorDesc:function(){return b.getColorDesc()},events:e}};