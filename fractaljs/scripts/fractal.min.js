window.FractalJS=window.FractalJS||{},FractalJS.util=function(){"use strict";if(Math.trunc=Math.trunc||function(a){return 0>a?Math.ceil(a):Math.floor(a)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return 0===this.indexOf(a)}),"performance"in window==!1&&(window.performance={}),"now"in window.performance==!1){var a=Date.now();performance.timing&&performance.timing.navigationStart&&(a=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-a}}var b=function(a){if(0>a||a>255)throw"Number is out of range";return 16>a?"0"+a.toString(16):a.toString(16)};return{createInterpolant:function(a,b){var c,d=a.length;if(d!=b.length)throw"Need an equal count of xs and ys.";if(0===d)return function(a){return 0};if(1===d){var e=+b[0];return function(a){return e}}var f=[];for(c=0;d>c;c++)f.push(c);f.sort(function(b,c){return a[b]<a[c]?-1:1});var g=a,h=b;for(a=[],b=[],c=0;d>c;c++)a.push(+g[f[c]]),b.push(+h[f[c]]);var i=[],j=[],k=[];for(c=0;d-1>c;c++){var l=a[c+1]-a[c],m=b[c+1]-b[c];j.push(l),i.push(m),k.push(m/l)}var n=[k[0]];for(c=0;c<j.length-1;c++){var o=k[c],p=k[c+1];if(0>=o*p)n.push(0);else{var l=j[c],q=j[c+1],r=l+q;n.push(3*r/((r+q)/o+(r+l)/p))}}n.push(k[k.length-1]);var s=[],t=[];for(c=0;c<n.length-1;c++){var u=n[c],o=k[c],v=1/j[c],r=u+n[c+1]-o-o;s.push((o-u-r)*v),t.push(r*v*v)}return function(c){var d=a.length-1;if(c==a[d])return b[d];for(var e,f=0,g=t.length-1;g>=f;){e=Math.floor(.5*(f+g));var h=a[e];if(c>h)f=e+1;else{if(!(h>c))return b[e];g=e-1}}d=Math.max(0,g);var i=c-a[d],j=i*i;return b[d]+n[d]*i+s[d]*j+t[d]*i*j}},hsv_to_rgb:function(a,b,c){360==a&&(a=0),c>1&&(c=1);var d=a/60,e=c*b,f=e*(1-Math.abs(d%2-1)),g=[0,0,0];d>=0&&1>d&&(g=[e,f,0]),d>=1&&2>d&&(g=[f,e,0]),d>=2&&3>d&&(g=[0,e,f]),d>=3&&4>d&&(g=[0,f,e]),d>=4&&5>d&&(g=[f,0,e]),d>=5&&6>d&&(g=[e,0,f]);var h=c-e;return g[0]+=h,g[1]+=h,g[2]+=h,g[0]*=255,g[1]*=255,g[2]*=255,g},defaultProps:function(a,b){var c;a||(a={});for(c in b)c in a||(a[c]=b[c]);for(c in a)c in b||console.log("WARN : unknown property ",c);return a},getHashColor:function(a,c,d){return"#"+b(a)+b(c)+b(d)},base64ToArrayBuffer:function(a){for(var b=window.atob(a),c=b.length,d=new Uint8Array(c),e=0;c>e;e++)d[e]=b.charCodeAt(e);return d.buffer}}}(),FractalJS.Events=function(){"use strict";var a={};return{on:function(b,c){var d=b;b.constructor!==Array&&(d=[b]);for(var e in d){var f=d[e];f in a||(a[f]=[]),a[f].push(c)}},send:function(b,c){var d=b;b.constructor!==Array&&(d=[b]);var e=c;"function"==typeof c&&(e=c());var f=[];for(var g in d){var h=d[g];for(var i in a[h])f.push(a[h][i])}for(var j in f)f[j](e)}}},FractalJS.EngineWorker=function(){"use strict";return new Worker(FractalJS.EngineWorkerBlob)},FractalJS.EngineWorkerBlob=function(){"use strict";var a=URL.createObjectURL(new Blob(["(",function(){var a=function(a){var b,c,d,e,f,g,h,i,j,k,l,m=4,n=function(){var a=Math.min(g,h),e=1.11e-15*a;e>d&&(d=e),i=d/a,j=b-g/2*i,k=c-h/2*i},o=1/Math.log(2),p=Math.log(.5)*o,q={mandelsmooth:function(a,b){for(var c=0,d=0,f=0,g=0,h=0,i=0;e>h&&m>=f+g;++h)d=(c+c)*d+b,c=f-g+a,f=c*c,g=d*d;for(i=0;4>i;++i)d=(c+c)*d+b,c=f-g+a,f=c*c,g=d*d;var j=5+h-p-Math.log(Math.log(f+g))*o;return j},0:function(a,b){for(var c=0,d=0,f=0,g=0,h=0;e>h&&m>=f+g;++h)d=(c+c)*d+b,c=f-g+a,f=c*c,g=d*d;return h},3:function(a,b){for(var c=0,d=0,f=0,g=0,h=0;e>h&&m>=f+g;++h)c=f-g+a,d=(c+c)*d+b,f=c*c,g=d*d;return h},1:function(a,b){for(var c,d,f=0,g=0,h=0,i=0,j=0;;){if(c=h*f-3*f*i+a,d=3*h*g-i*g+b,f=c,g=d,++j>=e)break;if(h=f*f,i=g*g,h+i>m)break}return j},2:function(a,b){for(var c,d,f=0,g=0,h=0,i=0,j=0;;){if(d=(f+f)*g+b,c=h-i+a,f=Math.abs(c),g=Math.abs(d),++j>=e)break;if(h=f*f,i=g*g,h+i>m)break}return j}};l=q[0];var r={setFractalDesc:function(a){"x"in a&&(b=a.x),"y"in a&&(c=a.y),a.w&&(d=a.w),a.i&&(e=Math.round(a.i)),a.iter&&(e=Math.round(a.iter)),"typeid"in a&&(f=a.typeid,l=q[f]),a.swidth&&(g=a.swidth,h=a.sheight),n();var i=this.getFractalDesc();return i},getFractalDesc:function(){var a={x:b,y:c,w:d,iter:e,testx:b,testy:c,pixelOnP:i,swidth:g,sheight:h,pxmin:j,pymin:k,typeid:f};return a},drawTileOnBuffer:function(a){for(var b=a.frame,c=k+a.y1*i,d=0,f=a.y1;f<a.y2;f++){for(var g=j+a.x1*i,h=a.x1;h<a.x2;h++){var m=l(g,c);m==e?b[d++]=0:b[d++]=m,g+=i}c+=i}}};return r.setFractalDesc(a),r}({});onmessage=function(b){if("setDesc"===b.data.action)a.setFractalDesc(b.data.desc);else{if("draw"!==b.data.action)throw"invalid worker message";{(new Date).getTime()}a.drawTileOnBuffer(b.data.tile);{(new Date).getTime()}postMessage({action:"endFrame",tile:b.data.tile,frameId:b.data.frameId,finished:b.data.finished})}}}.toString(),")()"],{type:"application/javascript"}));return a}(),FractalJS.Colormap=function(a){"use strict";var b=new Int32Array(a.buffer),c=a.offset||0,d=a.density||20,e=b.length,f=a.typeid;return{getColorForIter:function(a){if(0===a)return 4278190080;var f=b[Math.floor((a*d+c*e)%e)];return f},buffer:function(){return b},getDesc:function(){return{offset:c,density:d,buffer:b,typeid:f}},setDesc:function(a){a.offset&&(c=a.offset),a.density&&(d=a.density),a.typeid&&(f=a.typeid),a.buffer&&(b=a.buffer,e=a.buffer.length)}}},FractalJS.Renderer=function(a,b,c){"use strict";var d,e,f,g,h=(FractalJS.util,this),i=a.getContext("2d"),j=null,k=[],l=[],m=0,n=4,o=[];"hardwareConcurrency"in navigator?(n=navigator.hardwareConcurrency,console.log("FractalJS will use all "+n+" cores")):console.log("FractalJS will use the default "+n+" threads");for(var p=0;n>p;p++)o.push(FractalJS.EngineWorker());this.resize=function(){this.setFractalDesc({swidth:a.width,sheight:a.height});for(var c in o)o[c].postMessage({action:"setDesc",desc:{swidth:a.width,sheight:a.height}});d=i.createImageData(a.width,a.height),e=new Uint32Array(d.data.buffer);var f=Math.sqrt(b.numberOfTiles),g=(a.width/f,a.height/f,0);k.length=0;for(var h=0;f>h;h++)for(var j=0;f>j;j++){var l={i:h,j:j,id:g++,x1:Math.round(j*a.width/f),x2:Math.round((j+1)*a.width/f),y1:Math.round(h*a.height/f),y2:Math.round((h+1)*a.height/f)};l.x=(l.x1+l.x2)/2,l.y=(l.y1+l.y2)/2,l.width=l.x2-l.x1,l.height=l.y2-l.y1,l.frame=new Float32Array(l.width*l.height),l.indexScreen=l.y1*a.width+l.x1,k.push(l)}};var q={},r=function(){var a=Math.min(q.swidth,q.sheight),b=1.11e-15*a;q.w<b&&(q.w=b),q.pixelOnP=q.w/a,q.pxmin=q.x-q.swidth/2*q.pixelOnP,q.pymin=q.y-q.sheight/2*q.pixelOnP};this.setFractalDesc=function(a){"x"in a&&(q.x=a.x),"y"in a&&(q.y=a.y),a.w&&(q.w=a.w),a.i&&(q.iter=Math.round(a.i)),a.iter&&(q.iter=Math.round(a.iter)),"typeid"in a&&(q.typeid=a.typeid),a.swidth&&(q.swidth=a.swidth,q.sheight=a.sheight),r();for(var b in o)o[b].postMessage({action:"setDesc",desc:a});return this.getFractalDesc()},this.getFractalDesc=function(){var a={x:q.x,y:q.y,w:q.w,iter:q.iter,pixelOnP:q.pixelOnP,swidth:q.swidth,sheight:q.sheight,pxmin:q.pxmin,pymin:q.pymin,type:q.type,typeid:q.typeid};return a},this.setColorDesc=function(a){return j?j.setDesc(a):void(j=FractalJS.Colormap(a))},this.getColorDesc=function(){return j.getDesc()},this.drawColors=function(){t()},this.draw=function(b){if(0!==l.length&&(clearTimeout(f),l.length=0),g=performance.now(),m++,c.send("frame.start",function(){return{fractalDesc:q}}),b){var d=i.getImageData(0,0,a.width,a.height),e=document.createElement("div");e.innerHTML="<canvas width='"+d.width+"' height='"+d.height+"'> </canvas>";var h=e.firstChild;h.getContext("2d").putImageData(d,0,0),i.scale(b.z,b.z),i.translate(b.x,b.y),i.drawImage(h,0,0),i.setTransform(1,0,0,1,0,0)}var j;for(var n in k)j=k[n],!b||"zoomin"!=b.mvt&&"zoomout"!=b.mvt||(j.dx=b.sx-j.x,j.dy=b.sy-j.y,j.dist=j.dx*j.dx+j.dy*j.dy),b&&"pan"==b.mvt&&(j.prio=0,b.x>0&&j.x1<b.x&&(j.prio=1),b.x<0&&j.x2>a.width+b.x&&(j.prio=1),b.y>0&&j.y1<b.y&&(j.prio=1),b.y<0&&j.y2>a.height+b.y&&(j.prio=1)),l.push(j);b&&"pan"==b.mvt&&l.sort(function(a,b){return b.prio-a.prio}),b&&"zoomin"==b.mvt&&l.sort(function(a,b){return a.dist-b.dist}),b&&"zoomout"==b.mvt&&l.sort(function(a,b){return b.dist-a.dist});for(var p in o)j=l.shift(),o[p].postMessage({action:"draw",frameId:m,tile:j})};var s=function(){var a=performance.now();c.send("frame.end",function(){return{fractalDesc:q,time:a-g}});var b,d,e,f=1e12,i=-1,j=0,l=0;for(var m in k)for(e=k[m],b=0;b<e.frame.length;b++)j++,d=e.frame[b],0!==d?(d>i&&(i=d),f>d&&(f=d)):l++;var n=i-f,o=q.iter-Math.ceil(n/10),p=0;for(m in k)for(e=k[m],b=0;b<e.frame.length;b++)d=e.frame[b],0!==d&&d>=o&&p++;var r=100*l/j,s=100*p/l;r>1&&s>1&&(h.setFractalDesc({iter:1.5*q.iter}),h.draw(),c.send("iter.change")),r>1&&.2>s&&(h.setFractalDesc({iter:q.iter/1.5}),c.send("iter.change"))},t=function(){var b=(performance.now(),j.getDesc()),c=b.buffer,f=b.offset*c.length,g=b.density,h=c.length;for(var l in k)for(var m=k[l],n=m.indexScreen,o=0,p=0;p<m.height;p++){for(var q=0;q<m.width;q++){var r=m.frame[o++];0===r?e[n]=4278190080:e[n]=c[~~((r*g+f)%h)],n++}n+=a.width-m.width}i.putImageData(d,0,0,0,0,a.width,a.height);performance.now()},u=function(b){if("endFrame"===b.data.action){if(b.data.frameId!=m)return;var c=b.data.tile.id,f=b.data.tile;k[c]=f;for(var g=0,h=0,n=0;n<f.height;n++){h=(n+f.y1)*a.width+f.x1;for(var o=0;o<f.width;o++){var p=f.frame[g++],q=j.getColorForIter(p);e[h++]=q}}if(i.putImageData(d,0,0,f.x1,f.y1,f.x2-f.x1,f.y2-f.y1),l.length>0){f=l.shift();var r={action:"draw",frameId:m,tile:f};0===l.length&&(r.finished=!0),b.target.postMessage(r)}b.data.finished&&s()}};for(var v in o)o[v].onmessage=u},FractalJS.Controller=function(a,b,c,d){"use strict";var e,f,g,h,i,j,k=1.3,l=!1,m=function(){var b=a.getFractalDesc(),c=a.getColorDesc(),d=new ArrayBuffer(40),e=new Uint8Array(d),f=new Uint16Array(d),g=new Float64Array(d),h=new Float32Array(d);f[0]=1,f[1]=b.iter,e[4]=b.typeid,e[5]=c.typeid,f[3]=1e4*c.offset,g[1]=b.x,g[2]=b.y,g[3]=b.w,h[8]=c.density;var i=btoa(String.fromCharCode.apply(null,new Uint8Array(d)));i=i.split("/").join("*"),i=i.split("=").join("_"),history.replaceState("","","#A"+i)},n=function(){try{var b=document.location.hash;if(b.startsWith("#A")){var c=b.substr(2);c=c.split("*").join("/"),c=c.split("_").join("=");var d=FractalJS.util.base64ToArrayBuffer(c),e=new Uint8Array(d),f=new Uint16Array(d),g=new Float64Array(d),h=new Float32Array(d),i={x:g[1],y:g[2],w:g[3],iter:f[1],typeid:e[4]},j={offset:f[3]/1e4,density:e.length>32?h[8]:20,typeid:e[5],resolution:1e3,buffer:FractalJS.Colormapbuilder().fromId(1e3,e[5])};a.setFractalDesc(i),a.setColorDesc(j),l=!0}}catch(k){console.error("Could not read URL"),console.error(k)}};if(c.mouseControl){b.onmousedown=function(b){b||(b=window.event),0===b.button&&(e=!0,f=i=b.screenX,g=j=b.screenY,0===b.button&&(h=a.getFractalDesc()))},window.addEventListener("mouseup",function(a){a||(a=window.event),e=!1}),window.addEventListener("mousemove",function(b){if(b||(b=window.event),e){var c=b.screenX-f,k=b.screenY-g,l=c*h.pixelOnP,m=k*h.pixelOnP,n={x:h.x-l,y:h.y-m};a.setFractalDesc(n);var o=b.screenX-i,p=b.screenY-j,q={x:o,y:p,mvt:"pan"};a.draw(q),d.send("mouse.control"),i=b.screenX,j=b.screenY}});var o=function(b){b||(b=window.event),b.preventDefault();var c=b.deltaY||b.wheelDelta,e=b.clientX,f=b.clientY,g=a.getFractalDesc(),h=a.getFractalDesc(),i=Math.min(h.swidth,h.sheight),j=1.11e-15*i;if(h.w<=j&&c>0)return void d.send("zoom.limit.reached");var l=(e-h.swidth/2)*h.pixelOnP,m=(f-h.sheight/2)*h.pixelOnP;h.x+=l,h.y+=m,h=a.setFractalDesc(h);var n={sx:e,sy:f};c>0?(h.w/=k,h.x-=l/k,h.y-=m/k,n.z=1*k,n.mvt="zoomin"):(h.w*=k,h.x-=l*k,h.y-=m*k,n.z=1/k,n.mvt="zoomout");var o=a.setFractalDesc(h);n.x=(g.pxmin-o.pxmin)/g.pixelOnP,n.y=(g.pymin-o.pymin)/g.pixelOnP,a.draw(n),d.send("mouse.control")};"onwheel"in b?b.onwheel=o:b.onmousewheel=o}return c.fitToWindow&&(b.width=window.innerWidth,b.height=window.innerHeight,a.resize(),window.onresize=function(){b.width=window.innerWidth,b.height=window.innerHeight,a.resize(),a.draw()}),n(),d.on("iter.change",m),d.on("mouse.control",m),d.on("api.change",m),{initFromUrl:l}},FractalJS.Colormapbuilder=function(a){"use strict";var b={0:"0#080560;0.2#2969CB;0.40#F1FEFE;0.60#FCA425;0.85#000000",1:"0.0775#78591e;0.55#d6e341",2:"0#0000FF;0.33#FFFFFF;0.66#FF0000",3:"0.08#09353e;0.44#1fc3e6;0.77#08173e",4:"0#000085;0.25#fffff5;0.5#ffb500;0.75#9c0000",5:"0#000000;0.25#000000;0.5#7f7f7f;0.75#ffffff;0.975#ffffff",10:"0#000000;0.25#16A085;0.5#FFFFFF;0.75#16A085",11:"0#000000;0.25#27AE60;0.5#FFFFFF;0.75#27AE60",12:"0#000000;0.25#2980B9;0.5#FFFFFF;0.75#2980B9",13:"0#000000;0.25#8E44AD;0.5#FFFFFF;0.75#8E44AD",14:"0#000000;0.25#2C3E50;0.5#FFFFFF;0.75#2C3E50",15:"0#000000;0.25#F39C12;0.5#FFFFFF;0.75#F39C12",16:"0#000000;0.25#D35400;0.5#FFFFFF;0.75#D35400",17:"0#000000;0.25#C0392B;0.5#FFFFFF;0.75#C0392B",18:"0#000000;0.25#BDC3C7;0.5#FFFFFF;0.75#BDC3C7",19:"0#000000;0.25#7F8C8D;0.5#FFFFFF;0.75#7F8C8D"},c=function(a,b){var c=new Int32Array(a),d=[],e=[],f=[],g=[],h=function(a){var b=a.split(";");for(var c in b){var h=b[c],i=h.split("#");d.push(Number(i[0])),e.push(parseInt(i[1].substring(0,2),16)),f.push(parseInt(i[1].substring(2,4),16)),g.push(parseInt(i[1].substring(4,6),16))}},i=function(){d.push(d[0]+1),e.push(e[0]),f.push(f[0]),g.push(g[0]);for(var b=FractalJS.util.createInterpolant(d,e),h=FractalJS.util.createInterpolant(d,f),i=FractalJS.util.createInterpolant(d,g),j=new Uint8Array(c.buffer),k=0,l=0;a>l;l++){var m=l/a;m<d[0]&&(m+=1),j[k++]=b(m),j[k++]=h(m),j[k++]=i(m),j[k++]=255}};return h(b),i(),c};return{getStandardGradients:function(){return b},fromId:function(a,d){return c(a,b[d])},fromstops:function(a,b){return c(a,b)}}},FractalJS.create=function(a){"use strict";var b,c,d=FractalJS.util,e=FractalJS.Events();if(!a.canvas||!a.canvas.width)throw"Canvas is not set";if(!a.fractalDesc)throw"Fractal Description is not set";return a.colormap||(a.colormap=FractalJS.Colormap({typeid:0,resolution:1e3,buffer:FractalJS.Colormapbuilder().fromId(1e3,0)})),a.renderer=d.defaultProps(a.renderer,{numberOfTiles:1,drawAfterInit:!0}),a.controller=d.defaultProps(a.controller,{mouseControl:!0,fitToWindow:!1}),b=new FractalJS.Renderer(a.canvas,a.renderer,e),c=new FractalJS.Controller(b,a.canvas,a.controller,e),c.initFromUrl||(b.setFractalDesc(a.fractalDesc),b.setColorDesc(a.colormap)),a.renderer.drawAfterInit&&b.draw(),{setFractalDesc:function(a){var c=b.setFractalDesc(a);return e.send("api.change"),c},getFractalDesc:function(){return b.getFractalDesc()},draw:function(){b.draw()},refreshColormap:function(){b.drawColors()},setColorDesc:function(a){var c=b.setColorDesc(a);return e.send("api.change"),c},getColorDesc:function(){return b.getColorDesc()},events:e}};