window.FractalJS=window.FractalJS||{},FractalJS.util=function(){"use strict";if(Math.trunc=Math.trunc||function(a){return 0>a?Math.ceil(a):Math.floor(a)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return 0===this.indexOf(a)}),"performance"in window==!1&&(window.performance={}),"now"in window.performance==!1){var a=Date.now();performance.timing&&performance.timing.navigationStart&&(a=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-a}}var b=function(a){if(0>a||a>255)throw"Number is out of range";return 16>a?"0"+a.toString(16):a.toString(16)};return{createInterpolant:function(a,b){var c,d=a.length;if(d!=b.length)throw"Need an equal count of xs and ys.";if(0===d)return function(a){return 0};if(1===d){var e=+b[0];return function(a){return e}}var f=[];for(c=0;d>c;c++)f.push(c);f.sort(function(b,c){return a[b]<a[c]?-1:1});var g=a,h=b;for(a=[],b=[],c=0;d>c;c++)a.push(+g[f[c]]),b.push(+h[f[c]]);var i=[],j=[],k=[];for(c=0;d-1>c;c++){var l=a[c+1]-a[c],m=b[c+1]-b[c];j.push(l),i.push(m),k.push(m/l)}var n=[k[0]];for(c=0;c<j.length-1;c++){var o=k[c],p=k[c+1];if(0>=o*p)n.push(0);else{var l=j[c],q=j[c+1],r=l+q;n.push(3*r/((r+q)/o+(r+l)/p))}}n.push(k[k.length-1]);var s=[],t=[];for(c=0;c<n.length-1;c++){var u=n[c],o=k[c],v=1/j[c],r=u+n[c+1]-o-o;s.push((o-u-r)*v),t.push(r*v*v)}return function(c){var d=a.length-1;if(c==a[d])return b[d];for(var e,f=0,g=t.length-1;g>=f;){e=Math.floor(.5*(f+g));var h=a[e];if(c>h)f=e+1;else{if(!(h>c))return b[e];g=e-1}}d=Math.max(0,g);var i=c-a[d],j=i*i;return b[d]+n[d]*i+s[d]*j+t[d]*i*j}},hsv_to_rgb:function(a,b,c){360==a&&(a=0),c>1&&(c=1);var d=a/60,e=c*b,f=e*(1-Math.abs(d%2-1)),g=[0,0,0];d>=0&&1>d&&(g=[e,f,0]),d>=1&&2>d&&(g=[f,e,0]),d>=2&&3>d&&(g=[0,e,f]),d>=3&&4>d&&(g=[0,f,e]),d>=4&&5>d&&(g=[f,0,e]),d>=5&&6>d&&(g=[e,0,f]);var h=c-e;return g[0]+=h,g[1]+=h,g[2]+=h,g[0]*=255,g[1]*=255,g[2]*=255,g},defaultProps:function(a,b){var c;a||(a={});for(c in b)c in a||(a[c]=b[c]);for(c in a)c in b||console.log("WARN : unknown property ",c);return a},getHashColor:function(a,c,d){return"#"+b(a)+b(c)+b(d)},epsilonEquals:function(a,b,c){return c||(c=1e-15),Math.abs(a-b)<c},base64ToArrayBuffer:function(a){for(var b=window.atob(a),c=b.length,d=new Uint8Array(c),e=0;c>e;e++)d[e]=b.charCodeAt(e);return d.buffer},Matrix:function(a,b,c,d,e,f){var g=FractalJS.util.Matrix;void 0===f?(this.a=1,this.c=0,this.e=0,this.b=0,this.d=1,this.f=0):(this.a=a,this.c=c,this.e=e,this.b=b,this.d=d,this.f=f),this.isInvertible=function(){var a=this.a*this.d-this.b*this.c;return Math.abs(a)>1e-15},this.inverseGaussJordan=function(){function h(a,b,c,d){for(var e=a[b],f=a[c],g=0;6>g;g++)e[g]+=f[g]*d}function i(a,b,c){for(var d=a[b],e=0;6>e;e++)d[e]=d[e]*c}var j=[[a,c,e,1,0,0],[b,d,f,0,1,0],[0,0,1,0,0,1]];return h(j,1,2,-j[1][2]),h(j,0,2,-j[0][2]),h(j,1,0,-j[1][0]/j[0][0]),h(j,0,1,-j[0][1]/j[1][1]),i(j,0,1/j[0][0]),i(j,1,1/j[1][1]),new g(j[0][3],j[1][3],j[0][4],j[1][4],j[0][5],j[1][5])},this.inverse=function(){if(this.isInvertible()){var a=this.a,b=this.b,c=this.c,d=this.d,e=this.e,f=this.f,h=a*d-b*c;return new g(d/h,-b/h,-c/h,a/h,(c*f-d*e)/h,-(a*f-b*e)/h)}return this.inverseGaussJordan()},this.multiply=function(a){return new g(this.a*a.a+this.c*a.b,this.b*a.a+this.d*a.b,this.a*a.c+this.c*a.d,this.b*a.c+this.d*a.d,this.a*a.e+this.c*a.f+this.e,this.b*a.e+this.d*a.f+this.f)},this.rotate=function(a){var b=Math.cos(a),c=Math.sin(a);return this.multiply(new g(b,c,-c,b,0,0))},this.isIdentity=function(){return 1==this.a&&0===this.b&&0===this.c&&1==this.d&&0===this.e&&0===this.f},this.clone=function(a){return new g(this.a,this.b,this.c,this.d,this.e,this.f)},this.applyTo=function(a,b){return{x:a*this.a+b*this.c+this.e,y:a*this.b+b*this.d+this.f}},this.params=function(){return{a:a,b:b,c:c,d:d,e:e,f:f}}}}}(),FractalJS.util.Matrix.GetTriangleToTriangle=function(a,b,c,d,e,f,g,h,i,j,k,l){var m=new FractalJS.util.Matrix(a-e,b-f,c-e,d-f,e,f),n=new FractalJS.util.Matrix(g-k,h-l,i-k,j-l,k,l),o=m.inverse();return n.multiply(o)},FractalJS.util.Matrix.GetRotationMatrix=function(a){var b=Math.cos(a),c=Math.sin(a);return new FractalJS.util.Matrix(b,c,-c,b,0,0)},FractalJS.util.Matrix.GetScaleMatrix=function(a,b){return new FractalJS.util.Matrix(a,0,0,b,0,0)},FractalJS.util.Matrix.GetShearMatrix=function(a,b){return new FractalJS.util.Matrix(1,b,a,1,0,0)},FractalJS.util.Matrix.Identity=function(a){return new FractalJS.util.Matrix(1,0,0,1,0,0)},FractalJS.Events=function(){"use strict";var a={};return{on:function(b,c){var d=b;b.constructor!==Array&&(d=[b]);for(var e in d){var f=d[e];f in a||(a[f]=[]),a[f].push(c)}},send:function(b,c){var d=b;b.constructor!==Array&&(d=[b]);var e=c;"function"==typeof c&&(e=c());var f=[];for(var g in d){var h=d[g];for(var i in a[h])f.push(a[h][i])}for(var j in f)f[j](e)}}},FractalJS.Camera=function(){"use strict";var a=FractalJS.util,b=null,c=this;this.width=100,this.height=100,this.x=0,this.y=0,this.w=0,this.pixelOnP=0,this.viewportMatrix=a.Matrix.Identity();var d=function(b,d){var e=c.viewportMatrix.applyTo(1,-1),f=c.viewportMatrix.applyTo(-1,1),g=c.viewportMatrix.applyTo(-1,-1);if(b>=d){var h=(b-d)/2,i=h+d;return a.Matrix.GetTriangleToTriangle(i,d,h,0,h,d,e.x,e.y,f.x,f.y,g.x,g.y)}var j=(d-b)/2,k=j+b;return a.Matrix.GetTriangleToTriangle(b,k,0,j,0,k,e.x,e.y,f.x,f.y,g.x,g.y)},e=function(b,c,d){return a.Matrix.GetTriangleToTriangle(1,0,0,1,0,0,b+d/2,c,b,c+d/2,b,c)};this.project=function(){var a=Math.min(this.width,this.height),c=1.11e-15*a;this.w<c&&(this.w=c),this.pixelOnP=this.w/a;var f=d(this.width,this.height),g=e(this.x,this.y,this.w);b=g.multiply(f)},this.setSize=function(a,b){this.width=a,this.height=b,this.project()},this.transformViewport=function(b,c){var d;if("rotate"==b)d=a.Matrix.GetRotationMatrix(c);else if("scaleX"==b)d=a.Matrix.GetScaleMatrix(c,1);else if("scaleY"==b)d=a.Matrix.GetScaleMatrix(1,c);else if("shearX"==b)d=a.Matrix.GetShearMatrix(c,0);else{if("shearY"!=b)throw"what? "+b;d=a.Matrix.GetShearMatrix(0,c)}return this.viewportMatrix=this.viewportMatrix.multiply(d),this.project(),a.Matrix.GetScaleMatrix(0,-1).multiply(d.inverse())},this.resetViewport=function(b,c){this.viewportMatrix=a.Matrix.Identity(),this.project()},this.setXYW=function(a,b,c){this.x=a,this.y=b,c&&(this.w=c),this.project()},this.S2C=function(a,c){return b.applyTo(a,c)},this.C2S=function(a,c){return b.inverse().applyTo(a,c)},this.getWorkerModel=function(){return{pixelOnP:this.pixelOnP,a:b.a,b:b.b,c:b.c,d:b.d,e:b.e,f:b.f}},this.clone=function(){var a=new FractalJS.Camera;return a.width=this.width,a.height=this.height,a.x=this.x,a.y=this.y,a.w=this.w,a.angle=this.angle,a.scaleX=this.scaleX,a.viewportMatrix=this.viewportMatrix.clone(),a.project(),a}},FractalJS.Model=function(a){"use strict";this.canvas=a,this.camera=new FractalJS.Camera,this.camera.setSize(a.width,a.height),this.resize=function(){this.camera.setSize(this.canvas.width,this.canvas.height)},this.getWorkerModel=function(){var a=this.camera.getWorkerModel();return a.smooth=this.smooth,a.typeId=this.typeId,a.iter=this.iter,a},this.setFractalDesc=function(a){"x"in a&&this.camera.setXYW(a.x,a.y,a.w),"iter"in a&&(this.iter=a.iter),"typeId"in a&&(this.typeId=a.typeId),"smooth"in a&&(this.smooth=a.smooth),("angle"in a||"scaleX"in a)&&this.camera.setViewport(a.angle,a.scaleX),"viewport"in a&&void 0!==a.viewport&&(this.camera.viewportMatrix=a.viewport,this.camera.project())}},FractalJS.Url=function(a,b){"use strict";var c=FractalJS.util;this.update=function(){try{var c=[],d=b.getColorDesc();c.push(["t",a.typeId]),c.push(["x",a.camera.x]),c.push(["y",a.camera.y]),c.push(["w",a.camera.w]),c.push(["i",a.iter]),c.push(["fs",a.smooth?1:0]),c.push(["ct",d.typeId]),c.push(["co",100*d.offset]),c.push(["cd",+d.density.toFixed(2)]),a.camera.viewportMatrix.isIdentity()||(c.push(["va",a.camera.viewportMatrix.a.toFixed(4)]),c.push(["vb",a.camera.viewportMatrix.b.toFixed(4)]),c.push(["vc",a.camera.viewportMatrix.c.toFixed(4)]),c.push(["vd",a.camera.viewportMatrix.d.toFixed(4)]));var e="";for(var f in c){var g=c[f];e+="&"+g[0]+"_"+g[1]}history.replaceState("","","#B"+e.substr(1))}catch(h){console.error("Could not set URL"),console.error(h)}},this.read=function(){var a,b;try{var d=document.location.hash;if(d.startsWith("#A")){var e=d.substr(2);e=e.split("*").join("/"),e=e.split("_").join("=");var f=FractalJS.util.base64ToArrayBuffer(e),g=new Uint8Array(f),h=new Uint16Array(f),i=new Float64Array(f),j=new Float32Array(f),k=g[36];return a={x:i[1],y:-i[2],w:i[3],iter:h[1],typeId:g[4],smooth:k&!0},b={offset:h[3]/1e4,density:g.length>32?j[8]:20,typeId:g[5],resolution:1e3,buffer:FractalJS.Colormapbuilder().fromId(1e3,g[5])},[a,b]}if(d.startsWith("#B")){var l=d.substr(2),m=l.split("&"),n={};for(var o in m){var p=m[o].split("_");n[p[0]]=p[1]}return a={x:parseFloat(n.x),y:parseFloat(n.y),w:parseFloat(n.w),iter:parseInt(n.i),typeId:parseInt(n.t),smooth:1==n.fs},"va"in n&&(a.viewport=new c.Matrix(parseFloat(n.va),parseFloat(n.vb),parseFloat(n.vc),parseFloat(n.vd),0,0)),b={offset:parseInt(n.co)/100,density:parseFloat(n.cd),typeId:parseInt(n.ct),resolution:1e3,buffer:FractalJS.Colormapbuilder().fromId(1e3,parseInt(n.ct))},[a,b]}}catch(q){console.error("Could not read URL"),console.error(q)}finally{}}},FractalJS.EngineWorker=function(){"use strict";return new Worker(FractalJS.EngineWorkerBlob)},FractalJS.EngineWorkerBlob=function(){"use strict";var a=URL.createObjectURL(new Blob(["(",function(){var a=function(){var a,b=4,c=1/Math.log(2),d=1/Math.log(3),e={0:function(a,d){for(var e=0,f=0,g=0,h=0,i=0,j=0;i<iter&&b>=g+h;++i)f=(e+e)*f+d,e=g-h+a,g=e*e,h=f*f;if(i==iter)return i;for(j=0;4>j;++j)f=(e+e)*f+d,e=g-h+a,g=e*e,h=f*f;var k=5+i-Math.log(Math.log(g+h))*c;return k},1:function(a,c){for(var e,f,g=0,h=0,i=0,k=0,l=0;;){if(e=i*g-3*g*k+a,f=3*i*h-k*h+c,g=e,h=f,++l>=iter)break;if(i=g*g,k=h*h,i+k>b)break}if(l==iter)return l;for(j=0;j<4;++j)e=i*g-3*g*k+a,f=3*i*h-k*h+c,g=e,h=f,i=g*g,k=h*h;var m=5+l-Math.log(Math.log(i+k))*d;return m},2:function(a,d){d=-d;for(var e,f,g=0,h=0,i=0,k=0,l=0;;){if(f=(g+g)*h+d,e=i-k+a,g=Math.abs(e),h=Math.abs(f),++l>=iter)break;if(i=g*g,k=h*h,i+k>b)break}if(l==iter)return l;for(j=0;j<4;++j)f=(g+g)*h+d,e=i-k+a,g=Math.abs(e),h=Math.abs(f),i=g*g,k=h*h;var m=5+l-Math.log(Math.log(i+k))*c;return m},3:function(a,c){for(var d=0,e=0,f=0,g=0,h=0;h<iter&&b>=f+g;++h)d=f-g+a,e=(d+d)*e+c,f=d*d,g=e*e;return h},4:function(a,d){for(var e=a,f=d,g=a*a,h=d*d,i=0,j=0;i<iter&&b>=g+h;++i)f=(e+e)*f+.15,e=g-h-.79,g=e*e,h=f*f;if(i==iter)return i;for(j=0;4>j;++j)f=(e+e)*f+.15,e=g-h-.79,g=e*e,h=f*f;var k=5+i-Math.log(Math.log(g+h))*c;return k},5:function(a,d){for(var e=-d,f=a,g=0,h=0,i=0,k=0,l=0,m=.5667,n=-.5;l<iter&&b>=i+k;++l)xp1=e*e-f*f+m+n*g,yp1=2*e*f+n*h,i=xp1*xp1,k=yp1*yp1,g=e,h=f,e=xp1,f=yp1;if(l==iter)return l;for(j=0;j<4;++j)xp1=e*e-f*f+m+n*g,yp1=2*e*f+n*h,i=xp1*xp1,k=yp1*yp1,g=e,h=f,e=xp1,f=yp1;var o=5+l-Math.log(Math.log(e*e+f*f))*c;return o}},f={mandelsmooth:function(a,c){for(var d=0,e=0,f=0,g=0,h=0,i=0;h<iter&&b>=f+g;++h)e=(d+d)*e+c,d=f-g+a,f=d*d,g=e*e;for(i=0;4>i;++i)e=(d+d)*e+c,d=f-g+a,f=d*d,g=e*e;var j=5+h-logHalfBase-Math.log(Math.log(f+g))*logBase;return j},0:function(a,c){for(var d=0,e=0,f=0,g=0,h=0;h<iter&&b>=f+g;++h)e=(d+d)*e+c,d=f-g+a,f=d*d,g=e*e;return h},1:function(a,c){for(var d,e,f=0,g=0,h=0,i=0,j=0;;){if(d=h*f-3*f*i+a,e=3*h*g-i*g+c,f=d,g=e,++j>=iter)break;if(h=f*f,i=g*g,h+i>b)break}return j},2:function(a,c){c=-c;for(var d,e,f=0,g=0,h=0,i=0,j=0;;){if(e=(f+f)*g+c,d=h-i+a,f=Math.abs(d),g=Math.abs(e),++j>=iter)break;if(h=f*f,i=g*g,h+i>b)break}return j},3:function(a,c){for(var d=0,e=0,f=0,g=0,h=0;h<iter&&b>=f+g;++h)d=f-g+a,e=(d+d)*e+c,f=d*d,g=e*e;return h},4:function(a,c){for(var d=a,e=c,f=a*a,g=c*c,h=0;h<iter&&b>=f+g;++h)e=(d+d)*e+.15,d=f-g-.79,f=d*d,g=e*e;return h},5:function(a,c){for(var d=-c,e=a,f=0,g=0,h=0,i=0,j=0,k=.5667,l=-.5;j<iter&&b>=h+i;++j)xp1=d*d-e*e+k+l*f,yp1=2*d*e+l*g,h=xp1*xp1,i=yp1*yp1,f=d,g=e,d=xp1,e=yp1;return j}};return{drawTileOnBuffer:function(b,c){for(var d=b.frame,e=0,f=b.y1;f<=b.y2;f++)for(var g=b.x1;g<=b.x2;g++){var h=g*c.a+f*c.c+c.e,i=g*c.b+f*c.d+c.f,j=a(h,i);j==iter?d[e++]=0:d[e++]=j}},drawSuperTileOnBuffer:function(b,c){for(var d=c.pixelOnP/4,e=b.frame,f=0,g=b.y1;g<=b.y2;g++)for(var h=b.x1;h<=b.x2;h++){for(var i=h*c.a+g*c.c+c.e-c.pixelOnP/2,j=h*c.b+g*c.d+c.f-c.pixelOnP/2,k=0,l=0;16>l;l++)k+=a(i+l/4*d,j+l%4*d);var m=k/16;e[f++]=m==iter?0:m}},drawSubTileOnBuffer:function(b,c){var d,e,f,g=4,h=b.frame;for(f=b.y1;f<=b.y2;f+=g)for(d=(f-b.y1)*b.width,e=b.x1;e<=b.x2;e+=g){var i=e*c.a+f*c.c+c.e+g/2*pixelOnP,j=e*c.b+f*c.d+c.f-g/2*pixelOnP,k=a(i,j);k==iter?h[d]=0:h[d]=k,d+=g}for(d=0,f=0;f<b.height;f++)for(e=0;e<b.width;e++)f%g===0&&e%g===0||(h[d]=h[(f-f%g)*b.width+e-e%g]),d++},setModel:function(b){pxmin=b.pxmin,pymin=b.pymin,pixelOnP=b.pixelOnP,iter=b.iter,a=b.smooth?e[b.typeId]:f[b.typeId]}}}({});onmessage=function(b){var c=b.data;if(c||console.error(b),"draw"!==c.action)throw"invalid worker message";if(a.setModel(c.model),200==c.quality)a.drawTileOnBuffer(c.tile,c.model);else if(100==c.quality)a.drawSubTileOnBuffer(c.tile,c.model);else{if(300!=c.quality)throw"invalid drawing quality";a.drawSuperTileOnBuffer(c.tile,c.model)}postMessage({action:"endTile",quality:c.quality,tile:b.data.tile,frameId:b.data.frameId,finished:b.data.finished})}}.toString(),")()"],{type:"application/javascript"}));return a}(),FractalJS.Colormap=function(a){"use strict";var b=new Int32Array(a.buffer),c=a.offset||0,d=a.density||20,e=b.length,f=a.typeId;return{getColorForIter:function(a){if(0===a)return 4278190080;var f=b[Math.floor((a*d+c*e)%e)];return f},buffer:function(){return b},getDesc:function(){return{offset:c,density:d,buffer:b,typeId:f}},setDesc:function(a){a.offset&&(c=a.offset),a.density&&(d=a.density),a.typeId&&(f=a.typeId),a.buffer&&(b=a.buffer,e=a.buffer.length)}}},FractalJS.Renderer=function(a,b){"use strict";var c,d,e,f,g=a.events,h=a.params.renderer,i=a.params.canvas,j=(FractalJS.util,this),k=i.getContext("2d"),l=null,m=[],n=[],o=0,p=4;"hardwareConcurrency"in navigator?(p=navigator.hardwareConcurrency,console.log("FractalJS will use all "+p+" cores")):console.log("FractalJS will use the default "+p+" threads");var q=[];this.resize=function(){c=k.createImageData(i.width,i.height),d=new Uint32Array(c.data.buffer),e=document.createElement("canvas"),e.width=i.width,e.height=i.height;var a=i.width/i.height,b=Math.sqrt(h.numberOfTiles/a),f=Math.round(b*a);b=Math.round(b),console.log("tiles: "+f+"*"+b+" = "+b*f+" ("+h.numberOfTiles+" asked), ratio "+a);var g=0;m.length=0;for(var j=0;b>j;j++)for(var l=0;f>l;l++){var n={i:l,j:j,id:g++,x1:Math.round(l*i.width/f),x2:Math.round((l+1)*i.width/f)-1,y1:Math.round(j*i.height/b),y2:Math.round((j+1)*i.height/b)-1};n.x=(n.x1+n.x2)/2,n.y=(n.y1+n.y2)/2,n.width=n.x2-n.x1+1,n.height=n.y2-n.y1+1,n.frame=new Float32Array(n.width*n.height),n.indexScreen=n.y1*i.width+n.x1,m.push(n)}},this.setColorDesc=function(a){return l?l.setDesc(a):void(l=FractalJS.Colormap(a))},this.getColorDesc=function(){return l.getDesc()},this.drawColors=function(){u()};var r=null,s=null;this.refine=function(){this.draw("supersampling",null,r,300)},this.draw=function(a,c,d,h){if(r=c,h||(h=200),d||(d=c),s=h,0!==n.length&&(n.length=0),f=performance.now(),o++,g.send("frame.start"),c){var j=k.getImageData(0,0,i.width,i.height);e.getContext("2d").putImageData(j,0,0),c.matrix&&(k.translate(b.camera.width/2,b.camera.height/2),k.transform(c.matrix.a,c.matrix.b,c.matrix.c,c.matrix.d,c.matrix.e,c.matrix.f),k.translate(-b.camera.width/2,-b.camera.height/2)),k.scale(c.z,c.z),k.translate(c.x,c.y),k.drawImage(e,0,0),k.setTransform(1,0,0,1,0,0)}var l;for(var p in m)l=m[p],!c||"zoomin"!=c.mvt&&"zoomout"!=c.mvt||(l.dx=c.sx-l.x,l.dy=c.sy-l.y,l.dist=l.dx*l.dx+l.dy*l.dy),c&&"pan"==c.mvt&&(l.prio=0,c.x>0&&l.x1<c.x&&(l.prio=1),c.x<0&&l.x2>i.width+c.x&&(l.prio=1),c.y>0&&l.y1<c.y&&(l.prio=1),c.y<0&&l.y2>i.height+c.y&&(l.prio=1)),"init"==a&&n.push({action:"draw",quality:100,frameId:o,tile:l}),n.push({action:"draw",quality:h,frameId:o,tile:l});n.sort(function(a,b){if(a.quality!=b.quality)return a.quality-b.quality;if(c){if("pan"==c.mvt)return b.tile.prio-a.tile.prio;if("zoomin"==c.mvt)return a.tile.dist-b.tile.dist;if("zoomout"==c.mvt)return b.tile.dist-a.tile.dist}return a.tile.id-b.tile.id});for(var t in q){var u=n.shift();u&&(u.model=b.getWorkerModel(),q[t].postMessage(u))}};var t=function(){var a=performance.now();if(g.send("frame.end",function(){return{time:a-f,data:{lastquality:s}}}),300!=s){var c,d,e,h=1e12,i=-1,k=0,l=0;for(var n in m)for(e=m[n],c=0;c<e.frame.length;c++)k++,d=e.frame[c],0!==d?(d>i&&(i=d),h>d&&(h=d)):l++;var o=i-h,p=b.iter-Math.ceil(o/10),q=0;for(n in m)for(e=m[n],c=0;c<e.frame.length;c++)d=e.frame[c],0!==d&&d>=p&&q++;var r=100*l/k,t=100*q/l;r>1&&t>1?(b.iter=Math.round(1.5*b.iter),j.draw(),g.send("iter.change")):setTimeout(function(){j.refine()},1e3),r>1&&.2>t&&(b.iter=Math.round(b.iter/1.5),g.send("iter.change"))}},u=function(){var a=(performance.now(),l.getDesc()),b=a.buffer,e=a.offset*b.length,f=a.density,g=b.length;for(var h in m)for(var j=m[h],n=j.indexScreen,o=0,p=0;p<j.height;p++){for(var q=0;q<j.width;q++){var r=j.frame[o++];0===r?d[n]=4278190080:d[n]=b[~~((r*f+e)%g)],n++}n+=i.width-j.width}k.putImageData(c,0,0,0,0,i.width,i.height);performance.now()};this.workerMessage=function(a){if("endTile"!==a.data.action)throw"Unknown message";if(a.data.frameId==o){var e=a.data.tile.id,f=a.data.tile;m[e]=f;for(var g=0,h=0,j=0;j<f.height;j++){h=(j+f.y1)*i.width+f.x1;for(var p=0;p<f.width;p++){var q=f.frame[g++],r=l.getColorForIter(q);d[h++]=r}}if(k.putImageData(c,0,0,f.x1,f.y1,f.width,f.height),n.length>0){var s=n.shift();0===n.length&&(s.finished=!0),s.model=b.getWorkerModel(),a.target.postMessage(s)}a.data.finished&&t()}};for(var v=0;p>v;v++){var w=FractalJS.EngineWorker();q.push(w),w.onmessage=this.workerMessage}this.resize()},FractalJS.Controller=function(a,b){"use strict";var c=1.3,d=1.1,e=.1,f=Math.PI/18,g=.095,h=a.params.canvas,i=a.params.controller,j=a.events,k=b.camera;this.url=new FractalJS.Url(b,a);var l=function(c,d){var e=b.camera.transformViewport(c,d);a.draw("user.control",{matrix:e}),j.send("user.control")},m=function(b,c){var d=b*k.width,e=-c*k.height,f=k.S2C(0,0),g=k.S2C(d,e);k.setXYW(k.x-(g.x-f.x),k.y-(g.y-f.y)),a.draw("user.control",{x:d,y:e,mvt:"pan"}),j.send("user.control")},n=function(b,d,e){var f=Math.min(k.width,k.height),g=1.11e-15*f;if(k.w<=g&&0>e)return void j.send("zoom.limit.reached");var h=k.S2C(0,0),i=k.S2C(b,d),l={x:k.x-i.x,y:k.y-i.y},m=0>e?1/c:c;k.setXYW(i.x+l.x*m,i.y+l.y*m,k.w*m);var n=k.C2S(h.x,h.y),o={x:n.x*m,y:n.y*m,z:1/m,mvt:0>e?"zoomin":"zoomout",sx:b,sy:d};a.draw("user.control",o),j.send("user.control")},o=[];if(i.keyboardControl&&(document.onkeyup=function(a){a=a||window.event,o[a.keyCode]=!1},document.onkeydown=function(a){a=a||window.event,o[a.keyCode]=!0;var b="number"==typeof a.which?a.which:a.keyCode;switch(b){case 107:n(h.width/2,h.height/2,-1);break;case 109:n(h.width/2,h.height/2,1);break;case 86:k.resetViewport();break;case 37:o[82]===!0?l("rotate",-f):o[83]===!0?l("scaleX",d):o[72]===!0?l("shearX",e):m(g,0);break;case 39:o[82]===!0?l("rotate",f):o[83]===!0?l("scaleX",1/d):o[72]===!0?l("shearX",-e):m(-g,0);break;case 38:o[83]===!0?l("scaleY",1/d):o[72]===!0?l("shearY",-e):m(0,-g);break;case 40:o[83]===!0?l("scaleY",d):o[72]===!0?l("shearY",e):m(0,g)}}),i.mouseControl){var p,q,r,s,t,u;h.onmousedown=function(a){a||(a=window.event),0===a.button&&(p=!0,q=s=a.screenX,r=t=a.screenY,0===a.button&&(u=b.camera.clone()))},window.addEventListener("mouseup",function(a){a||(a=window.event),p=!1}),window.addEventListener("mousemove",function(b){if(b||(b=window.event),p){var c=b.screenX-q,d=b.screenY-r,e=u.S2C(0,0),f=u.S2C(c,d);k.setXYW(u.x-(f.x-e.x),u.y-(f.y-e.y));var g=b.screenX-s,h=b.screenY-t;a.draw("user.control",{x:g,y:h,mvt:"pan"}),j.send("user.control"),s=b.screenX,t=b.screenY}});var v=function(a){a||(a=window.event),a.preventDefault();var b=a.deltaY||a.wheelDelta;n(a.clientX,a.clientY,b)};"onwheel"in h?h.onwheel=v:h.onmousewheel=v}i.fitToWindow&&(h.width=window.innerWidth,h.height=window.innerHeight,b.resize(),window.onresize=function(){h.width=window.innerWidth,h.height=window.innerHeight,a.resize(),a.draw("init")}),j.on("iter.change",this.url.update),j.on("user.control",this.url.update),j.on("api.change",this.url.update)},FractalJS.Colormapbuilder=function(a){"use strict";var b={0:"0#080560;0.2#2969CB;0.40#F1FEFE;0.60#FCA425;0.85#000000",1:"0.0775#78591e;0.55#d6e341",2:"0#0000FF;0.33#FFFFFF;0.66#FF0000",3:"0.08#09353e;0.44#1fc3e6;0.77#08173e",4:"0#000085;0.25#fffff5;0.5#ffb500;0.75#9c0000",5:"0#000000;0.25#000000;0.5#7f7f7f;0.75#ffffff;0.975#ffffff",10:"0#000000;0.25#16A085;0.5#FFFFFF;0.75#16A085",11:"0#000000;0.25#27AE60;0.5#FFFFFF;0.75#27AE60",12:"0#000000;0.25#2980B9;0.5#FFFFFF;0.75#2980B9",13:"0#000000;0.25#8E44AD;0.5#FFFFFF;0.75#8E44AD",14:"0#000000;0.25#2C3E50;0.5#FFFFFF;0.75#2C3E50",15:"0#000000;0.25#F39C12;0.5#FFFFFF;0.75#F39C12",16:"0#000000;0.25#D35400;0.5#FFFFFF;0.75#D35400",17:"0#000000;0.25#C0392B;0.5#FFFFFF;0.75#C0392B",18:"0#000000;0.25#BDC3C7;0.5#FFFFFF;0.75#BDC3C7",19:"0#000000;0.25#7F8C8D;0.5#FFFFFF;0.75#7F8C8D"},c=function(a,b){var c=new Int32Array(a),d=[],e=[],f=[],g=[],h=function(a){var b=a.split(";");for(var c in b){var h=b[c],i=h.split("#");d.push(Number(i[0])),e.push(parseInt(i[1].substring(0,2),16)),f.push(parseInt(i[1].substring(2,4),16)),g.push(parseInt(i[1].substring(4,6),16))}},i=function(){d.push(d[0]+1),e.push(e[0]),f.push(f[0]),g.push(g[0]);for(var b=FractalJS.util.createInterpolant(d,e),h=FractalJS.util.createInterpolant(d,f),i=FractalJS.util.createInterpolant(d,g),j=new Uint8Array(c.buffer),k=0,l=0;a>l;l++){var m=l/a;m<d[0]&&(m+=1),j[k++]=b(m),j[k++]=h(m),j[k++]=i(m),j[k++]=255}};return h(b),i(),c};return{getStandardGradients:function(){return b},fromId:function(a,d){return c(a,b[d])},fromstops:function(a,b){return c(a,b)}}},FractalJS.create=function(a){"use strict";var b,c,d=FractalJS.util;if(this.params=a,this.events=FractalJS.Events(),!a.canvas||!a.canvas.width)throw"Canvas is not set";if(!a.fractalDesc)throw"Fractal Description is not set";var e=new FractalJS.Model(a.canvas);a.renderer=d.defaultProps(a.renderer,{numberOfTiles:1,drawAfterInit:!0}),a.controller=d.defaultProps(a.controller,{mouseControl:!0,keyboardControl:!0,fitToWindow:!1}),c=new FractalJS.Controller(this,e);var f=c.url.read();f&&(a.fractalDesc=f[0],a.colorDesc=f[1]),e.setFractalDesc(a.fractalDesc),a.colorDesc||(a.colorDesc={typeId:0,resolution:1e3,buffer:FractalJS.Colormapbuilder().fromId(1e3,0)}),b=new FractalJS.Renderer(this,e),b.setColorDesc(a.colorDesc),a.renderer.drawAfterInit&&b.draw("init"),this.setFractalDesc=function(a){"x"in a&&e.camera.setXYW(a.x,a.y,a.w),"iter"in a&&(e.iter=a.iter),"typeId"in a&&(e.typeId=a.typeId),"smooth"in a&&(e.smooth=a.smooth)},this.resetViewport=function(a){e.camera.resetViewport()},this.getModel=function(){return e},this.draw=function(a,c){b.draw(a,c)},this.resize=function(){e.resize(),b.resize()},this.refreshColormap=function(){b.drawColors()},this.setColorDesc=function(a){var c=b.setColorDesc(a);return this.events.send("api.change"),c},this.getColorDesc=function(){return b.getColorDesc()}};