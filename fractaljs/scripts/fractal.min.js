window.FractalJS=window.FractalJS||{},FractalJS.util=function(){"use strict";if(Math.trunc=Math.trunc||function(a){return 0>a?Math.ceil(a):Math.floor(a)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return 0===this.indexOf(a)}),"performance"in window==!1&&(window.performance={}),"now"in window.performance==!1){var a=Date.now();performance.timing&&performance.timing.navigationStart&&(a=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-a}}var b=function(a){if(0>a||a>255)throw"Number is out of range";return 16>a?"0"+a.toString(16):a.toString(16)};return{hsv_to_rgb:function(a,b,c){360==a&&(a=0),c>1&&(c=1);var d=a/60,e=c*b,f=e*(1-Math.abs(d%2-1)),g=[0,0,0];d>=0&&1>d&&(g=[e,f,0]),d>=1&&2>d&&(g=[f,e,0]),d>=2&&3>d&&(g=[0,e,f]),d>=3&&4>d&&(g=[0,f,e]),d>=4&&5>d&&(g=[f,0,e]),d>=5&&6>d&&(g=[e,0,f]);var h=c-e;return g[0]+=h,g[1]+=h,g[2]+=h,g[0]*=255,g[1]*=255,g[2]*=255,g},defaultProps:function(a,b){var c;a||(a={});for(c in b)c in a||(a[c]=b[c]);for(c in a)c in b||console.log("WARN : unknown property ",c);return a},getHashColor:function(a,c,d){return"#"+b(a)+b(c)+b(d)},base64ToArrayBuffer:function(a){for(var b=window.atob(a),c=b.length,d=new Uint8Array(c),e=0;c>e;e++)d[e]=b.charCodeAt(e);return d.buffer}}}(),FractalJS.Events=function(){"use strict";var a={};return{on:function(b,c){var d=b;b.constructor!==Array&&(d=[b]);for(var e in d){var f=d[e];f in a||(a[f]=[]),a[f].push(c)}},send:function(b,c){var d=b;b.constructor!==Array&&(d=[b]);var e=c;"function"==typeof c&&(e=c());var f=[];for(var g in d){var h=d[g];for(var i in a[h])f.push(a[h][i])}for(var j in f)f[j](e)}}},FractalJS.Engine=function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n=4,o=function(){var a=Math.min(g,h),e=1.11e-15*a;e>d&&(d=e),i=d/a,j=b-g/2*i,k=c-h/2*i},p=1/Math.log(2),q=Math.log(.5)*p,r={0:"mandel",1:"mandel3",2:"burningship",3:"tippetts"},s={mandel:0,mandel3:1,burningship:2,tippetts:3},t={mandelsmooth:function(a,b){for(var c=0,d=0,f=0,g=0,h=0,i=0;e>h&&n>=f+g;++h)d=(c+c)*d+b,c=f-g+a,f=c*c,g=d*d;for(i=0;4>i;++i)d=(c+c)*d+b,c=f-g+a,f=c*c,g=d*d;var j=5+h-q-Math.log(Math.log(f+g))*p;return j},mandel:function(a,b){for(var c=0,d=0,f=0,g=0,h=0;e>h&&n>=f+g;++h)d=(c+c)*d+b,c=f-g+a,f=c*c,g=d*d;return h},tippetts:function(a,b){for(var c=0,d=0,f=0,g=0,h=0;e>h&&n>=f+g;++h)c=f-g+a,d=(c+c)*d+b,f=c*c,g=d*d;return h},mandel3:function(a,b){for(var c,d,f=0,g=0,h=0,i=0,j=0;;){if(c=h*f-3*f*i+a,d=3*h*g-i*g+b,f=c,g=d,++j>=e)break;if(h=f*f,i=g*g,h+i>n)break}return j},burningship:function(a,b){for(var c,d,f=0,g=0,h=0,i=0,j=0;;){if(d=(f+f)*g+b,c=h-i+a,f=Math.abs(c),g=Math.abs(d),++j>=e)break;if(h=f*f,i=g*g,h+i>n)break}return j}};m=t.mandel;var u={setFractalDesc:function(a){if("x"in a&&(b=a.x),"y"in a&&(c=a.y),a.w&&(d=a.w),a.i&&(e=Math.round(a.i)),a.iter&&(e=Math.round(a.iter)),a.typeid){if(!(a.typeid in r))throw"Invalid fractal type "+a.typeid;a.type=r[a.typeid]}if(a.type){if(!(a.type in t))throw"Invalid fractal function "+a.type;f=a.type,m=t[f]}a.swidth&&(g=a.swidth,h=a.sheight,l=new Float32Array(g*h)),o();var i=this.getFractalDesc();return i},getFractalDesc:function(){var a={x:b,y:c,w:d,iter:e,testx:b,testy:c,pixelOnP:i,swidth:g,sheight:h,pxmin:j,pymin:k,type:f,typeid:s[f]};return a},drawTile:function(a){for(var b=k+a.y1*i,c=a.y1;c<a.y2;c++){for(var d=j+a.x1*i,f=c*g+a.x1,h=a.x1;h<a.x2;h++){var n=m(d,b);n==e?l[f++]=0:l[f++]=n,d+=i}b+=i}return l},getBuffer:function(){return l}};return u.setFractalDesc(a),u},FractalJS.Colormap=function(a){"use strict";var b=new Int32Array(a.buffer),c=a.offset||0,d=a.density||20,e=b.length;return{getColorForIter:function(a){if(0===a)return 4278190080;var f=b[Math.floor((a*d+c*e)%e)];return f},buffer:function(){return b},getDesc:function(){return{offset:c,density:d,buffer:b}},setDesc:function(a){a.offset&&(c=a.offset),a.density&&(d=a.density)}}},FractalJS.Renderer=function(a,b){"use strict";var c,d,e,f,g,h,i,j,k,l=(FractalJS.util,[]);c=a.canvas,d=c.getContext("2d"),e=d.createImageData(c.width,c.height),f=new Uint32Array(e.data.buffer),a.fractalDesc.swidth=c.width,a.fractalDesc.sheight=c.height,g=new FractalJS.Engine(a.fractalDesc),h=a.colormap;var m=function(){k=performance.now(),b.send("frame.start",function(){return{fractalDesc:g.getFractalDesc()}})},n=function(){var a=performance.now();b.send("frame.end",function(){return{fractalDesc:g.getFractalDesc(),buffer:g.getBuffer(),time:a-k}});var c,d,e=g.getBuffer(),f=g.getFractalDesc(),h=1e12,i=-1,l=0,m=0;for(c=0;c<e.length;c++)l++,d=e[c],0!==d?(d>i&&(i=d),h>d&&(h=d)):m++;var n=i-h,o=f.iter-Math.ceil(n/10),p=0;for(c=0;c<e.length;c++)d=e[c],0!==d&&d>=o&&p++;var q=100*m/l,r=100*p/m;q>1&&r>1&&(g.setFractalDesc({iter:1.5*f.iter}),j.draw(),b.send("iter.change")),q>1&&.2>r&&(g.setFractalDesc({iter:f.iter/1.5}),b.send("iter.change"))},o=function(){},p=function(){for(var a=g.getBuffer(),b=c.height*c.width,i=h.getDesc(),j=i.buffer,k=i.offset*j.length,l=i.density,m=j.length,n=0;b>n;n++){var o=a[n];0===o?f[n]=4278190080:f[n]=j[~~((o*l+k)%m)]}d.putImageData(e,0,0,0,0,c.width,c.height)},q=function(){for(var a=l.shift(),b=g.drawTile(a),j=a.y1;j<a.y2;j++)for(var k=j*c.width+a.x1,m=a.x1;m<a.x2;m++){var o=b[k],p=h.getColorForIter(o);f[k++]=p}d.putImageData(e,0,0,a.x1,a.y1,a.x2-a.x1,a.y2-a.y1),l.length>0?i=setTimeout(q,0):n()};return j={refreshColormap:function(){p()},draw:function(b){if(0!==l.length&&(clearTimeout(i),l.length=0,o()),m(),b){var e=d.getImageData(0,0,c.width,c.height),f=document.createElement("div");f.innerHTML="<canvas width='"+e.width+"' height='"+e.height+"'> </canvas>";var g=f.firstChild;g.getContext("2d").putImageData(e,0,0),d.scale(b.z,b.z),d.translate(b.x,b.y),d.drawImage(g,0,0),d.setTransform(1,0,0,1,0,0)}for(var h=Math.sqrt(a.renderer.numberOfTiles),j=(c.width/h,c.height/h,0),k=0;h>k;k++)for(var n=0;h>n;n++){var p={i:k,j:n,id:j++,x1:Math.round(n*c.width/h),x2:Math.round((n+1)*c.width/h),y1:Math.round(k*c.height/h),y2:Math.round((k+1)*c.height/h)};!b||"zoomin"!=b.mvt&&"zoomout"!=b.mvt||(p.x=(p.x1+p.x2)/2,p.y=(p.y1+p.y2)/2,p.dx=b.sx-p.x,p.dy=b.sy-p.y,p.dist=p.dx*p.dx+p.dy*p.dy),b&&"pan"==b.mvt&&(p.prio=0,b.x>0&&p.x1<b.x&&(p.prio=1),b.x<0&&p.x2>c.width+b.x&&(p.prio=1),b.y>0&&p.y1<b.y&&(p.prio=1),b.y<0&&p.y2>c.height+b.y&&(p.prio=1)),l.push(p)}b&&"pan"==b.mvt&&l.sort(function(a,b){return b.prio-a.prio}),b&&"zoomin"==b.mvt&&l.sort(function(a,b){return a.dist-b.dist}),b&&"zoomout"==b.mvt&&l.sort(function(a,b){return b.dist-a.dist}),i=setTimeout(q,0)},resize:function(){g.setFractalDesc({swidth:c.width,sheight:c.height}),e=d.createImageData(c.width,c.height),f=new Uint32Array(e.data.buffer)},setFractalDesc:function(a){var b=g.setFractalDesc(a);return b},getFractalDesc:function(){return g.getFractalDesc()},getColormap:function(){return h},getColorDesc:function(){return h.getDesc()},setColorDesc:function(a){return h.setDesc(a)}}},FractalJS.Controller=function(a,b,c,d){"use strict";var e,f,g,h,i,j,k=1.3,l=function(){var b=a.getFractalDesc(),c=a.getColorDesc(),d=new ArrayBuffer(40),e=new Uint8Array(d),f=new Uint16Array(d),g=new Float64Array(d),h=new Float32Array(d);f[0]=1,f[1]=b.iter,e[4]=b.typeid,e[5]=c.typeid,f[3]=1e4*c.offset,g[1]=b.x,g[2]=b.y,g[3]=b.w,h[8]=c.density;var i=btoa(String.fromCharCode.apply(null,new Uint8Array(d)));i=i.split("/").join("*"),i=i.split("=").join("_"),history.replaceState("","","#A"+i)},m=function(){try{var b=document.location.hash;if(b.startsWith("#A")){var c=b.substr(2);c=c.split("*").join("/"),c=c.split("_").join("=");var d=FractalJS.util.base64ToArrayBuffer(c),e=new Uint8Array(d),f=new Uint16Array(d),g=new Float64Array(d),h=new Float32Array(d),i={x:g[1],y:g[2],w:g[3],iter:f[1],typeid:e[4]},j={offset:f[3]/1e4,density:e.length>32?h[8]:20,typeid:e[5]};a.setFractalDesc(i),a.setColorDesc(j)}}catch(k){console.error("Could not read URL")}};if(c.mouseControl){b.onmousedown=function(b){b||(b=window.event),e=!0,f=i=b.screenX,g=j=b.screenY,h=a.getFractalDesc()},window.addEventListener("mouseup",function(a){a||(a=window.event),e=!1}),window.addEventListener("mousemove",function(b){if(b||(b=window.event),e){var c=b.screenX-f,k=b.screenY-g,l=c*h.pixelOnP,m=k*h.pixelOnP,n={x:h.x-l,y:h.y-m};a.setFractalDesc(n);var o=b.screenX-i,p=b.screenY-j,q={x:o,y:p,mvt:"pan"};a.draw(q),d.send("mouse.control"),i=b.screenX,j=b.screenY}});var n=function(b){b||(b=window.event);var c=b.clientX,e=b.clientY,f=a.getFractalDesc(),g=a.getFractalDesc(),h=(c-g.swidth/2)*g.pixelOnP,i=(e-g.sheight/2)*g.pixelOnP;g.x+=h,g.y+=i,g=a.setFractalDesc(g);var j={sx:c,sy:e},l=b.deltaY||b.wheelDelta;l>0?(g.w/=k,g.x-=h/k,g.y-=i/k,j.z=1*k,j.mvt="zoomin"):(g.w*=k,g.x-=h*k,g.y-=i*k,j.z=1/k,j.mvt="zoomout");var m=a.setFractalDesc(g);j.x=(f.pxmin-m.pxmin)/f.pixelOnP,j.y=(f.pymin-m.pymin)/f.pixelOnP,a.draw(j),d.send("mouse.control"),b.preventDefault()};"onwheel"in b?b.onwheel=n:b.onmousewheel=n}c.fitToWindow&&(b.width=window.innerWidth,b.height=window.innerHeight,a.resize(),window.onresize=function(){b.width=window.innerWidth,b.height=window.innerHeight,a.resize(),a.draw()}),m(),d.on("iter.change",l),d.on("mouse.control",l),d.on("api.change",l)},FractalJS.Colormapbuilder=function(a){"use strict";return{fromstops:function(a){var b,c=a.resolution,d=new Int32Array(c),e=function(a){if(a.constructor===Array)return void(b=a);b=[];var c=a.split(";");for(var d in c){var e=c[d],f=e.split("#"),g=Number(f[0]),h=parseInt(f[1].substring(0,2),16),i=parseInt(f[1].substring(2,4),16),j=parseInt(f[1].substring(4,6),16);b.push({index:g,r:h,g:i,b:j})}},f=function(a,b){return{index:a.index+(b?b:0),r:a.r,g:a.g,b:a.b}},g=function(){var a,e=new Uint8Array(d.buffer),g=[];for(a in b){var h=f(b[a],0);h.index=h.index%1,g.push(h)}g.sort(function(a,b){return a.index-b.index}),g.push(f(g[0],1)),g.splice(0,0,f(g[g.length-2],-1));var i=g,j=0,k=1,l=i[j],m=i[k],n=m.index-l.index,o=0;for(a=0;c>a;a++){var p=a/c;p>=m.index&&(j++,k++,l=i[j],m=i[k],n=m.index-l.index);var q=(p-l.index)/n,r=l.r+(m.r-l.r)*q,s=l.g+(m.g-l.g)*q,t=l.b+(m.b-l.b)*q;e[o++]=r,e[o++]=s,e[o++]=t,e[o++]=255}};return e(a.stops),g(),FractalJS.Colormap({buffer:d})}}},FractalJS.create=function(a){"use strict";var b,c,d=FractalJS.util,e=FractalJS.Events();if(!a.canvas||!a.canvas.width)throw"Canvas is not set";if(!a.fractalDesc)throw"Fractal Description is not set";return a.colormap||(a.colormap=FractalJS.Colormapbuilder().fromstops({resolution:1e3,stops:"0#080560;0.2#2969CB;0.40#F1FEFE;0.60#FCA425;0.85#000000"})),a.renderer=d.defaultProps(a.renderer,{numberOfTiles:1,drawAfterInit:!0}),a.controller=d.defaultProps(a.controller,{mouseControl:!0,fitToWindow:!1}),b=new FractalJS.Renderer(a,e),c=new FractalJS.Controller(b,a.canvas,a.controller,e),a.renderer.drawAfterInit&&b.draw(),{setFractalDesc:function(a){var c=b.setFractalDesc(a);return e.send("api.change"),c},getFractalDesc:function(){return b.getFractalDesc()},draw:function(){b.draw()},refreshColormap:function(){b.refreshColormap()},setColorDesc:function(a){var c=b.setColorDesc(a);return e.send("api.change"),c},getColorDesc:function(){return b.getColorDesc()},events:e}};